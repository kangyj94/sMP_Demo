<?xml version="1.0" encoding="euc-kr" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
     
<mapper namespace="product">

    <sql id="selectGoodVendorListSql">
        FROM MCGOODVENDOR A WITH(NOLOCK)
        , SMPVENDORS B WITH(NOLOCK)
        WHERE
        A.VENDORID = B.VENDORID
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="srcVendorId != null and srcVendorId != '' and srcVendorId neq '0'.toString() ">
            AND A.VENDORID = #{srcVendorId}
        </if>
    </sql>

    <sql id="selectDisplayGoodListSql">
        FROM MCGOODVENDOR GOODVEN WITH(NOLOCK)
        , 		MCGOOD GOOD WITH(NOLOCK)
        ,		MCDISPLAYGOOD DISPGOOD WITH(NOLOCK)
        LEFT OUTER JOIN SMPBORGS GROUPS WITH(NOLOCK) 
        	ON DISPGOOD.groupid = GROUPS.BORGID
        LEFT OUTER JOIN SMPBORGS CLIENTS WITH(NOLOCK) 
        	ON DISPGOOD.clientid = CLIENTS.BORGID
        LEFT OUTER JOIN SMPBORGS BRANCHS WITH(NOLOCK) 
        	ON DISPGOOD.branchid = BRANCHS.BORGID
        WHERE	DISPGOOD.VENDORID = GOODVEN.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = GOODVEN.GOOD_IDEN_NUMB
        AND DISPGOOD.GOOD_IDEN_NUMB = GOOD.GOOD_IDEN_NUMB
        <if test="finalGoodSts != null and finalGoodSts != ''">
            AND DISPGOOD.FINAL_GOOD_STS = #{finalGoodSts}
        </if>
        <if test="goodIdenNumb != null and goodIdenNumb != ''">
            AND DISPGOOD.GOOD_IDEN_NUMB = #{goodIdenNumb}
        </if>
    </sql>

    <sql id="selectDisplayGoodHistListSql">
        FROM	MCGOODVENDOR GOODVEN WITH(NOLOCK)
        ,		MCGOOD GOOD WITH(NOLOCK)
        ,		MCDISPLAYGOOD DISPGOOD WITH(NOLOCK)
        LEFT OUTER JOIN SMPBORGS GROUPS WITH(NOLOCK) 
        	ON DISPGOOD.groupid = GROUPS.BORGID
        LEFT OUTER JOIN SMPBORGS CLIENTS WITH(NOLOCK) 
        	ON DISPGOOD.clientid = CLIENTS.BORGID
        LEFT OUTER JOIN SMPBORGS BRANCHS WITH(NOLOCK) 
        	ON DISPGOOD.branchid = BRANCHS.BORGID
        WHERE	DISPGOOD.VENDORID =GOODVEN.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = GOODVEN.GOOD_IDEN_NUMB
        AND DISPGOOD.GOOD_IDEN_NUMB = GOOD.GOOD_IDEN_NUMB
        AND DISPGOOD.FINAL_GOOD_STS in ('1','0')
        <if test="goodIdenNumb != null and goodIdenNumb != ''">
            AND DISPGOOD.GOOD_IDEN_NUMB = #{goodIdenNumb}
        </if>
        <if
            test="groupId != null and groupId != '' and groupId neq '0'.toString() ">
            AND DISPGOOD.GROUPID = #{groupId}
        </if>
        <if
            test="clientId != null and clientId != '' and clientId neq '0'.toString() ">
            AND DISPGOOD.CLIENTID = #{clientId}
        </if>
        <if
            test="branchId != null and branchId != '' and branchId neq '0'.toString() ">
            AND DISPGOOD.BRANCHID = #{branchId}
        </if>
        <if
            test="vendorId != null and vendorId != '' and vendorId neq '0'.toString() ">
            AND DISPGOOD.VENDORID = #{vendorId}
        </if>
    </sql>

    <select id="selectProductInfo" parameterType="java.util.Map"
        resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectProductInfo */
        WITH TMP_TABLE ( cate_id
        ,
        majo_code_name
        , mojo_code_desc
        , ref_cate_seq
        , cate_level
        , ord_num
        ,
        insert_user_id
        , insert_date
        , update_user_id
        , update_date
        , remoteip
        ,
        LEV
        , FULL_CATE_NAME
        ) AS ( SELECT cate_id
        , majo_code_name
        , mojo_code_desc
        , CONVERT (VARCHAR , '-1')
        , cate_level
        , ord_num
        , insert_user_id
        , insert_date
        , update_user_id
        , update_date
        , remoteip
        , 0 AS LEV
        , CONVERT (VARCHAR , '' )
        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
        WHERE CATE_ID = '0'
        UNION ALL
        SELECT OL.cate_id
        , OL.majo_code_name
        , OL.mojo_code_desc
        , CONVERT (VARCHAR ,OL.ref_cate_seq )
        , OL.cate_level
        , OL.ord_num
        , OL.insert_user_id
        , OL.insert_date
        , OL.update_user_id
        , OL.update_date
        , OL.remoteip
        , CTE.LEV+1
        , CONVERT (VARCHAR , CASE
        WHEN CTE.LEV+1 = 1
        THEN OL.majo_code_name
        ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
        END )
        FROM mccategorymaster OL WITH(NOLOCK) 
        , TMP_TABLE CTE
        WHERE OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        ,
        A.VTAX_CLAS_CODE
        , A.SALE_CRITERION_TYPE
        , A.STAN_BUYING_RATE
        ,
        A.STAN_BUYING_MONEY
        , A.ISDISTRIBUTE
        , A.ISDISPPASTGOOD
        , A.INSERT_DATE
        ,
        A.CATE_ID
        , B.FULL_CATE_NAME
        FROM MCGOOD A WITH(NOLOCK)
        , TMP_TABLE B
        WHERE A.CATE_ID = B.CATE_ID
        <if test="goodIdenNumb != null and goodIdenNumb != ''">
            AND A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        </if>
    </select>

    <select id="selectGoodVendorList" parameterType="java.util.Map"
        resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectGoodVendorList */
        SELECT A.VENDORID
        , A.GOOD_IDEN_NUMB
        , A.REQ_GOOD_ID
        , A.SALE_UNIT_PRIC
        , A.GOOD_SPEC_DESC
        , (SELECT Z.ORDER_UNIT FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS ORDE_CLAS_CODE
        , A.DELI_MINI_DAY
        , A.DELI_MINI_QUAN
        , A.MAKE_COMP_NAME
        , A.ORIGINAL_IMG_PATH
        , CASE WHEN LEN(A.ORIGINAL_IMG_PATH) > 1 THEN 'Y' ELSE 'N' END AS ISSETIMAGE
        , A.LARGE_IMG_PATH
        , A.MIDDLE_IMG_PATH
        , A.SMALL_IMG_PATH
        , A.GOOD_SAME_WORD
        , A.GOOD_DESC
        , CASE WHEN LEN(A.GOOD_DESC) > 1 THEN 'Y' ELSE 'N' END AS ISSETDESC
        , A.ISSUB_ONTRACT
        , (SELECT Z.GOOD_TYPE FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS GOOD_CLAS_CODE
        , A.GOOD_INVENTORY_CNT
        , CONVERT(VARCHAR(10), A.REGIST_DATE, 120) AS REGIST_DATE
        , B.VENDORNM
        , B.VENDORCD
        , B.AREATYPE
        , B.PRESSENTNM
        , B.PHONENUM
        <include refid="selectGoodVendorListSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectSaleUnitPricList" parameterType="java.util.Map"
        resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectSaleUnitPricList */
        SELECT SALE_UNIT_PRIC
        FROM MCGOODVENDOR WITH(NOLOCK)
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND VENDORID = #{vendorId}
    </select>

    <select id="selectVendorDetailInfo" resultType="kr.co.bitcube.product.dto.ProductDto">
        /*
        product.selectVendorDetailInfo */
        SELECT VENDORNM
        , VENDORCD
        , AREATYPE
        ,
        PRESSENTNM
        , PHONENUM
        , VENDORID
        FROM SMPVENDORS WITH(NOLOCK)
        WHERE
        VENDORID = #{srcVendorId}
    </select>

    <select id="selectVendorDetail" resultType="hashmap">
        /* product.selectVendorDetail */
        SELECT VENDORID
        , VENDORNM
        , (SELECT B.CODENM1 FROM SMPCODES B WITH(NOLOCK) WHERE AREATYPE =
        B.CODEVAL1 AND B.CODETYPECD = 'DELI_AREA_CODE') AS AREATYPENM
        , PRESSENTNM
        , PHONENUM
        FROM SMPVENDORS WITH(NOLOCK)
        WHERE VENDORID = #{srcVendorId}
    </select>

    <delete id="deleteGoodVendor">
        /* product.deleteGoodVendor */
        DELETE FROM
        MCGOODVENDOR
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND VENDORID =
        #{vendorId}
    </delete>

    <select id="selectDisplayGoodListCnt" resultType="int">
        /* product.selectDisplayGoodListCnt */
        SELECT COUNT(1)
        <include refid="selectDisplayGoodListSql" />
    </select>

    <select id="selectDispProductListCnt" resultType="int">
        /*
        product.selectDispProductListCnt */
        SELECT COUNT(1)
        FROM MCDISPLAYGOOD DISPGOOD WITH(NOLOCK) 
        WHERE DISPGOOD.good_iden_numb = #{goodIdenNumb}
        AND DISPGOOD.groupid = #{groupId}
        AND DISPGOOD.clientid = #{clientId}
        AND DISPGOOD.branchid = #{branchId}
        AND DISPGOOD.vendorid = #{vendorId}
        AND DISPGOOD.final_good_sts = '1'
    </select>

    <select id="selectDisplayGoodList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectDisplayGoodList */
        SELECT DISPGOOD.DISP_GOOD_ID
        ,
        DISPGOOD.GOOD_IDEN_NUMB
        , GOOD.GOOD_NAME
        , dbo.FNS_BORG_STRING(
        CASE WHEN BRANCHS.BORGID > '' THEN BRANCHS.BORGID
        WHEN BRANCHS.BORGID IS NULL AND CLIENTS.BORGID > '' THEN CLIENTS.BORGID
        WHEN BRANCHS.BORGID IS NULL AND CLIENTS.BORGID IS NULL AND
        GROUPS.BORGID > '' THEN GROUPS.BORGID
        END
        ) AS BORGNMS
        , DISPGOOD.GROUPID
        , DISPGOOD.CLIENTID
        , DISPGOOD.BRANCHID
        , DISPGOOD.VENDORID
        , DISPGOOD.CONT_FROM_DATE
        , DISPGOOD.CONT_TO_DATE
        , DISPGOOD.REF_GOOD_SEQ
        , DISPGOOD.ISPAST_SELL_FLAG
        , DISPGOOD.FINAL_GOOD_STS
        , DISPGOOD.SELL_PRICE
        , DISPGOOD.SALE_UNIT_PRIC
        , CONVERT(VARCHAR(10), DISPGOOD.DISP_FROM_DATE, 120) AS DISP_FROM_DATE
        , CONVERT(VARCHAR(10), DISPGOOD.DISP_TO_DATE, 120) AS DISP_TO_DATE
        ,
        DISPGOOD.CUST_GOOD_IDEN_NUMB
        <include refid="selectDisplayGoodListSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectDisplayGoodHistList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectDisplayGoodHistList */
        SELECT DISPGOOD.DISP_GOOD_ID
        ,
        DISPGOOD.GOOD_IDEN_NUMB
        , GOOD.GOOD_NAME
        , dbo.FNS_BORG_STRING(
        CASE WHEN BRANCHS.BORGID > '' THEN BRANCHS.BORGID
        WHEN BRANCHS.BORGID IS NULL AND CLIENTS.BORGID > '' THEN CLIENTS.BORGID
        WHEN BRANCHS.BORGID IS NULL AND CLIENTS.BORGID IS NULL AND
        GROUPS.BORGID > '' THEN GROUPS.BORGID
        END
        ) AS BORGNMS
        , DISPGOOD.GROUPID
        , DISPGOOD.CLIENTID
        , DISPGOOD.BRANCHID
        ,
        DISPGOOD.VENDORID
        , DISPGOOD.CONT_FROM_DATE
        , DISPGOOD.CONT_TO_DATE
        ,
        DISPGOOD.REF_GOOD_SEQ
        , DISPGOOD.ISPAST_SELL_FLAG
        ,
        DISPGOOD.FINAL_GOOD_STS
        , DISPGOOD.SELL_PRICE
        , DISPGOOD.SALE_UNIT_PRIC
        , CONVERT(VARCHAR(10), DISPGOOD.DISP_FROM_DATE, 120) AS DISP_FROM_DATE
        , CONVERT(VARCHAR(10), DISPGOOD.DISP_TO_DATE, 120) AS DISP_TO_DATE
        ,
        DISPGOOD.CUST_GOOD_IDEN_NUMB
        <include refid="selectDisplayGoodHistListSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <insert id="insertDisplayGood">
        /* product.insertDisplayGood */
        INSERT INTO
        MCDISPLAYGOOD (
        DISP_GOOD_ID
        , GOOD_IDEN_NUMB
        , GROUPID
        , CLIENTID
        , BRANCHID
        , CONT_FROM_DATE
        ,
        CONT_TO_DATE
        , REF_GOOD_SEQ
        , ISPAST_SELL_FLAG
        , FINAL_GOOD_STS
        ,
        SELL_PRICE
        , SALE_UNIT_PRIC
        , CUST_GOOD_IDEN_NUMB
        , VENDORID
        ,
        INSERT_USER_ID
        ) VALUES (
        #{dispGoodId}
        , #{goodIdenNumb}
        , #{groupId}
        , #{clientId}
        , #{branchId}
        ,
        #{contFromDate}
        , #{contToDate}
        , #{refGoodSeq}
        , #{ispastSellFlag}
        , '9'
        , #{sellPrice}
        , #{saleUnitPric}
        , #{custGoodIdenNumb}
        , #{vendorId}
        ,
        #{registerUserid}
        )
    </insert>

    <insert id="insertAppGoodPrice">
        /* product.insertAppGoodPrice */
        INSERT INTO
        MCAPPGOODPRICE (
        APP_GOOD_ID
        , CHN_PRICE_CLAS
        , GOOD_IDEN_NUMB
        , FIX_GOOD_ID
        , DISP_GOOD_ID
        ,
        BEFORE_PRICE
        , AFTER_PRICE
        , CHANGE_REASON
        , APP_STS_FLAG
        ,
        REGISTER_USERID
        , REGISTER_DATE
        , CONFIRM_USERID
        , CONFIRM_DATE
        , VENDORID
        ) VALUES (
        #{appGoodId}
        , '10'
        , #{goodIdenNumb}
        , ''
        , #{dispGoodId}
        , #{beforePrice}
        ,
        #{sellPrice}
        , #{changeReason}
        , '0'
        , #{registerUserid}
        , GETDATE()
        ,
        #{registerUserid}
        , GETDATE()
        , #{vendorId}
        )
    </insert>

    <update id="updateAppGoodPrice">
        /* product.updateAppGoodPrice */
        UPDATE MCAPPGOODPRICE
        SET APP_STS_FLAG = '1'
        , APP_USERID = #{registerUserid}
        , APP_DATE =
        GETDATE()
        WHERE APP_GOOD_ID = #{appProdSequence}
    </update>

    <update id="updateRefDisplayGood">
        /* product.updateRefDisplayGood */
        UPDATE
        MCDISPLAYGOOD
        SET FINAL_GOOD_STS = '0'
        , DISP_TO_DATE = GETDATE()
        WHERE
        DISP_GOOD_ID = #{refGoodSeq}
    </update>

    <update id="updateDisplayGood">
        /* product.updateDisplayGood */
        UPDATE MCDISPLAYGOOD
        SET FINAL_GOOD_STS = '1'
        , DISP_FROM_DATE = GETDATE()
        WHERE DISP_GOOD_ID
        = #{prodSequence}
    </update>

    <update id="updatedisplayGoodUpdateTrans">
        /* product.updatedisplayGoodUpdateTrans */
        UPDATE
        MCDISPLAYGOOD
        SET ISPAST_SELL_FLAG = #{ispastSellFlag}
        WHERE
        DISP_GOOD_ID = #{dispGoodId}
    </update>


	<sql id="selectProductRequestDiscontinuanceListSql">
		<if test="srcVendorId != null and srcVendorId != '' and srcVendorId neq '0'.toString() ">
		AND		A.VENDORID = #{srcVendorId}
		</if>
		<if test="srcGoodName != null and srcGoodName != ''">
		AND		B.GOOD_NAME LIKE '%${srcGoodName}%'
		</if>
		<if test="goodFixDate != null and goodFixDate != ''">
			<if test="srcInsertStartDate != null and srcInsertStartDate != ''">
				<if test="srcInsertEndDate != null and srcInsertEndDate != ''">
					<if test="goodFixDate == '0'.toString() ">
		AND 	A.INSERT_DATE BETWEEN CONVERT(DATETIME,#{srcInsertStartDate}) AND DATEADD(D,1,CONVERT(DATETIME,#{srcInsertEndDate}))
					</if>
					<if test="goodFixDate == '1'.toString()">
		AND		A.APP_DATE BETWEEN CONVERT(DATETIME, #{srcInsertStartDate}) AND DATEADD(D,1,CONVERT(DATETIME, #{srcInsertEndDate}))
					</if>
				</if>
			</if>
		</if>
        <if test="srcAppltFixCode != null and srcAppltFixCode != ''">
		AND		A.APPLT_FIX_CODE = #{srcAppltFixCode}
        </if>
		<if test="srcFixAppSts != null and srcFixAppSts != ''">
		AND		A.FIX_APP_STS = #{srcFixAppSts}
		</if>
        <if test="goodClasCode != null and goodClasCode != ''">
		AND		ISNULL(B.GOOD_TYPE,'10') = #{goodClasCode}
        </if>
        <if test="srcProductManager != null and srcProductManager != ''">
		AND		B.PRODUCT_MANAGER = #{srcProductManager}
        </if>
	</sql>
    <select id="selectProductRequestDiscontinuanceListCnt" resultType="int">
        /* product.selectProductRequestDiscontinuanceListCnt */
		SELECT	COUNT(1)
		FROM	MCGOODFIX A WITH(NOLOCK)
		LEFT OUTER JOIN MCGOOD B WITH(NOLOCK)
			ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		WHERE	1 = 1
		<include refid="selectProductRequestDiscontinuanceListSql" />
    </select>
    <select id="selectProductRequestDiscontinuanceList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectProductRequestDiscontinuanceList */
		SELECT	D1.USERNM AS PRODUCT_MANAGER
		,		A.FIX_GOOD_ID
		,		A.GOOD_IDEN_NUMB
		,		B.GOOD_NAME
		,		B.GOOD_SPEC AS GOOD_SPEC_DESC
		,		A.VENDORID
		,		A.APPLT_FIX_CODE
		,		A.BEFORE_PRICE AS SALE_UNIT_PRIC
		,		A.PRICE
		,		A.APPLY_DESC
		,		A.FIX_APP_STS
		,		C.USERNM AS INSERT_USER_NM
		,		A.INSERT_USER_ID
		,		CONVERT(VARCHAR(10),A.INSERT_DATE, 120) AS INSERT_DATE
		,		D.USERNM AS app_User_Id
		,		CONVERT(VARCHAR(10), A.APP_DATE, 120) AS app_Date
		,		E.VENDORNM AS vendorNm
		,		ISNULL(F.CODENM1,'일반') AS good_Clas_Code
		,		B1.SELL_PRICE
		,		B1.BUY_RATE
		,		B1.SALE_UNIT_PRIC AS SALE_PRICE
		,		(CASE 	WHEN (A.APPLT_FIX_CODE='20' AND A.FIX_APP_STS='0' AND ISNULL(B1.BUY_RATE,0)>0) THEN CEILING(100*A.PRICE/(100-B1.BUY_RATE)) 
						WHEN (A.APPLT_FIX_CODE='20' AND A.FIX_APP_STS='0' AND ISNULL(B1.BUY_RATE,0)=0) THEN B1.SELL_PRICE
				END) AS TARGET_PRICE
		FROM	MCGOODFIX A WITH(NOLOCK)
		LEFT OUTER JOIN MCGOOD B WITH(NOLOCK)
			ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		LEFT OUTER JOIN MCGOODVENDOR B1 WITH(NOLOCK)
			ON	B.GOOD_IDEN_NUMB = B1.GOOD_IDEN_NUMB
			AND	A.VENDORID = B1.VENDORID
		LEFT OUTER JOIN SMPUSERS C WITH(NOLOCK) 
        	ON	A.INSERT_USER_ID = C.USERID
		LEFT OUTER JOIN SMPUSERS D WITH(NOLOCK) 
			ON	A.APP_USER_ID = D.USERID
		LEFT OUTER JOIN SMPUSERS D1 WITH(NOLOCK) 
			ON	B.PRODUCT_MANAGER = D1.USERID
        LEFT OUTER JOIN SMPVENDORS E WITH(NOLOCK) 
        	ON	A.vendorid = E.VENDORID
        LEFT OUTER JOIN SMPCODES F WITH(NOLOCK) 
        	ON	F.CODETYPECD = 'ORDERGOODSTYPE'
        	AND	ISNULL(B.good_type,'10') = F.CODEVAL1
		WHERE	1 = 1
		<include refid="selectProductRequestDiscontinuanceListSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY A.INSERT_DATE DESC
        </if>
    </select>

    <update id="updateGoodFix">
        /* product.updateGoodFix */
        UPDATE MCGOODFIX
        SET
        FIX_APP_STS = #{fixAppSts}
        , CANCEL_REASON = #{cancelReason}
        ,
        APP_USER_ID = #{appUserId}
        , APP_DATE = GETDATE()
        WHERE FIX_GOOD_ID =
        #{fixGoodId}
    </update>

    <insert id="insertAppGoodPrice2">
        /* product.insertAppGoodPrice2 */
        INSERT INTO
        MCAPPGOODPRICE (
        APP_GOOD_ID
        , CHN_PRICE_CLAS
        , GOOD_IDEN_NUMB
        , FIX_GOOD_ID
        , DISP_GOOD_ID
        ,
        BEFORE_PRICE
        , AFTER_PRICE
        , CHANGE_REASON
        , APP_STS_FLAG
        ,
        REGISTER_USERID
        , REGISTER_DATE
        , CONFIRM_USERID
        , CONFIRM_DATE
        , VENDORID
        ) VALUES (
        #{appGoodId}
        , #{chnPriceClas}
        , #{goodIdenNumb}
        , #{fixGoodId}
        , #{dispGoodId}
        ,
        #{beforePrice}
        , #{afterPrice}
        , #{changeReason}
        , #{appStsFlag}
        ,
        #{registerUserid}
        , #{registerDate}
        , #{appUserId}
        , GETDATE()
        ,
        #{vendorId}
        )
    </insert>

    <select id="selectBuyProductSearchCnt" resultType="int">
        /* product."selectBuyProductSearchCnt" */
        WITH CATEINFO ( CATE_ID)
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT MASTER.cate_id
        FROM mccategorymaster MASTER WITH(NOLOCK) 
        , CATEINFO
        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT COUNT(*)
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ,
        DISPGOOD.vendorid ORDER BY DISPGOOD.areatype , DISPGOOD.groupid DESC,
        DISPGOOD.clientid DESC , DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_spec_desc AS good_spec_desc
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , goodvendor.deli_mini_day AS stand_order_date
        <include refid="selectProductBuyerListSql" />
    </select>

    <!-- (고객사) 상품검색 Count 조회 Test 비트큐브 임상건 2014-05-15 -->
    <select id="selectBuyProductSearchCntPriority" resultType="int">
        /* product.selectBuyProductSearchCntPriority */
        WITH CATEINFO ( CATE_ID)
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT MASTER.cate_id
        FROM mccategorymaster MASTER WITH(NOLOCK) 
        , CATEINFO
        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT COUNT(*)
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ,
        DISPGOOD.vendorid ORDER BY DISPGOOD.areatype , DISPGOOD.groupid DESC,
        DISPGOOD.clientid DESC , DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_spec_desc AS good_spec_desc
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , goodvendor.deli_mini_day AS stand_order_date
        <include refid="selectProductBuyerListSql2" />
    </select>

    <select id="selectProductListCntForAdmin" resultType="int">
        /* product.selectProductListCntForAdmin */
        WITH TMP_TABLE
        (
        		cate_id 
        ,		majo_code_name 
        ,		LEV 
        ,		FULL_CATE_NAME
        ) AS (
		        SELECT cate_id 
		        ,		majo_code_name 
		        ,		CONVERT (INT , CATE_LEVEL ) AS LEV 
		        ,		CONVERT (VARCHAR(255) , '' )
		        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
		        WHERE CATE_ID = 0
		        UNION ALL
		        SELECT 	OL.cate_id 
		        ,		OL.majo_code_name 
		        ,		CTE.LEV+1 
		        ,		CONVERT (VARCHAR(255),CASE	WHEN CTE.LEV+1 = 1 THEN OL.majo_code_name
		        									ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
		        		END)
		        FROM 	mccategorymaster OL WITH(NOLOCK)  
		        ,		TMP_TABLE CTE
		        WHERE 	OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT COUNT(*)
        <include refid="selectProductListSqlForAdmin" />
    </select>

    <select id="selectProductListListForAdmin" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectProductListListForAdmin */
              WITH TMP_TABLE
        (
        		cate_id 
        ,		majo_code_name 
        ,		LEV 
        ,		FULL_CATE_NAME
        ) AS (
		        SELECT cate_id 
		        ,		majo_code_name 
		        ,		CONVERT (INT , CATE_LEVEL ) AS LEV 
		        ,		CONVERT (VARCHAR(255) , '' )
		        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
		        WHERE CATE_ID = 0
		        UNION ALL
		        SELECT 	OL.cate_id 
		        ,		OL.majo_code_name 
		        ,		CTE.LEV+1 
		        ,		CONVERT (VARCHAR(255),CASE	WHEN CTE.LEV+1 = 1 THEN OL.majo_code_name
		        									ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
		        		END)
		        FROM 	mccategorymaster OL WITH(NOLOCK)  
		        ,		TMP_TABLE CTE
		        WHERE 	OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT	A.GOOD_IDEN_NUMB
        ,		A.GOOD_NAME
        ,		C.FULL_CATE_NAME
        ,		A.GOOD_SPEC
        ,		A.VTAX_CLAS_CODE
        ,		A.ISDISTRIBUTE
        ,		A.ORDER_UNIT AS ORDE_CLAS_CODE
        ,		(CASE WHEN A.GOOD_TYPE='20' THEN '20' ELSE '10' END) AS GOOD_CLAS_CODE
        <include refid="selectProductListSqlForAdmin" />
        <if test="orderString != null and orderString > '' ">
            ORDER BY ${orderString}
        </if>
    </select>

    <sql id="selectProductListSqlForAdmin">
        FROM		MCGOOD A WITH(NOLOCK) 
        INNER JOIN TMP_TABLE C
        	ON	A.cate_id = C.CATE_ID 
        	AND  C.LEV = '3'
        WHERE	EXISTS(SELECT 1 FROM MCGOODVENDOR X WITH(NOLOCK) INNER JOIN SMPBORGS Y WITH(NOLOCK) ON X.VENDORID = Y.BORGID WHERE X.GOOD_IDEN_NUMB=A.GOOD_IDEN_NUMB AND X.ISUSE='1' AND Y.ISUSE='1')
		<if test="srcCateId != null and srcCateId != ''">
		AND 		A.CATE_ID IN (SELECT CATE_ID FROM FNS_CATEGORYIDS_BY_PARENTCATEID(#{srcCateId}))
		</if>
		<if test="srcGoodName != null and srcGoodName != ''">
		AND 		(A.good_name like '%'+ #{srcGoodName} +'%' OR A.GOOD_SPEC like '%'+ #{srcGoodName} +'%' )
		</if>
		<if test="srcGoodSpecDesc != null and srcGoodSpecDesc != '' ">
		AND 		A.GOOD_SPEC LIKE '%'+ #{srcGoodSpecDesc} +'%'
		</if>
    </sql>


    <select id="selectBuyProductSearchList" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuyProductSearchList */
        WITH CATEINFO(
        CATE_ID
        )AS(
		        SELECT CATE_ID
		        FROM mccategorymaster WITH(NOLOCK) 
		        WHERE CATE_ID = ${srcCateId}
		        UNION ALL
		        SELECT MASTER.cate_id
		        FROM mccategorymaster MASTER WITH(NOLOCK) 
		        ,		CATEINFO WITH(NOLOCK) 
		        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT DISPLEV
        , disp_good_id
        , good_name
        , good_iden_numb
        , BORGNM
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , sell_price
        , sale_unit_pric
        , ord_unlimit_quan
        , deli_mini_quan
        , ord_quan
        , total_amout
        , total_amout_sale_unit_pric
        , stand_order_date
        , order_cnt
        , good_same_word
        , cust_good_iden_numb
        , good_clas_code
        , deli_mini_day
        , stan_deli_day
        , vendorid
        , original_Img_Path
        , good_inventory_cnt
        , product_manager
        FROM(
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ,
        DISPGOOD.vendorid ORDER BY DISPGOOD.areatype , DISPGOOD.groupid DESC,
        DISPGOOD.clientid DESC , DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_st_spec_desc AS good_st_spec_desc
        , goodvendor.good_spec_desc AS good_spec_desc
        , DISPGOOD.cust_good_iden_numb
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , DISPGOOD.sale_unit_pric AS sale_unit_pric
        , goodvendor.good_same_word
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as deli_mini_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sale_unit_pric) *CONVERT(NUMERIC(15
        ,2) ,goodvendor.deli_mini_quan) AS total_amout_sale_unit_pric
        , goodvendor.deli_mini_day AS stand_order_date
        , goodvendor.order_cnt
        , goodvendor.good_inventory_cnt
        , GOOD.GOOD_TYPE AS good_clas_code
        , convert(varchar, DATEADD(D, goodvendor.deli_mini_day ,
        CONVERT(DATETIME, getdate() )), 23 ) as deli_mini_day
        , convert(varchar(12), DATEADD(DAY, goodvendor.deli_mini_day ,
        GETDATE() ) , 23 ) + ' ('+ CONVERT(varchar, goodvendor.deli_mini_day)
        + ' 일)' AS stan_deli_day
        , goodvendor.vendorid
        , goodvendor.original_Img_Path
        , ISNULL((SELECT A.USERNM+' ('+A.TEL+')' FROM SMPUSERS A  WITH(NOLOCK) WHERE A.USERID
        = GOOD.PRODUCT_MANAGER), '') AS product_manager
        <include refid="selectProductBuyerListSql" />
        <if test="orderString != null and orderString > '   ' ">
            ORDER BY ${orderString}
        </if>
    </select>

    <!-- (고객사) 상품별 공급사 List 비트큐브 임상건 2014-05-19 -->
    <select id="selectBuyProductListTemp" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuyProductListTemp */
        SELECT
        goodvendor.good_iden_numb
        , BORGS.BORGNM BORGNM
        , goodvendor.vendor_priority
        , goodvendor.vendorid
        , goodvendor.good_st_spec_desc
        , goodvendor.good_spec_desc
        , goodvendor.small_img_path
        , (SELECT Z.ORDER_UNIT FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = GOODVENDOR.GOOD_IDEN_NUMB) AS orde_clas_code
        , ISNULL(goodvendor.good_same_word,'') AS good_same_word
        , goodvendor.deli_mini_quan
        , goodvendor.deli_mini_day
        , goodvendor.order_cnt
        , goodvendor.good_inventory_cnt
        , (SELECT Z.GOOD_TYPE FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB) AS good_clas_code
        , goodvendor.original_Img_Path
        , DISPGOOD.disp_good_id AS disp_good_id
        FROM
        mcgoodvendor goodvendor WITH(NOLOCK) 
        , SMPBORGS BORGS WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        WHERE
        GOODVENDOR.VENDORID = BORGS.BORGID
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND DISPGOOD.final_good_sts = '1'
        AND DISPGOOD.areatype IN
        (
        SELECT
        '99'
        UNION ALL
        SELECT
        SMPBRANCHS.areatype
        FROM
        SMPBRANCHS WITH(NOLOCK) 
        WHERE
        SMPBRANCHS.BRANCHID = 'BUY0103367'
        )
        AND goodvendor.isUse = 1
        <if test="tmpGoodIdenNumb != null and tmpGoodIdenNumb != ''">
            AND goodvendor.good_iden_numb = #{tmpGoodIdenNumb}
        </if>
        ORDER BY
        vendor_priority DESC
    </select>

    <!-- (고객사) 상품검색 조회 Test 비트큐브 임상건 2014-05-15 -->
    <select id="selectBuyProductSearchListPriority" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuyProductSearchListPriority */
        WITH CATEINFO ( CATE_ID)
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT MASTER.cate_id
        FROM mccategorymaster MASTER WITH(NOLOCK) 
        , CATEINFO WITH(NOLOCK) 
        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT DISPLEV
        , disp_good_id
        , disp_good_id AS disp_good_id2
        , good_name
        , good_name AS ori_good_name
        , good_iden_numb
        , BORGNM
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , sell_price
        , sale_unit_pric
        , ord_unlimit_quan
        , deli_mini_quan
        , ord_quan
        , total_amout
        , total_amout_sale_unit_pric
        , stand_order_date
        , order_cnt
        , ISNULL(good_same_word,'') AS good_same_word
        , cust_good_iden_numb
        , good_clas_code
        , deli_mini_day
        , stan_deli_day
        , vendorid
        , original_Img_Path
        , good_inventory_cnt
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ,
        DISPGOOD.vendorid ORDER BY DISPGOOD.areatype , DISPGOOD.groupid DESC,
        DISPGOOD.clientid DESC , DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_st_spec_desc AS good_st_spec_desc
        , goodvendor.good_spec_desc AS good_spec_desc
        , DISPGOOD.cust_good_iden_numb
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , DISPGOOD.sale_unit_pric AS sale_unit_pric
        , goodvendor.good_same_word
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as deli_mini_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sale_unit_pric) *CONVERT(NUMERIC(15
        ,2) ,goodvendor.deli_mini_quan) AS total_amout_sale_unit_pric
        , goodvendor.deli_mini_day AS stand_order_date
        , goodvendor.order_cnt
        , goodvendor.good_inventory_cnt
		, GOOD.GOOD_TYPE AS good_clas_code
        , convert(varchar
        , DATEADD(D, goodvendor.deli_mini_day , CONVERT(DATETIME, getdate() ))
        , 23 ) as deli_mini_day
        , convert(varchar(12)
        , DATEADD(DAY, goodvendor.deli_mini_day , GETDATE() ) , 23 ) + ' ('+
        CONVERT(varchar, goodvendor.deli_mini_day) + ' 일)' AS stan_deli_day
        , goodvendor.vendorid
        , goodvendor.original_Img_Path
        <include refid="selectProductBuyerListSql2" />
        <if test="orderString != null and orderString > '   ' ">
            ORDER BY ${orderString}
        </if>
    </select>

    <!-- 상품에 대한 우선순위가 높은 업체 하나만 나오도록 쿼리 변경 2014-05-15 비트큐브 임상건 -->
    <sql id="selectProductBuyerListSql2">
        FROM
        (
        SELECT DISTINCT B.CATE_ID AS CATE_ID
        FROM mccategoryborg A WITH(NOLOCK) 
        , mcdisplaycategory B WITH(NOLOCK) 
        WHERE A.cate_disp_id = B.cate_disp_id
        AND
        (
        ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid =
        #{branchid} )
        OR ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid
        = '0' )
        OR ( A.groupid = #{groupid} AND A.clientid = '0' AND A.branchid = '0' )
        )
        ) DISPCATE
        , CATEINFO
        , mcgood GOOD
        , mcdisplaygood DISPGOOD
        ,
        (
        SELECT
        A.good_iden_numb --그룹
        , A.vendor_priority --비용
        , A.vendorid --이름
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , good_same_word
        , deli_mini_quan
        , deli_mini_day
        , order_cnt
        , good_inventory_cnt
        , good_clas_code
        , original_Img_Path
        , isUse
        FROM
        (
        SELECT
        ROW_NUMBER() OVER (PARTITION BY good_iden_numb ORDER BY MAX(vendor_priority) DESC,
        vendorid) AS Row
        , good_iden_numb
        , MAX(vendor_priority) AS vendor_priority
        , vendorid
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , good_same_word
        , deli_mini_quan
        , deli_mini_day
        , order_cnt
        , good_inventory_cnt
        , good_clas_code
        , original_Img_Path
        , isUse
        FROM mcgoodvendor WITH(NOLOCK) 
        GROUP BY
        good_iden_numb
        , vendorid
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , good_same_word
        , deli_mini_quan
        , deli_mini_day
        , order_cnt
        , good_inventory_cnt
        , good_clas_code
        , original_Img_Path
        , isUse
        ) A
        WHERE
        A.Row = 1
        ) goodvendor
        , SMPBORGS BORGS
        WHERE DISPCATE.CATE_ID = CATEINFO.CATE_ID
        AND goodvendor.isUse = '1'
        AND CATEINFO.CATE_ID = GOOD.cate_id
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND GOODVENDOR.VENDORID = BORGS.BORGID
        AND
        (
        (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid} AND
        DISPGOOD.branchid = #{branchid} )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid}
        AND DISPGOOD.branchid = '0' )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        OR (DISPGOOD.groupid = '0' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        )
        AND DISPGOOD.final_good_sts = '1'
        <if test="srcIsCen != null and srcIsCen != ''  ">
        	AND	GOOD.GOOD_TYPE &lt;&gt; '30'
        </if>
        <if
            test="branchid != null and branchid != '' and branchid neq '0'.toString() ">
            AND DISPGOOD.areatype IN ( SELECT '99' UNION ALL SELECT
            SMPBRANCHS.areatype FROM SMPBRANCHS  WITH(NOLOCK) WHERE SMPBRANCHS.BRANCHID =
            #{branchid} )
        </if>
        <if test="branchid == null and branchid == ''  ">
            AND DISPGOOD.areatype IN ( SELECT '99' )
        </if>
        <if test="vendorid != null and vendorid != ''">
            AND goodvendor.vendorid = #{vendorid}
        </if>
        <if test="srcGoodName != null and srcGoodName != ''">
            AND (GOOD.GOOD_NAME LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_SPEC_DESC LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_ST_SPEC_DESC LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_SAME_WORD LIKE '%'+#{srcGoodName}+'%')
        </if>
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND GOOD.good_iden_numb like #{srcGoodIdenNumb}+'%'
        </if>
        <if test="srcCustGoodIdenNumb != null and srcCustGoodIdenNumb != ''">
            AND DISPGOOD.cust_good_iden_numb like #{srcCustGoodIdenNumb}+'%'
        </if>
        <if test="srcGoodSpecDesc != null and srcGoodSpecDesc != ''">
            AND ((goodvendor.good_st_spec_desc like '%'+ #{srcGoodSpecDesc} +'%') or
            (goodvendor.good_spec_desc like '%'+ #{srcGoodSpecDesc} +'%'))
        </if>
        <if test="srcGoodSameWord != null and srcGoodSameWord != ''">
            AND (GOODVENDOR.GOOD_SAME_WORD LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOOD.GOOD_NAME LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOODVENDOR.GOOD_SPEC_DESC LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOODVENDOR.GOOD_ST_SPEC_DESC LIKE '%'+#{srcGoodSameWord}+'%')
        </if>
        <if test="srcVendorNm != null and srcVendorNm != ''">
            AND BORGS.BORGNM LIKE '%'+#{srcVendorNm}+'%'
        </if>
        ) TBL
        WHERE TBL.DISPLEV = 1
    </sql>

    <sql id="selectProductBuyerListSql">
        FROM
        (
        SELECT DISTINCT B.CATE_ID AS CATE_ID
        FROM mccategoryborg A WITH(NOLOCK) 
        , mcdisplaycategory B WITH(NOLOCK) 
        WHERE A.cate_disp_id = B.cate_disp_id
        AND
        (
        ( A.groupid = '${groupid}' AND A.clientid = '${clientid}' AND
        A.branchid = '${branchid}' )
        OR ( A.groupid = '${groupid}' AND A.clientid = '${clientid}' AND
        A.branchid = '0' )
        OR ( A.groupid = '${groupid}' AND A.clientid = '0' AND A.branchid = '0'
        )
        )
        ) DISPCATE
        , CATEINFO
        , mcgood GOOD
        , mcdisplaygood DISPGOOD
        , mcgoodvendor goodvendor
        , SMPBORGS BORGS
        WHERE DISPCATE.CATE_ID = CATEINFO.CATE_ID
        AND goodvendor.isUse = '1'
        AND CATEINFO.CATE_ID = GOOD.cate_id
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND GOODVENDOR.VENDORID = BORGS.BORGID
        AND
        (
        (DISPGOOD.groupid = '${groupid}' AND DISPGOOD.clientid = '${clientid}' AND
        DISPGOOD.branchid = '${branchid}' )
        OR (DISPGOOD.groupid = '${groupid}' AND DISPGOOD.clientid =
        '${clientid}' AND DISPGOOD.branchid = '0' )
        OR (DISPGOOD.groupid = '${groupid}' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        OR (DISPGOOD.groupid = '0' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        )
        AND DISPGOOD.final_good_sts = '1'
        <if test="srcIsCen != null and srcIsCen != ''  ">
        	AND	GOOD.GOOD_TYPE &lt;&gt; '30'
        </if>
        <if
            test="branchid != null and branchid != '' and branchid neq '0'.toString() ">
            AND DISPGOOD.areatype IN ( SELECT '99' UNION ALL SELECT
            SMPBRANCHS.areatype FROM SMPBRANCHS  WITH(NOLOCK) WHERE SMPBRANCHS.BRANCHID =
            '${branchid}' )
        </if>
        <if test="branchid == null and branchid == ''  ">
            AND DISPGOOD.areatype IN ( SELECT '99' )
        </if>
        <if test="vendorid != null and vendorid != ''">
            AND goodvendor.vendorid = '${vendorid}'
        </if>
        <if test="srcGoodName != null and srcGoodName != ''">
            AND (GOOD.GOOD_NAME LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_SPEC_DESC LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_ST_SPEC_DESC LIKE '%'+#{srcGoodName}+'%' OR
            GOODVENDOR.GOOD_SAME_WORD LIKE '%'+#{srcGoodName}+'%')
        </if>
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND GOOD.good_iden_numb like #{srcGoodIdenNumb}+'%'
        </if>
        <if test="srcCustGoodIdenNumb != null and srcCustGoodIdenNumb != ''">
            AND DISPGOOD.cust_good_iden_numb like #{srcCustGoodIdenNumb}+'%'
        </if>
        <if test="srcGoodSpecDesc != null and srcGoodSpecDesc != ''">
            AND ((goodvendor.good_st_spec_desc like '%'+ #{srcGoodSpecDesc} +'%') or
            (goodvendor.good_spec_desc like '%'+ #{srcGoodSpecDesc} +'%'))
        </if>
        <if test="srcGoodSameWord != null and srcGoodSameWord != ''">
            AND (GOODVENDOR.GOOD_SAME_WORD LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOOD.GOOD_NAME LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOODVENDOR.GOOD_SPEC_DESC LIKE '%'+#{srcGoodSameWord}+'%' OR
            GOODVENDOR.GOOD_ST_SPEC_DESC LIKE '%'+#{srcGoodSameWord}+'%')
        </if>
        <if test="srcVendorNm != null and srcVendorNm != ''">
            AND BORGS.BORGNM LIKE '%'+#{srcVendorNm}+'%'
        </if>
        <if test="srcGoodClasCode != null and srcGoodClasCode != ''">
            AND GOOD.GOOD_TYPE = #{srcGoodClasCode}
        </if>
        ) TBL
        WHERE TBL.DISPLEV = 1
    </sql>


    <select id="selectCommonProductSearchListByVendor" resultType="kr.co.bitcube.product.dto.ProductDto"> <!-- 789 -->
        /* product.selectCommonProductSearchListByVendor */
        SELECT DISPLEV
        , disp_good_id
        , good_name
        , good_iden_numb
        , BORGNM
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , sell_price
        , sale_Unit_Pric
        , ord_unlimit_quan
        , ord_quan
        , total_amout
        , stand_order_date
        , order_cnt
        , good_same_word
        , cust_good_iden_numb
        , deli_Mini_Day
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ,
        DISPGOOD.vendorid ORDER BY DISPGOOD.areatype , DISPGOOD.groupid DESC,
        DISPGOOD.clientid DESC , DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_spec_desc AS good_spec_desc
        , DISPGOOD.cust_good_iden_numb
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , goodvendor.sale_Unit_Pric as sale_Unit_Pric
        , goodvendor.good_same_word
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , CONVERT(VARCHAR(12) , DATEADD(DAY , GOODVENDOR.deli_mini_day ,
        GETDATE() ) , 23 ) + ' ('+ CONVERT(VARCHAR, GOODVENDOR.deli_mini_day)
        + ' 일)' as deli_Mini_Day
        , goodvendor.deli_mini_day AS stand_order_date
        , goodvendor.order_cnt
        FROM
        (
        SELECT DISTINCT B.CATE_ID AS CATE_ID
        FROM mccategoryborg A WITH(NOLOCK) 
        , mcdisplaycategory B WITH(NOLOCK) 
        WHERE A.cate_disp_id = B.cate_disp_id
        AND
        (
        ( A.groupid = #{schGroupId} AND A.clientid = #{schClientId} AND
        A.branchid = #{schBranchId} )
        OR ( A.groupid = #{schGroupId} AND A.clientid = #{schClientId} AND
        A.branchid = '0' )
        OR ( A.groupid = #{schGroupId} AND A.clientid = '0' AND A.branchid = '0'
        )
        )
        ) DISPCATE
        , mcgood GOOD
        , mcdisplaygood DISPGOOD
        , mcgoodvendor goodvendor
        , SMPBORGS BORGS
        WHERE goodvendor.isUse = '1'
        AND DISPCATE.CATE_ID = GOOD.cate_id
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND GOODVENDOR.VENDORID = BORGS.BORGID
        AND
        (
        (DISPGOOD.groupid = #{schGroupId} AND DISPGOOD.clientid = #{schClientId} AND
        DISPGOOD.branchid = #{schBranchId} )
        OR (DISPGOOD.groupid = #{schGroupId} AND DISPGOOD.clientid =
        #{schClientId} AND DISPGOOD.branchid = '0' )
        OR (DISPGOOD.groupid = #{schGroupId} AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        OR (DISPGOOD.groupid = '0' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        )
        AND DISPGOOD.final_good_sts = '1'
        AND DISPGOOD.areatype in ( SELECT '99' UNION ALL SELECT
        SMPBRANCHS.AREATYPE FROM SMPBRANCHS  WITH(NOLOCK) WHERE SMPBRANCHS.BRANCHID =
        #{schBranchId} )
        AND goodvendor.VENDORID = #{schVendorId}
        <if test="schGoodName != null and schGoodName != ''">
            AND GOOD.good_name like #{schGoodName}+'%'
        </if>
        <if test="schGoodSpecName != null and schGoodSpecName != ''">
            AND goodvendor.good_spec_desc like #{schGoodSpecName}+'%'
        </if>
        ) TBL
        WHERE TBL.DISPLEV = 1
        <if test="orderString != null and orderString > '   ' ">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectChoiceProductListInfoByVendor" resultType="kr.co.bitcube.product.dto.ProductDto">
        /*
        product.selectChoiceProductListInfoByVendor */
        SELECT
        DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , (SELECT BORGS.BORGNM FROM SMPBORGS BORGS  WITH(NOLOCK) WHERE BORGS.BORGID=GOODVENDOR.vendorid) AS VENDORID
        , GOODVENDOR.good_spec_desc
        , GOODVENDOR.small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sale_unit_pric
        , GOODVENDOR.deli_mini_quan as deli_Mini_Quan
        , GOODVENDOR.deli_mini_quan as ord_quan
        , ( DISPGOOD.sell_price * GOODVENDOR.deli_mini_quan ) AS total_amout
        , CONVERT(VARCHAR(12) , DATEADD(DAY , GOODVENDOR.deli_mini_day ,
        GETDATE() ) , 23 ) as deli_mini_day
        , CONVERT(VARCHAR(12) , DATEADD(DAY , GOODVENDOR.deli_mini_day ,
        GETDATE() ) , 23 ) + ' ('+ CONVERT(VARCHAR, GOODVENDOR.deli_mini_day)
        + ' 일)' AS stan_deli_day
        FROM mcgood GOOD WITH(NOLOCK) 
        , mcgoodvendor GOODVENDOR WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        WHERE GOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND GOODVENDOR.good_iden_numb = DISPGOOD.good_iden_numb
        AND GOODVENDOR.vendorid = DISPGOOD.vendorid
        AND DISPGOOD.disp_good_id IN ${disp_good_ids_Parmas}
    </select>


    <select id="selectInterestProductCnt" resultType="int">
        /*
        product.selectInterestProductCnt*/
        SELECT COUNT(*)
        FROM mrborgusergood usergood WITH(NOLOCK) 
        WHERE usergood.groupid = #{groupId}
        AND usergood.clientid = #{clientId}
        AND usergood.branchid = #{branchId}
        AND usergood.disp_good_id = #{disp_good_id}
    </select>

    <insert id="insertInterestProduct">
        /* product.insertInterestProduct*/
        INSERT INTO mrborgusergood
        ( groupid
        , clientid
        , branchid
        , regi_user_id
        , disp_good_id
        , regi_date_time
        )
        VALUES
        ( #{groupId} /* groupid */
        , #{clientId} /* clientid */
        , #{branchId} /* branchid */
        , #{userId} /* regi_user_id */
        , #{disp_good_id} /* disp_good_id */
        , getdate() /* regi_date_time */
        )
    </insert>

    <delete id="deleteInterestProduct">
        /* product.deleteInterestProduct */
        DELETE FROM
        mrborgusergood
        WHERE disp_good_id = #{disp_good_id}
        AND groupid = #{groupId}
        AND clientid = #{clientId}
        AND branchid = #{branchId}
    </delete>

    <sql id="selectBuyWishListCondition">
        FROM mrborgusergood USERGOOD WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        , mcgoodvendor GOODVENDOR WITH(NOLOCK) 
        , mcgood GOOD WITH(NOLOCK) 
        , SMPBORGS BORGS WITH(NOLOCK) 
        , DBO.FNS_DISP_GOODINFO_FOR_ADMIN(#{groupid} , #{clientid} ,
        #{branchid}) DISPINFO
        WHERE USERGOOD.disp_good_id = DISPGOOD.disp_good_id
        AND DISPGOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND DISPGOOD.vendorid = GOODVENDOR.vendorid
        AND GOODVENDOR.good_iden_numb = GOOD.good_iden_numb
        AND GOODVENDOR.vendorid = BORGS.BORGID
        AND DISPGOOD.good_iden_numb = DISPINFO.good_iden_numb
        AND DISPGOOD.vendorid = DISPINFO.vendorid
        AND GOODVENDOR.ISUSE = '1'
        AND USERGOOD.GROUPID = #{groupid}
        AND USERGOOD.CLIENTID = #{clientid}
        AND USERGOOD.BRANCHID = #{branchid}
        AND DISPGOOD.FINAL_GOOD_STS = '1'
    </sql>

    <select id="selectBuyWishListCnt" resultType="int">
        /* product.selectBuyWishListCnt */
        SELECT COUNT(*) AS CNT
        <include refid="selectBuyWishListCondition" />
    </select>

    <select id="selectBuyWishList" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuyWishList */

        SELECT DISPGOOD.disp_good_id
        , GOOD.good_name
        , GOOD.good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , sell_price
        , deli_mini_quan as ord_unlimit_quan
        , deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,GOODVENDOR.deli_mini_quan) AS total_amout
        , CONVERT(VARCHAR(12) , DATEADD(DAY , GOODVENDOR.deli_mini_day ,
        GETDATE() ) , 23 ) AS stand_order_date
        <include refid="selectBuyWishListCondition" />
    </select>

    <select id="selectProductDetailInfoForBuyer" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectProductDetailInfoForBuyer */
        WITH TMP_TABLE ( cate_id
        , majo_code_name
        , mojo_code_desc
        , ref_cate_seq
        , cate_level
        , ord_num
        ,
        insert_user_id
        , insert_date
        , update_user_id
        , update_date
        , remoteip
        ,
        LEV
        , FULL_CATE_NAME
        ) AS ( SELECT cate_id
        , majo_code_name
        , mojo_code_desc
        , CONVERT (VARCHAR , '-1')
        , cate_level
        , ord_num
        , insert_user_id
        , insert_date
        , update_user_id
        , update_date
        , remoteip
        , 0 AS LEV
        , CONVERT (VARCHAR(1024) , '' )
        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
        WHERE CATE_ID = '0'
        UNION ALL
        SELECT OL.cate_id
        , OL.majo_code_name
        , OL.mojo_code_desc
        , CONVERT (VARCHAR ,OL.ref_cate_seq )
        , OL.cate_level
        , OL.ord_num
        , OL.insert_user_id
        , OL.insert_date
        , OL.update_user_id
        , OL.update_date
        , OL.remoteip
        , CTE.LEV+1
        , CONVERT (VARCHAR(1024) , CASE
        WHEN CTE.LEV+1 = 1
        THEN OL.majo_code_name
        ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
        END )
        FROM mccategorymaster OL WITH(NOLOCK) 
        , TMP_TABLE CTE
        WHERE OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT GOOD.good_name
        , GOOD.good_iden_numb
        , GOODVENDOR.good_st_spec_desc
        , GOODVENDOR.good_spec_desc
        , GOODVENDOR.original_img_path
        , GOODVENDOR.large_img_path
        , GOODVENDOR.make_comp_name
        , GOODVENDOR.deli_mini_day
        , GOODVENDOR.deli_mini_quan
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price
        , GOODVENDOR.good_desc
        , DISPGOOD.disp_good_id
        , BORG.BORGNM
        , TMP_TABLE.FULL_CATE_NAME
        , TMP_TABLE.majo_code_name
        , VENDOR.PRESSENTNM AS PRESSENTNM
        , VENDOR.PHONENUM AS PHONENUM
        , CODES.CODENM1 AS AREATYPENM
        , GOODVENDOR.isUse
        , GOOD.isdisppastgood
        , DISPGOOD.final_good_sts
        <if test=" comp_branchid != null and comp_branchid != '' ">
            , dbo.FNS_BORG_STRING(#{comp_branchid}) as comp_iden_name
        </if>
        , GOOD.isDistribute
        , (CASE WHEN GOOD.isDistribute='0' THEN ''
        ELSE (
        SELECT A.USERNM + CASE WHEN A.TEL IS NULL THEN '' ELSE '('+A.TEL+')' END
        FROM SMPUSERS A WITH(NOLOCK) 
        WHERE A.USERID = GOOD.PRODUCT_MANAGER
        )
        END) AS PRODUCT_MANAGER
        , ISNULL(GOOD.IS_ADD_GOOD,0) AS IS_ADD_GOOD
        FROM mcgood GOOD WITH(NOLOCK) 
        , mcgoodvendor GOODVENDOR WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        , SMPBORGS BORG  WITH(NOLOCK) 
        LEFT OUTER JOIN SMPVENDORS VENDOR  WITH(NOLOCK) 
        	ON BORG.BORGID =VENDOR.VENDORID
        LEFT OUTER JOIN SMPCODES CODES  WITH(NOLOCK) 
        	ON VENDOR.AREATYPE = CODES.CODEVAL1 AND CODES.CODETYPEID = '12720'
        , TMP_TABLE
        WHERE GOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND GOODVENDOR.vendorid = DISPGOOD.vendorid
        AND GOODVENDOR.VENDORID = BORG.BORGID
        AND TMP_TABLE.cate_id = GOOD.cate_id
        /* AND DISPGOOD.final_good_sts = '1' */
        AND DISPGOOD.disp_good_id = #{disp_good_id}
    </select>

    <select id="selectPastProductPriceInfo" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectPastProductPriceInfo */
        WITH tmpTable (disp_good_id ,
        ref_good_seq , sale_unit_pric , sell_price , ispast_sell_flag) as (
        SELECT disp_good_id AS disp_good_id
        , ref_good_seq AS ref_good_seq
        , sale_unit_pric
        , sell_price
        , ispast_sell_flag
        FROM mcdisplaygood WITH(NOLOCK) 
        WHERE disp_good_id = #{disp_good_id}
        UNION ALL
        SELECT DISPGOOD.disp_good_id
        , DISPGOOD.ref_good_seq
        , DISPGOOD.sale_unit_pric
        , DISPGOOD.sell_price
        , DISPGOOD.ispast_sell_flag
        FROM mcdisplaygood DISPGOOD WITH(NOLOCK) 
        , tmpTable
        WHERE tmpTable.ref_good_seq = DISPGOOD.disp_good_id
        )SELECT disp_good_id
        , ref_good_seq
        , sale_unit_pric
        , sell_price
        , ispast_sell_flag
        FROM tmpTable
        where ispast_sell_flag = '1'
    </select>

    <!-- 물류센터 - 수탁 재고 조회 -->
    <select id="selectCenStockCntSearchCountRow" resultType="int">
        /* product.selectCenStockCntSearchCountRow*/
        SELECT COUNT(1) FROM (
        <include refid="selectCenStockCntSearchSql" />
    </select>
    <select id="selectCenStockCntSearchList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectCenStockCntSearchList*/
        SELECT AA.* FROM (
        <include refid="selectCenStockCntSearchSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <sql id="selectCenStockCntSearchSql">
        SELECT
        B.GOOD_NAME
        , A.GOOD_IDEN_NUMB
        , C.VENDORNM
        , A.GOOD_INVENTORY_CNT
        , A.SALE_UNIT_PRIC
        , A.GOOD_SPEC_DESC
        , A.GOOD_ST_SPEC_DESC
        , CONVERT(VARCHAR(10), A.REGIST_DATE, 120) AS REGIST_DATE
        , A.VENDORID
        , CASE WHEN ISNULL(A.GOOD_INVENTORY_CNT,0) &gt; 0 THEN 1 ELSE 0 END AS
        ISEXIST
        FROM MCGOODVENDOR A WITH (NOLOCK)
        , MCGOOD B WITH (NOLOCK)
        , SMPVENDORS C WITH (NOLOCK)
        WHERE B.GOOD_TYPE = '30'
        AND
        A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND A.VENDORID = C.VENDORID
        <if test="srcGoodNm != null and srcGoodNm != ''">
            AND B.GOOD_NAME LIKE '%'+#{srcGoodNm}+'%'
        </if>
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND A.GOOD_IDEN_NUMB LIKE #{srcGoodIdenNumb}+'%'
        </if>
        <if test="srcGoodRegiDateStart != null and srcGoodRegiDateStart != ''">
            <if test="srcGoodRegiDateEnd != null and srcGoodRegiDateEnd != ''">
                AND A.REGIST_DATE BETWEEN CONVERT(DATETIME,
                #{srcGoodRegiDateStart}) AND DATEADD(D,1,CONVERT(DATETIME,
                #{srcGoodRegiDateEnd}))
            </if>
        </if>
        <if
            test="srcVendorId != null and srcVendorId != '' and srcVendorId neq '0'.toString() ">
            AND A.VENDORID = #{srcVendorId}
        </if>
        ) AA WHERE 1=1
        <if test="srcExistStock != null and srcExistStock != ''">
            AND AA.ISEXIST = #{srcExistStock}
        </if>
    </sql>

    <!-- 물류센터 - 수탁 재고 조회 ( 상세 ) -->
    <select id="selectCenStockCntSearchPopCountRow" resultType="int">
        /* product.selectCenStockCntSearchPopCountRow*/
        SELECT COUNT(1) FROM (
        <include refid="selectCenStockCntSearchPopSql" />
    </select>
    <select id="selectCenStockCntSearchPopList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectCenStockCntSearchPopList*/
        SELECT AA.* FROM (
        <include refid="selectCenStockCntSearchPopSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>
    <sql id="selectCenStockCntSearchPopSql">
        SELECT	B.GOOD_NAME
        , 			C.VENDORNM
        , 			CONVERT(INT, A.GOOD_INVENTORY_CNT) AS GOOD_INVENTORY_CNT
        , 			CONVERT(VARCHAR(16), A.REGIST_DATE, 120) AS REGIST_DATE
        FROM		MCGOODVENDOR_HIST A WITH(NOLOCK) 
        ,			MCGOOD B WITH(NOLOCK) 
        ,			SMPVENDORS C WITH(NOLOCK) 
        WHERE B.GOOD_TYPE = '30'
        AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND A.VENDORID = C.VENDORID
        AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        AND A.VENDORID = #{srcVendorId}
        ) AA 
        WHERE 1=1
    </sql>



    <select id="selectBuyProductSearchByAdmCnt" resultType="int">
        /* product."selectBuyProductSearchByAdmCnt" */
        WITH CATEINFO ( CATE_ID)
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT MASTER.cate_id
        FROM mccategorymaster MASTER WITH(NOLOCK) 
        , CATEINFO WITH(NOLOCK) 
        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT COUNT(*)
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ORDER BY
        DISPGOOD.areatype , DISPGOOD.groupid DESC, DISPGOOD.clientid DESC ,
        DISPGOOD.branchid DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , goodvendor.good_spec_desc AS good_spec_desc
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , goodvendor.deli_mini_day AS stand_order_date
        FROM
        (
        SELECT DISTINCT B.CATE_ID AS CATE_ID
        FROM mccategoryborg A WITH(NOLOCK) 
        , mcdisplaycategory B WITH(NOLOCK) 
        WHERE A.cate_disp_id = B.cate_disp_id
        AND
        (
        ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid =
        #{branchid} )
        OR ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid
        = '0' )
        OR ( A.groupid = #{groupid} AND A.clientid = '0' AND A.branchid = '0' )
        )
        ) DISPCATE
        , CATEINFO
        , mcgood GOOD
        , mcdisplaygood DISPGOOD
        , mcgoodvendor goodvendor
        , SMPBORGS BORGS
        WHERE DISPCATE.CATE_ID = CATEINFO.CATE_ID
        AND goodvendor.isUse = '1'
        AND CATEINFO.CATE_ID = GOOD.cate_id
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND GOODVENDOR.VENDORID = BORGS.BORGID
        AND
        (
        (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid} AND
        DISPGOOD.branchid = #{branchid} )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid}
        AND DISPGOOD.branchid = '0' )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        OR (DISPGOOD.groupid = '0' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        )
        AND DISPGOOD.final_good_sts = '1'
        <if test="srcProductName != null and srcProductName != ''">
            AND GOOD.good_name like #{srcProductName}+'%'
        </if>
        <if test="srcProductCode != null and srcProductCode != ''">
            AND GOOD.good_iden_numb like #{srcProductCode}+'%'
        </if>
        ) TBL
        WHERE TBL.DISPLEV = 1
    </select>

    <select id="selectBuyProductSearchByAdmList" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuyProductSearchByAdmList*/

        WITH CATEINFO ( CATE_ID)
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT MASTER.cate_id
        FROM mccategorymaster MASTER WITH(NOLOCK) 
        , CATEINFO
        WHERE CATEINFO.cate_id = MASTER.ref_cate_seq
        )
        SELECT DISPLEV
        , disp_good_id
        , good_name
        , good_iden_numb
        , BORGNM
        , good_spec_desc
        , small_img_path
        , orde_clas_code
        , sell_price
        , ord_unlimit_quan
        , ord_quan
        , total_amout
        , stand_order_date
        , isdisppastgood
        , good_inventory_cnt
        , good_clas_code
        , deli_mini_day
        FROM
        (
        SELECT DENSE_RANK () OVER ( PARTITION BY DISPGOOD.good_iden_numb ORDER BY
        DISPGOOD.groupid DESC, DISPGOOD.clientid DESC , DISPGOOD.branchid
        DESC) AS DISPLEV
        , DISPGOOD.disp_good_id AS disp_good_id
        , GOOD.good_name AS good_name
        , GOOD.good_iden_numb AS good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , ISNULL(goodvendor.good_spec_desc , '') AS good_spec_desc
        , goodvendor.small_img_path AS small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , DISPGOOD.sell_price AS sell_price
        , goodvendor.deli_mini_quan as ord_unlimit_quan
        , goodvendor.deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,goodvendor.deli_mini_quan) AS total_amout
        , goodvendor.deli_mini_day AS stand_order_date
        , GOOD.isdisppastgood
        , goodvendor.good_inventory_cnt
        , GOOD.GOOD_TYPE AS good_clas_code
        , convert(varchar , DATEADD(D, goodvendor.deli_mini_day , CONVERT(DATETIME, getdate() )) , 23 ) as deli_mini_day
        FROM
        (
        SELECT DISTINCT B.CATE_ID AS CATE_ID
        FROM mccategoryborg A WITH(NOLOCK) 
        , mcdisplaycategory B WITH(NOLOCK) 
        WHERE A.cate_disp_id = B.cate_disp_id
        AND
        (
        ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid =
        #{branchid} )
        OR ( A.groupid = #{groupid} AND A.clientid = #{clientid} AND A.branchid
        = '0' )
        OR ( A.groupid = #{groupid} AND A.clientid = '0' AND A.branchid = '0' )
        )
        ) DISPCATE
        , CATEINFO
        , mcgood GOOD
        , mcdisplaygood DISPGOOD
        , mcgoodvendor goodvendor
        , SMPBORGS BORGS
        WHERE DISPCATE.CATE_ID = CATEINFO.CATE_ID
        AND CATEINFO.CATE_ID = GOOD.cate_id
        AND GOOD.good_iden_numb = DISPGOOD.good_iden_numb
        AND DISPGOOD.VENDORID = goodvendor.VENDORID
        AND DISPGOOD.GOOD_IDEN_NUMB = goodvendor.GOOD_IDEN_NUMB
        AND GOODVENDOR.VENDORID = BORGS.BORGID
        AND
        (
        (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid} AND
        DISPGOOD.branchid = #{branchid} )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = #{clientid}
        AND DISPGOOD.branchid = '0' )
        OR (DISPGOOD.groupid = #{groupid} AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        OR (DISPGOOD.groupid = '0' AND DISPGOOD.clientid = '0' AND
        DISPGOOD.branchid = '0')
        )
        AND DISPGOOD.final_good_sts = '1'
        <if test="srcProductName != null and srcProductName != ''">
            AND GOOD.good_name like #{srcProductName}+'%'
        </if>
        <if test="srcProductCode != null and srcProductCode != ''">
            AND GOOD.good_iden_numb like #{srcProductCode}+'%'
        </if>
        ) TBL
        WHERE TBL.DISPLEV = 1
        <if test="orderString != null and orderString > '   ' ">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectVenProductListCnt" resultType="int">
        /* product.selectVenProductListCnt */
        WITH TMP_TABLE
        (
        cate_id
        , majo_code_name
        , LEV
        , FULL_CATE_NAME
        ) AS
        (
        SELECT cate_id
        , majo_code_name
        , CONVERT (INT , CATE_LEVEL ) AS LEV
        , CONVERT (VARCHAR(255) , '' )
        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
        WHERE CATE_ID = 0
        UNION ALL
        SELECT OL.cate_id
        , OL.majo_code_name
        , CTE.LEV+1
        , CONVERT (VARCHAR(255) , CASE WHEN CTE.LEV+1 = 1 THEN
        OL.majo_code_name ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
        END )
        FROM mccategorymaster OL WITH(NOLOCK) 
        , TMP_TABLE CTE
        WHERE OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT COUNT(1)
        <include refid="selectVenProductListSql" />
    </select>

    <select id="selectVenProductList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectVenProductList */
        WITH TMP_TABLE
        (
        cate_id
        , majo_code_name
        , LEV
        , FULL_CATE_NAME
        ) AS
        (
        SELECT cate_id
        , majo_code_name
        , CONVERT (INT , CATE_LEVEL ) AS LEV
        , CONVERT (VARCHAR(1024) , '' )
        FROM mccategorymaster MASTERCATE WITH(NOLOCK) 
        WHERE CATE_ID = 0
        UNION ALL
        SELECT OL.cate_id
        , OL.majo_code_name
        , CTE.LEV+1
        , CONVERT (VARCHAR(1024) , CASE WHEN CTE.LEV+1 = 1 THEN
        OL.majo_code_name ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name
        END )
        FROM mccategorymaster OL WITH(NOLOCK) 
        , TMP_TABLE CTE
        WHERE OL.REF_CATE_SEQ = CTE.CATE_ID
        )
        SELECT GOODVEN.GOOD_IDEN_NUMB
        , CATEGORY.FULL_CATE_NAME
        , GOOD.GOOD_NAME
        , GOODVEN.VENDORID
        , GOODVEN.REQ_GOOD_ID
        , GOODVEN.SALE_UNIT_PRIC
        , GOODVEN.GOOD_ST_SPEC_DESC
        , GOODVEN.GOOD_SPEC_DESC
        , GOOD.ORDER_UNIT AS ORDE_CLAS_CODE
        , GOODVEN.DELI_MINI_DAY
        , GOODVEN.DELI_MINI_QUAN
        , GOODVEN.MAKE_COMP_NAME
        , GOODVEN.GOOD_SAME_WORD
        , GOODVEN.ORIGINAL_IMG_PATH
        , GOODVEN.LARGE_IMG_PATH
        , GOODVEN.MIDDLE_IMG_PATH
        , GOODVEN.SMALL_IMG_PATH
        , GOODVEN.GOOD_DESC
        , GOODVEN.ISSUB_ONTRACT
        , GOOD.GOOD_TYPE AS GOOD_CLAS_CODE
        , CONVERT(INT, ISNULL(GOODVEN.GOOD_INVENTORY_CNT, 0)) AS GOOD_INVENTORY_CNT --재고량 조회
<!--         추가 -->
        <!-- , CONVERT(INT, GOODVEN.GOOD_INVENTORY_CNT) AS GOOD_INVENTORY_CNT -->
        , CONVERT(VARCHAR(10), GOODVEN.REGIST_DATE, 120) AS REGIST_DATE
        , GOODVEN.ISUSE
        , GOODVEN.ORIGINAL_IMG_PATH
        , ISNULL((SELECT A.USERNM+'
        ('+A.TEL+')' FROM SMPUSERS A  WITH(NOLOCK) WHERE A.USERID = GOOD.PRODUCT_MANAGER), '') AS PRODUCT_MANAGER
        <include refid="selectVenProductListSql" />
    </select>

    <sql id="selectVenProductListSql">
        FROM MCGOODVENDOR GOODVEN WITH(NOLOCK) 
        , MCGOOD GOOD WITH(NOLOCK) 
        , TMP_TABLE CATEGORY
        WHERE GOODVEN.GOOD_IDEN_NUMB = GOOD.GOOD_IDEN_NUMB
        AND GOOD.CATE_ID = CATEGORY.CATE_ID
        <!-- AND GOODVEN.ISUSE = '1' -->
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND GOODVEN.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="srcGoodName != null and srcGoodName != ''">
            AND GOOD.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <if test="srcRegistStartDate != null and srcRegistStartDate != ''">
            <if test="srcRegistEndDate != null and srcRegistEndDate != ''">
                AND GOODVEN.REGIST_DATE BETWEEN CONVERT(DATETIME,
                #{srcRegistStartDate}) AND DATEADD(D,1,CONVERT(DATETIME,
                #{srcRegistEndDate}))
            </if>
        </if>
        <if test="srcGoodSpecDesc != null and srcGoodSpecDesc != ''">
            AND (GOODVEN.GOOD_SPEC_DESC LIKE '%${srcGoodSpecDesc}%' OR
            GOODVEN.GOOD_ST_SPEC_DESC LIKE '%${srcGoodSpecDesc}%' )
        </if>
        <if test="srcGoodSameWord != null and srcGoodSameWord != ''">
            AND GOODVEN.GOOD_SAME_WORD LIKE '%${srcGoodSameWord}%'
        </if>
        <if test="srcGoodClasCode != null and srcGoodClasCode != ''">
            AND GOOD.GOOD_TYPE = #{srcGoodClasCode}
        </if>
        <if
            test="srcVendorId != null and srcVendorId != '' and srcVendorId neq '0'.toString() ">
            AND GOODVEN.VENDORID = '${srcVendorId}'
        </if>
        <if test="srcIsUse != null and srcIsUse != ''">
            AND GOODVEN.ISUSE = #{srcIsUse}
        </if>
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </sql>

    <select id="selectProductRequestRegistListCnt" resultType="int">
        /* product.selectProductRequestRegistListCnt */
        SELECT COUNT(1)
        <include refid="selectProductRequestRegistListSql" />
    </select>

    <select id="selectProductRequestRegistList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /* product.selectProductRequestRegistList */
        SELECT A.REQ_GOOD_ID
        , A.GOOD_IDEN_NUMB
        , A.VENDORID
        , A.GOOD_NAME
        , A.SALE_UNIT_PRIC
        , A.GOOD_ST_SPEC_DESC
        , A.GOOD_SPEC_DESC
        , A.ORDE_CLAS_CODE
        , A.DELI_MINI_DAY
        , A.DELI_MINI_QUAN
        , A.MAKE_COMP_NAME
        , A.GOOD_SAME_WORD
        , A.ORIGINAL_IMG_PATH
        , A.LARGE_IMG_PATH
        , A.MIDDLE_IMG_PATH
        , A.SMALL_IMG_PATH
        , A.GOOD_DESC
        , A.GOOD_CLAS_CODE
        , A.GOOD_INVENTORY_CNT
        , A.INSERT_USER_ID
        , CONVERT(VARCHAR(10), INSERT_DATE, 120) AS INSERT_DATE
        , (CASE WHEN LEN(A.GOOD_DESC)>30 THEN 'Y' ELSE '' END) AS DESC_YN
        <choose>
        	<when test="isExcel != null and isExcel = '1'">
        , (	CASE A.APP_STS		WHEN '0' THEN '요청'
        							WHEN '2' THEN '승인_처리완료'
        							WHEN '3' THEN '반려'
        	END
        	)as APP_STS
        	</when>
        	<otherwise>
        , A.APP_STS  
        	</otherwise>
        </choose>
        , A.ADMIN_USER_ID
        , A.APP_USER_ID
        , CONVERT(VARCHAR(10), APP_DATE, 120) AS APP_DATE
        , CONVERT(VARCHAR(10), CREATE_GOOD_DATE, 120) AS CREATE_GOOD_DATE
        , B.VENDORNM
        , C.CODENM1 AS GOOD_CLAS_NAME
        <include refid="selectProductRequestRegistListSql" />
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <sql id="selectProductRequestRegistListSql">
        FROM MCGOODREQUEST A WITH(NOLOCK) 
        ,		SMPVENDORS B WITH(NOLOCK)
        ,    SMPCODES      C WITH(NOLOCK)

        <trim prefix="WHERE" prefixOverrides="AND |OR ">
        	AND C.CODETYPECD     = 'ORDERGOODSTYPE'
        	AND A.GOOD_CLAS_CODE = C.CODEVAL1 
            <if
                test="srcVendorId != null and srcVendorId != '' and srcVendorId  neq '0'.toString() ">
                AND A.VENDORID = #{srcVendorId}
            </if>
            <if test="srcGoodName != null and srcGoodName != ''">
                AND A.GOOD_NAME LIKE '%${srcGoodName}%'
            </if>
            <if test="srcInsertStartDate != null and srcInsertStartDate != ''">
                <if test="srcInsertEndDate != null and srcInsertEndDate != ''">
                    AND A.INSERT_DATE BETWEEN CONVERT(DATETIME,
                    #{srcInsertStartDate}) AND DATEADD(D,1,CONVERT(DATETIME,
                    #{srcInsertEndDate}))
                </if>
            </if>
            <if test="srcGoodSpecDesc != null and srcGoodSpecDesc != ''">
                AND (A.GOOD_SPEC_DESC LIKE '%${srcGoodSpecDesc}%' OR
                GOOD_ST_SPEC_DESC LIKE '%${srcGoodSpecDesc}%')
            </if>
            <if test="srcAdminUserId != null and srcAdminUserId != ''">
                AND A.ADMIN_USER_ID = #{srcAdminUserId}
            </if>
            <if test="srcAppSts != null and srcAppSts != ''">
                AND A.APP_STS = #{srcAppSts}
            </if>
            <if test="srcFixAppSts != null and srcFixAppSts != ''">
                AND A.APP_STS = #{srcFixAppSts}
            </if>
            AND A.VENDORID = B.VENDORID
        </trim>
    </sql>


    <update id="updateProductCategory">
        /* product.updateProductCategory */
        update mcgood
        set
        cate_id = #{categortId}
        where good_iden_numb = #{good_iden_numb}
    </update>


    <sql id="selectBuySearchProductListSql">
        WITH CATEINFO
        AS
        (
        SELECT CATE_ID
        FROM mccategorymaster WITH(NOLOCK) 
        WHERE CATE_ID = #{srcCateId}
        UNION ALL
        SELECT A.cate_id
        FROM mccategorymaster A WITH(NOLOCK) 
        INNER JOIN CATEINFO B WITH(NOLOCK) 
        ON B.cate_id = A.ref_cate_seq
        ), CTE_TABLE
        AS
        (
        SELECT A.good_iden_numb
        , A.good_name
        <choose>
            <when test="isExcel != null and isExcel == 1">
                , ISNULL('[' + DBO.FNS_SPLIT_PROD_SPEC('Ø,W,D,H,L,t'
                ,B.good_st_spec_desc, '‡') + ']','') + ' '
                +
                ISNULL(DBO.FNS_SPLIT_PROD_SPEC(',재질,크기,총중량(할증포함),색상,type,실중량kg,m(미터)'
                ,B.good_spec_desc, '‡'),'') AS GOOD_SPEC_DESC
            </when>
            <otherwise>
                , B.good_st_spec_desc
                , B.good_spec_desc
            </otherwise>
        </choose>
        , B.vendorid
        , D.BORGNM AS VENDORNM
        , B.vendor_priority
        , C.disp_good_id
        <choose>
            <when test="isExcel != null and isExcel == 1">
                , dbo.FNS_CODENM1BYCODEVAL1('ORDERGOODSTYPE',A.GOOD_TYPE) as good_clas_code
            </when>
            <otherwise>
                , A.GOOD_TYPE AS good_clas_code
            </otherwise>
        </choose>
        , B.small_img_path
        , B.original_img_path
        , A.ORDER_UNIT AS orde_clas_code
        , C.sell_price
        , B.deli_mini_quan as ord_quan
        , B.deli_mini_quan
        , B.good_same_word
        , ROW_NUMBER() OVER (PARTITION BY B.good_iden_numb ORDER BY B.vendor_priority DESC, NEWID()) AS RANKING
        , A.cate_id
        , CONVERT(varchar, CONVERT(int,B.good_inventory_cnt)) AS good_inventory_cnt
        , B.the_day_post
        , ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA  WITH(NOLOCK) WHERE AA.USERID = A.PRODUCT_MANAGER), '') AS PRODUCT_MANAGER
        , A.isDistribute
        , A.is_add_good
        FROM mcgood A WITH(NOLOCK) 
        INNER JOIN mcgoodvendor B WITH(NOLOCK) 
        	ON A.good_iden_numb = B.good_iden_numb
        	AND B.isUse = '1'
        INNER JOIN (
        	SELECT C2.*
        	FROM (
        		SELECT C1.*
        		, ROW_NUMBER() OVER(PARTITION BY C1.GOOD_IDEN_NUMB, C1.VENDORID ORDER BY C1.BRANCHID DESC, C1.CLIENTID DESC, C1.GROUPID DESC, C1.areaType ASC) AS DISP_RANK
        FROM	mcdisplaygood C1 WITH(NOLOCK) 
        WHERE (
        ( C1.groupid = #{loginUserDto.groupId} AND C1.clientid =
        #{loginUserDto.clientId} AND C1.branchid = #{loginUserDto.borgId} )
        OR ( C1.groupid = #{loginUserDto.groupId} AND C1.clientid =
        #{loginUserDto.clientId} AND C1.branchid = '0' )
        OR ( C1.groupid = #{loginUserDto.groupId} AND C1.clientid = '0' AND
        C1.branchid = '0' )
        OR ( C1.groupid = '0' AND C1.clientid = '0' AND C1.branchid = '0')
        )
        AND C1.areaType IN ('99', #{loginUserDto.areaType})
        AND C1.final_good_sts = '1'
        ) C2
        WHERE C2.DISP_RANK = 1
        ) C
        ON B.good_iden_numb = C.good_iden_numb
        AND B.vendorid = C.vendorid
        INNER JOIN SMPBORGS D WITH(NOLOCK) 
        	ON B.vendorid = D.BORGID
        AND D.ISUSE = '1'
        INNER JOIN (
	        SELECT DISTINCT
	        B.cate_id
	        FROM mccategoryborg A WITH(NOLOCK) 
	        INNER JOIN mcdisplaycategory B WITH(NOLOCK) 
	        	ON A.cate_disp_id = B.cate_disp_id
	        INNER JOIN CATEINFO C WITH(NOLOCK) 
	        	ON B.CATE_ID = C.cate_id
	        WHERE (
	        ( A.groupid = #{loginUserDto.groupId} AND A.clientid =
	        #{loginUserDto.clientId} AND A.branchid = #{loginUserDto.borgId} )
	        OR ( A.groupid = #{loginUserDto.groupId} AND A.clientid =
	        #{loginUserDto.clientId} AND A.branchid = '0' )
	        OR ( A.groupid = #{loginUserDto.groupId} AND A.clientid = '0' AND
	        A.branchid = '0' )
	        )
        ) E
        ON A.cate_id = E.cate_id
        WHERE 1 = 1
        <if test="srcGoodName != null and srcGoodName != ''">
            AND (A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%' OR B.GOOD_SPEC_DESC LIKE
            '%'+#{srcGoodName}+'%' OR B.GOOD_ST_SPEC_DESC LIKE
            '%'+#{srcGoodName}+'%' OR B.GOOD_SAME_WORD LIKE
            '%'+#{srcGoodName}+'%')
        </if>
        <if test="srcGoodIdenNumb != null and srcGoodIdenNumb != ''">
            AND A.good_iden_numb like #{srcGoodIdenNumb}+'%'
        </if>
        <if test="srcGoodSpecDesc != null and srcGoodSpecDesc != ''">
            AND ((B.good_st_spec_desc like '%'+ #{srcGoodSpecDesc} +'%') or
            (B.good_spec_desc like '%'+ #{srcGoodSpecDesc} +'%'))
        </if>
        <if test="srcGoodSameWord != null and srcGoodSameWord != ''">
            AND (B.GOOD_SAME_WORD LIKE '%'+#{srcGoodSameWord}+'%' OR A.GOOD_NAME
            LIKE '%'+#{srcGoodSameWord}+'%' OR B.GOOD_SPEC_DESC LIKE
            '%'+#{srcGoodSameWord}+'%' OR B.GOOD_ST_SPEC_DESC LIKE
            '%'+#{srcGoodSameWord}+'%')
        </if>
        <if test="srcVendorNm != null and srcVendorNm != ''">
            AND D.BORGNM LIKE '%'+#{srcVendorNm}+'%'
        </if>
        <if test="srcGoodClasCode != null and  srcGoodClasCode != ''">
            AND A.GOOD_TYPE = #{srcGoodClasCode}
        </if>
        )
    </sql>
    <select id="selectBuySearchProductList_count" resultType="int">
        /* product.selectBuySearchProductList_count */
        <include refid="selectBuySearchProductListSql" />
        SELECT COUNT(1) FROM CTE_TABLE WHERE RANKING = 1
    </select>
    <select id="selectBuySearchProductList" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /* product.selectBuySearchProductList */
        <include refid="selectBuySearchProductListSql" />
        <choose>
            <when test="isExcel == null or isExcel != 1">
                SELECT BBBB.*
                , AAAA.VENDORID_STRING
                , AAAA.VENDORNM_STRING
                FROM CTE_TABLE BBBB
                INNER JOIN (
                SELECT AAA.good_iden_numb
                , MAX(VENDORID_1) AS VENDORID_1
                ,
                MAX(VENDORID_1)+MAX(VENDORID_2)+MAX(VENDORID_3)+MAX(VENDORID_4)+MAX(VENDORID_5)+MAX(VENDORID_6)+MAX(VENDORID_7)+MAX(VENDORID_8)+MAX(VENDORID_9)
                AS VENDORID_STRING
                ,
                MAX(VENDORNM_1)+MAX(VENDORNM_2)+MAX(VENDORNM_3)+MAX(VENDORNM_4)+MAX(VENDORNM_5)+MAX(VENDORNM_6)+MAX(VENDORNM_7)+MAX(VENDORNM_8)+MAX(VENDORNM_9)
                AS VENDORNM_STRING
                FROM
                (
                SELECT AA.good_iden_numb
                , (CASE WHEN AA.RANKING=1 THEN AA.vendorid ELSE '' END) AS VENDORID_1
                , (CASE WHEN AA.RANKING=2 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_2
                , (CASE WHEN AA.RANKING=3 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_3
                , (CASE WHEN AA.RANKING=4 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_4
                , (CASE WHEN AA.RANKING=5 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_5
                , (CASE WHEN AA.RANKING=6 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_6
                , (CASE WHEN AA.RANKING=7 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_7
                , (CASE WHEN AA.RANKING=8 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_8
                , (CASE WHEN AA.RANKING=9 THEN '|'+AA.vendorid ELSE '' END) AS
                VENDORID_9
                , (CASE WHEN AA.RANKING=1 THEN AA.VENDORNM ELSE '' END) AS VENDORNM_1
                , (CASE WHEN AA.RANKING=2 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_2
                , (CASE WHEN AA.RANKING=3 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_3
                , (CASE WHEN AA.RANKING=4 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_4
                , (CASE WHEN AA.RANKING=5 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_5
                , (CASE WHEN AA.RANKING=6 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_6
                , (CASE WHEN AA.RANKING=7 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_7
                , (CASE WHEN AA.RANKING=8 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_8
                , (CASE WHEN AA.RANKING=9 THEN '|'+AA.VENDORNM ELSE '' END) AS
                VENDORNM_9
                FROM CTE_TABLE AA
                ) AAA
                GROUP BY AAA.GOOD_IDEN_NUMB
                ) AAAA
                ON BBBB.good_iden_numb = AAAA.good_iden_numb
                AND BBBB.vendorid = AAAA.VENDORID_1
                <!-- 구매사 상품 품목별 교차형태로 조회할 수 있도록 수정 -->
                ORDER BY GOOD_NAME DESC, GOOD_SPEC_DESC, VENDORNM DESC
            </when>
            <otherwise>
                SELECT * FROM CTE_TABLE
            </otherwise>
        </choose>
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectBuySearchProductCombo" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /*
        product.selectBuySearchProductCombo */
        SELECT TOP 1
        A.good_st_spec_desc
        , A.good_spec_desc
        , A.vendorid
        , C.BORGNM AS VENDORNM
        , B.disp_good_id
        , (SELECT Z.GOOD_TYPE FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS good_clas_code
        , A.small_img_path
        , A.original_img_path
        , (SELECT Z.ORDER_UNIT FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS orde_clas_code
        , B.sell_price
        , A.deli_mini_quan as ord_quan
        , A.deli_mini_quan
        , A.good_same_word
        , A.the_day_post
        , CONVERT(varchar,
        CONVERT(int, A.good_inventory_cnt)) AS good_inventory_cnt
        FROM
        mcgoodvendor A WITH(NOLOCK) 
        INNER JOIN mcdisplaygood B WITH(NOLOCK) 
        	ON A.good_iden_numb = B.good_iden_numb
        	AND A.vendorid = B.vendorid
        INNER JOIN SMPBORGS C WITH(NOLOCK) 
        	ON A.vendorid = C.BORGID
        	AND C.ISUSE = '1'
        WHERE A.isUse = '1'
        AND B.final_good_sts = '1'
        AND
        A.good_iden_numb = #{good_iden_numb}
        AND A.vendorid = #{vendorid}
        AND (
        ( B.groupid = #{loginUserDto.groupId} AND B.clientid =
        #{loginUserDto.clientId} AND B.branchid = #{loginUserDto.borgId} )
        OR ( B.groupid = #{loginUserDto.groupId} AND B.clientid =
        #{loginUserDto.clientId} AND B.branchid = '0' )
        OR ( B.groupid = #{loginUserDto.groupId} AND B.clientid = '0' AND
        B.branchid = '0' )
        OR ( B.groupid = '0' AND B.clientid = '0' AND B.branchid = '0')
        )
        AND
        B.areaType IN ('99', #{loginUserDto.areaType})
        ORDER BY B.areaType
    </select>

    <insert id="insertMcGoodHist">
        /** insert.insertMcGoodHist**/
        INSERT INTO MCGOOD_HIST(
        		GOOD_HIST_ID
        , 		GOOD_IDEN_NUMB
        , 		GOOD_NAME
        , 		VTAX_CLAS_CODE
        , 		SALE_CRITERION_TYPE
        ,		STAN_BUYING_RATE
        , 		STAN_BUYING_MONEY
        , 		ISDISTRIBUTE
        , 		ISDISPPASTGOOD
        ,		INSERT_DATE
        , 		CATE_ID
        , 		INSERT_USER_ID
        )		
        SELECT 	#{id} AS GOOD_HIST_ID
        , 		GOOD_IDEN_NUMB
        , 		GOOD_NAME
        , 		VTAX_CLAS_CODE
        , 		SALE_CRITERION_TYPE
        ,		STAN_BUYING_RATE
        , 		STAN_BUYING_MONEY
        , 		ISDISTRIBUTE
        , 		ISDISPPASTGOOD
        ,		GETDATE() AS INSERT_DATE
        , 		CATE_ID
        , 		INSERT_USER_ID
        FROM 	MCGOOD WITH(NOLOCK) 
        WHERE	good_iden_numb = #{good_iden_numb}
    </insert>

    <select id="selectProductMcgoodSearchList_count" resultType="int">
        /** product.selectProductMcgoodSearchList_count **/
        SELECT COUNT(1)
        <include refid="selectProductMcgoodSearch" />
    </select>

    <select id="selectProductMcgoodSearchList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /** product.selectProductMcgoodSearchList **/
        SELECT (CASE A.REPRE_GOOD
        WHEN 'Y' THEN '옵션' ELSE '단품' END) AS cate_Id
        , A.GOOD_IDEN_NUMB AS good_Iden_Numb
        , A.GOOD_NAME AS good_Name
        ,
        A.GOOD_SPEC AS good_Spec_Desc
        , B.SMALL_IMG_PATH AS small_Img_Path
        <include refid="selectProductMcgoodSearch" />
    </select>

    <sql id="selectProductMcgoodSearch">
        FROM MCGOOD A WITH(NOLOCK) 
        INNER JOIN (
	        SELECT GOOD_IDEN_NUMB AS GOOD_IDEN_NUMB
	        , MAX(SMALL_IMG_PATH) AS SMALL_IMG_PATH
        FROM MCGOODVENDOR WITH(NOLOCK) 
        <!-- <if test="division eq '2'.toString()"> -->
        <!-- WHERE ISUSE = '0' -->
        <!-- </if> -->
        GROUP BY GOOD_IDEN_NUMB
        ) B
        ON A.good_iden_numb = B.good_iden_numb
        <!-- INNER JOIN ( -->
        <!-- SELECT COUNT(GOOD_IDEN_NUMB) AS GOOD_IDEN_NUMB_CNT -->
        <!-- , GOOD_IDEN_NUMB AS GOOD_IDEN_NUMB -->
        <!-- FROM MCGOOD_HIST -->
        <!-- GROUP BY GOOD_IDEN_NUMB -->
        <!-- ) C -->
        <!-- ON A.GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB -->
        WHERE 1=1
        <!-- <if test="division eq '1'.toString()"> -->
        <!-- AND C.GOOD_IDEN_NUMB_CNT = 1 -->
        <!-- </if> -->
        <!-- <if test="division eq '3'.toString()"> -->
        <!-- AND C.GOOD_IDEN_NUMB_CNT > 1 -->
        <!-- </if> -->
        <if test="goodIdenNumb != null and goodIdenNumb != ''">
            AND A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        </if>
        <if test="goodName != null and goodName != ''">
            AND A.GOOD_NAME LIKE '%'+#{goodName}+'%'
        </if>
        <if
            test="(productHistoryStartDate != null and  productHistoryStartDate != '') and  (productHistoryEndDate != null and  productHistoryEndDate != '')">
            AND A.INSERT_DATE BETWEEN CONVERT(DATETIME,#{productHistoryStartDate})
            AND CONVERT(DATETIME,#{productHistoryEndDate}+' 23:59:59')
        </if>
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </sql>

    <select id="selectMcdisplayGoodList_count" resultType="int">
        /**
        product.selectMcdisplayGoodList_count **/
        SELECT COUNT(1)
        FROM MCDISPLAYGOOD A WITH(NOLOCK) 
        INNER JOIN SMPVENDORS B WITH(NOLOCK) 
        	ON A.VENDORID = B.VENDORID
        INNER JOIN SMPCODES C WITH(NOLOCK) 
        	ON A.AREATYPE = C.CODEVAL1
        	AND C.CODETYPECD = 'DELI_AREA_CODE'
        WHERE 1=1
        AND A.GOOD_IDEN_NUMB =
        #{goodIdenNumb}
    </select>

    <select id="selectMcdisplayGoodList" resultType="kr.co.bitcube.product.dto.ProductDto">
        /** product.selectMcdisplayGoodList **/
        SELECT CONVERT(VARCHAR(16),
        A.DISP_FROM_DATE, 120) AS disp_From_Date --변경일시
        , CONVERT(VARCHAR(16),
        A.CONT_FROM_DATE, 120) AS cont_From_Date --계약일시
        , CONVERT(VARCHAR(16),
        A.CONT_TO_DATE, 120) AS cont_To_Date --계약종료일
        , A.SEll_PRICE AS
        sell_Price --판매가
        , C.CODENM1 AS codeNm --권역명
        , B.VENDORNM AS vendorNm
        --공급사
        , A.FINAL_GOOD_STS AS finalGoodSts
        , D.USERNM AS insert_User_Nm
        ,
        E.USERNM AS tranUserNm
        FROM MCDISPLAYGOOD A WITH(NOLOCK) 
        INNER JOIN SMPVENDORS B WITH(NOLOCK) 
        	ON A.VENDORID = B.VENDORID
        INNER JOIN SMPCODES C WITH(NOLOCK) 
        	ON A.AREATYPE = C.CODEVAL1
        	AND C.CODETYPECD = 'DELI_AREA_CODE'
        LEFT OUTER JOIN SMPUSERS D WITH(NOLOCK) 
        	ON A.INSERT_USER_ID = D.USERID
        LEFT OUTER JOIN SMPUSERS E WITH(NOLOCK) 
        	ON A.TRAN_USER_ID = E.USERID
        WHERE 1=1
        AND A.GOOD_IDEN_NUMB =
        #{goodIdenNumb}
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectProductManager" resultType="java.util.HashMap">
        /*
        product.selectProductManager*/
        SELECT B.USERID
        , B.USERNM
        FROM(
	        SELECT PRODUCT_MANAGER
	        FROM MCGOOD WITH(NOLOCK) 
	        WHERE ISNULL(PRODUCT_MANAGER,'') != ''
	        GROUP BY PRODUCT_MANAGER
        )A
        INNER JOIN SMPUSERS B WITH(NOLOCK) 
        ON A.PRODUCT_MANAGER = B.USERID
    </select>

    <select id="selectBuyWishListCnt2" resultType="int">
        /*
        product.selectBuyWishListCnt*/
        SELECT SUM(A.CNT) AS CNT
        FROM(
        SELECT COUNT(1) AS CNT
        FROM mrborgusergood USERGOOD WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        , mcgoodvendor GOODVENDOR WITH(NOLOCK) 
        , mcgood GOOD WITH(NOLOCK) 
        , SMPBORGS BORGS WITH(NOLOCK) 
        , DBO.FNS_DISP_GOODINFO_FOR_ADMIN(#{groupid} ,#{clientid} ,
        #{branchid}) DISPINFO
        WHERE USERGOOD.disp_good_id = DISPGOOD.disp_good_id
        AND DISPGOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND DISPGOOD.vendorid = GOODVENDOR.vendorid
        AND GOODVENDOR.good_iden_numb = GOOD.good_iden_numb
        AND GOODVENDOR.vendorid = BORGS.BORGID
        AND DISPGOOD.good_iden_numb = DISPINFO.good_iden_numb
        AND DISPGOOD.vendorid = DISPINFO.vendorid
        AND GOODVENDOR.ISUSE = '1'
        AND USERGOOD.GROUPID = #{groupid}
        AND USERGOOD.CLIENTID = #{clientid}
        AND USERGOOD.BRANCHID = #{branchid}
        AND DISPGOOD.final_good_sts = 1
        UNION ALL
        SELECT COUNT(1) AS CNT
        FROM (
        SELECT B.*
        FROM(
        SELECT CASE
        WHEN A.disp_good_id IS NULL OR A.disp_good_id = ''
        THEN(
        SELECT AA.DISP_GOOD_ID
        FROM MCDISPLAYGOOD AA WITH(NOLOCK) 
        WHERE AA.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
        AND AA.VENDORID = A.VENDORID
        AND AA.FINAL_GOOD_STS = '1'
        AND AA.AREATYPE = '99'
        )
        END DISP_GOOD_ID
        FROM(
        SELECT CASE
        WHEN B.FINAL_GOOD_STS = 0
        THEN (
        SELECT DISP_GOOD_ID
        FROM MCDISPLAYGOOD AA WITH(NOLOCK) 
        WHERE AA.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND AA.VENDORID = B.VENDORID
        AND AA.FINAL_GOOD_STS = '1'
        AND AA.areaType = B.areaType
        )
        END DISP_GOOD_ID
        , B.GOOD_IDEN_NUMB
        , B.VENDORID
        FROM MRBORGUSERGOOD A WITH(NOLOCK) 
        INNER JOIN MCDISPLAYGOOD B WITH(NOLOCK) 
        	ON A.disp_good_id = B.disp_good_id
        WHERE 1=1
        AND A.GROUPID = #{groupid}
        AND A.CLIENTID = #{clientid}
        AND A.BRANCHID = #{branchid}
        AND B.FINAL_GOOD_STS = 0
        )A
        )AA
        INNER JOIN MCDISPLAYGOOD B
        ON AA.disp_good_id = B.disp_good_id
        WHERE AA.disp_good_id IS NOT NULL
        ) DISPGOOD
        , mcgoodvendor GOODVENDOR
        , mcgood GOOD
        , SMPBORGS BORGS
        , DBO.FNS_DISP_GOODINFO_FOR_ADMIN(#{groupid} , #{clientid} ,
        #{branchid}) DISPINFO
        WHERE 1=1
        AND DISPGOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND DISPGOOD.vendorid = GOODVENDOR.vendorid
        AND GOODVENDOR.good_iden_numb = GOOD.good_iden_numb
        AND GOODVENDOR.vendorid = BORGS.BORGID
        AND DISPGOOD.good_iden_numb = DISPINFO.good_iden_numb
        AND DISPGOOD.vendorid = DISPINFO.vendorid
        AND GOODVENDOR.ISUSE = '1'
        AND DISPGOOD.final_good_sts = '1'
        )A
    </select>

    <select id="selectBuyWishList2" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /*
        product.selectBuyWishList2*/
        SELECT DISPGOOD.disp_good_id
        , GOOD.good_name
        , GOOD.good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , sell_price
        , deli_mini_quan as ord_unlimit_quan
        , deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        ,GOODVENDOR.deli_mini_quan) AS total_amout
        , CONVERT(VARCHAR(12) ,
        DATEADD(DAY , GOODVENDOR.deli_mini_day , GETDATE() ) , 23 ) AS
        stand_order_date
        , DISPGOOD.final_good_sts
        , DISPGOOD.vendorid
        ,
        DISPGOOD.areaType
        , DISPGOOD.DISP_GOOD_ID AS ORIGIN_DISP_GOOD_ID
        FROM
        mrborgusergood USERGOOD WITH(NOLOCK) 
        , mcdisplaygood DISPGOOD WITH(NOLOCK) 
        , mcgoodvendor GOODVENDOR WITH(NOLOCK) 
        , mcgood GOOD WITH(NOLOCK) 
        , SMPBORGS BORGS WITH(NOLOCK) 
        , DBO.FNS_DISP_GOODINFO_FOR_ADMIN(#{groupid} ,
        #{clientid} , #{branchid}) DISPINFO
        WHERE USERGOOD.disp_good_id =
        DISPGOOD.disp_good_id
        AND DISPGOOD.good_iden_numb =
        GOODVENDOR.good_iden_numb
        AND DISPGOOD.vendorid = GOODVENDOR.vendorid
        AND GOODVENDOR.good_iden_numb
        = GOOD.good_iden_numb
        AND GOODVENDOR.vendorid = BORGS.BORGID
        AND DISPGOOD.good_iden_numb = DISPINFO.good_iden_numb
        AND
        DISPGOOD.vendorid = DISPINFO.vendorid
        AND GOODVENDOR.ISUSE = '1'
        AND
        USERGOOD.GROUPID = #{groupid}
        AND USERGOOD.CLIENTID = #{clientid}
        AND
        USERGOOD.BRANCHID = #{branchid}
        AND DISPGOOD.final_good_sts = 1
        UNION
        ALL
        SELECT DISPGOOD.disp_good_id
        , GOOD.good_name
        , GOOD.good_iden_numb
        , BORGS.BORGNM AS BORGNM
        , good_st_spec_desc
        , good_spec_desc
        , small_img_path
        , GOOD.ORDER_UNIT AS orde_clas_code
        , sell_price
        , deli_mini_quan as ord_unlimit_quan
        , deli_mini_quan as ord_quan
        , CONVERT(NUMERIC(15 ,2) ,DISPGOOD.sell_price) *CONVERT(NUMERIC(15 ,2)
        , GOODVENDOR.deli_mini_quan) AS total_amout
        , CONVERT(VARCHAR(12) , DATEADD(DAY , GOODVENDOR.deli_mini_day , GETDATE() ) , 23 ) AS stand_order_date
        , DISPGOOD.final_good_sts
        , DISPGOOD.vendorid
        , DISPGOOD.areaType
        , DISPGOOD.ORIGIN_DISP_GOOD_ID
        FROM (
        SELECT B.*
        , AA.ORIGIN_DISP_GOOD_ID
        FROM(
        SELECT CASE
        WHEN A.disp_good_id IS NULL OR A.disp_good_id = ''
        THEN(
        SELECT AA.DISP_GOOD_ID
        FROM MCDISPLAYGOOD AA WITH(NOLOCK) 
        WHERE AA.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
        AND AA.VENDORID = A.VENDORID
        AND AA.FINAL_GOOD_STS = '1'
        AND AA.AREATYPE = '99'
        )
        END DISP_GOOD_ID
        , A.ORIGIN_DISP_GOOD_ID
        FROM(
        SELECT CASE
        WHEN B.FINAL_GOOD_STS = 0
        THEN (
        SELECT DISP_GOOD_ID
        FROM MCDISPLAYGOOD AA WITH(NOLOCK) 
        WHERE AA.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND AA.VENDORID = B.VENDORID
        AND AA.FINAL_GOOD_STS = '1'
        AND AA.areaType = B.areaType
        )
        END DISP_GOOD_ID
        , B.GOOD_IDEN_NUMB
        , B.VENDORID
        , A.DISP_GOOD_ID AS ORIGIN_DISP_GOOD_ID
        FROM MRBORGUSERGOOD A WITH(NOLOCK) 
        INNER JOIN MCDISPLAYGOOD B WITH(NOLOCK) 
        ON A.disp_good_id = B.disp_good_id
        WHERE 1=1
        AND A.GROUPID = #{groupid}
        AND A.CLIENTID = #{clientid}
        AND A.BRANCHID = #{branchid}
        AND B.FINAL_GOOD_STS = 0
        )A
        )AA
        INNER JOIN MCDISPLAYGOOD B
        ON AA.disp_good_id = B.disp_good_id
        WHERE AA.disp_good_id IS NOT NULL
        ) DISPGOOD
        , mcgoodvendor GOODVENDOR
        ,
        mcgood GOOD
        , SMPBORGS BORGS
        , DBO.FNS_DISP_GOODINFO_FOR_ADMIN(#{groupid} ,
        #{clientid} , #{branchid}) DISPINFO
        WHERE 1=1
        AND
        DISPGOOD.good_iden_numb = GOODVENDOR.good_iden_numb
        AND DISPGOOD.vendorid = GOODVENDOR.vendorid
        AND GOODVENDOR.good_iden_numb
        = GOOD.good_iden_numb
        AND GOODVENDOR.vendorid = BORGS.BORGID
        AND DISPGOOD.good_iden_numb = DISPINFO.good_iden_numb
        AND
        DISPGOOD.vendorid = DISPINFO.vendorid
        AND GOODVENDOR.ISUSE = '1'
        AND
        DISPGOOD.final_good_sts = 1
    </select>

    <select id="selectAutoCompList" resultType="kr.co.bitcube.product.dto.BuyProductDto">
        /*
        product.selectAutoCompList */
        SELECT 	GOOD_NAME
        , 		GOOD_SAME_WORD
        ,		GOOD_SPEC
        , 		ORDER_CNT
        FROM
        (
		        SELECT 	A.GOOD_NAME
		        , 		GOOD_SPEC
		        , 		ISNULL(B.GOOD_SAME_WORD, '') AS GOOD_SAME_WORD
		        , 		SUM(ISNULL(B.ORDER_CNT,0)) ORDER_CNT
		        FROM 	MCGOOD A WITH(NOLOCK) 
		        , 		MCGOODVENDOR B WITH(NOLOCK) 
		        WHERE 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		        AND		B.ISUSE = '1'
		        AND		A.REPRE_GOOD IN ('Y','N')
		        GROUP BY GOOD_NAME, GOOD_SAME_WORD, GOOD_SPEC
        )A
        ORDER BY ORDER_CNT DESC
    </select>

	<!-- 전시여부 -->
	<sql id="isGoodDisplaySql">
		AND		NOT EXISTS(SELECT 1 FROM MCADDGOOD Z WITH(NOLOCK) WHERE Z.ADD_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB)
		AND		EXISTS(
					SELECT	1
					FROM	MCGOODDISPLAY X WITH(NOLOCK)
					INNER JOIN MCGOODDISPLAY Y WITH(NOLOCK)
						ON	X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB
						AND	X.VENDORID = Y.VENDORID
					WHERE	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
					AND		X.VENDORID = B.VENDORID
					AND		X.DISPLAY_TYPE = '10'
					AND		Y.DISPLAY_TYPE = '20'
					AND		(X.DISPLAY_TYPE_CD = '99' OR X.DISPLAY_TYPE_CD = #{userInfoDto.areaType})
					AND		(Y.DISPLAY_TYPE_CD = '0' OR Y.DISPLAY_TYPE_CD = #{userInfoDto.workId})
					UNION ALL
					SELECT	1
					FROM	MCGOODDISPLAYBRANCH X WITH(NOLOCK)
					WHERE	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
					AND		X.VENDORID = B.VENDORID
					AND		X.BRANCHID = #{userInfoDto.borgId}
				)
	</sql>
	<!-- 공급사 역주문 상품 전시여부 -->
	<sql id="isGoodDisplayForVenSql">
		AND		NOT EXISTS(SELECT 1 FROM MCADDGOOD Z WITH(NOLOCK) WHERE Z.ADD_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB)
		AND		EXISTS(
					SELECT	1
					FROM	MCGOODDISPLAY X WITH(NOLOCK)
					INNER JOIN MCGOODDISPLAY Y WITH(NOLOCK)
						ON	X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB
						AND	X.VENDORID = Y.VENDORID
					WHERE	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
					AND		X.VENDORID = B.VENDORID
					AND		X.DISPLAY_TYPE = '10'
					AND		Y.DISPLAY_TYPE = '20'
					AND		(X.DISPLAY_TYPE_CD = '99' OR X.DISPLAY_TYPE_CD = ( select areaType from  smpbranchs with(nolock) where  branchid='${srcBranchId}' )    )
					AND		(Y.DISPLAY_TYPE_CD = '0' OR Y.DISPLAY_TYPE_CD =  ( select workId from  smpbranchs with(nolock) where  branchid='${srcBranchId}' )  )
					UNION ALL
					SELECT	1
					FROM	MCGOODDISPLAYBRANCH X WITH(NOLOCK)
					WHERE	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
					AND		X.VENDORID = B.VENDORID
					AND		X.BRANCHID = '${srcBranchId}'
				)
	</sql>

	<sql id="getProductResultListSql">
        WITH TMP_TABLE (
				CATE_ID
        , 		MAJO_CODE_NAME
        , 		LEV
        , 		FULL_CATE_NAME
        , 		FULL_CATE_ID
        ) AS (
		   		SELECT	CATE_ID
		   		, 		MAJO_CODE_NAME
		   		, 		CONVERT (INT , CATE_LEVEL ) AS LEV
		   		, 		CONVERT (VARCHAR(255) , '' )
		   		, 		CONVERT (VARCHAR(255) , '' )
		   		FROM 	MCCATEGORYMASTER MASTERCATE WITH(NOLOCK) 
		   		WHERE 	CATE_ID = 0
		   		UNION ALL
		   		SELECT 	OL.CATE_ID
		   		, 		OL.MAJO_CODE_NAME
		   		, 		CTE.LEV+1
		   		, 		CONVERT (VARCHAR(255) , 
		   					CASE WHEN CTE.LEV+1 = 1 THEN OL.MAJO_CODE_NAME
		   						ELSE CTE.FULL_CATE_NAME + ' > ' + OL.MAJO_CODE_NAME
		   					END )
		   		, 		CONVERT (VARCHAR(255) , 
		   					CASE WHEN CTE.LEV+1 = 1 THEN CONVERT(VARCHAR, OL.CATE_ID )
		   						ELSE CTE.FULL_CATE_ID + ',' + CONVERT(VARCHAR, OL.CATE_ID )
		   					END )
		   		FROM 	MCCATEGORYMASTER OL WITH(NOLOCK)  
		   		,		TMP_TABLE CTE
		   		WHERE 	OL.REF_CATE_SEQ = CTE.CATE_ID
        )
	</sql>
	<sql id="getProductResultListSql2">
		FROM	TMP_TABLE AA
		INNER JOIN (
				SELECT	MAX(Z.CATE_ID) AS CATE_ID
       			, 		MAX(Z.GOOD_NAME) AS GOOD_NAME
       			, 		MAX(Z.GOOD_SPEC) AS GOOD_SPEC
       			, 		Z.GOOD_IDEN_NUMB
       			, 		MAX(Z.ADD_GOOD) AS ADD_GOOD
       			, 		MAX(Z.REPRE_GOOD) AS REPRE_GOOD
       			, 		MAX(Z.VENDOR_EXPOSE) AS VENDOR_EXPOSE
       			, 		MAX(Z.GOOD_TYPE) AS GOOD_TYPE
       			,		MAX(Z.INSERT_DATE) AS INSERT_DATE
       			,		SUM(Z.ORDER_CNT) AS ORDER_CNT
				FROM	(
						SELECT	A.CATE_ID
						,		A.GOOD_NAME
						,		A.GOOD_SPEC
						,		A.GOOD_IDEN_NUMB
						,		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
				        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
				        , 		ISNULL(A.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
				        ,		A.GOOD_TYPE
		<if test="@MybatisUtils@isNotEmpty(productDetailSearch)">
						,		DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN
		</if>
						,		A.INSERT_DATE
						,		B.ORDER_CNT
						FROM	MCGOOD A WITH(NOLOCK) 
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
							ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
				        	AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK) 
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK) 
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						${addSql}
						AND		B.SELL_PRICE > 0
        <if test="@MybatisUtils@isNotEmpty(goodIdenNumb)">
            			AND 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(goodName)">
                        AND A.GOOD_NAME LIKE '%'+ #{goodName} +'%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(goodType)">
            			AND 	A.GOOD_TYPE = #{goodType}
        </if>
        <if test="@MybatisUtils@isNotEmpty(goodSpec)">
                        AND A.GOOD_SPEC LIKE '%'+ #{goodName} +'%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(repreGood) and repreGood neq 'A'.toString()">
        				AND A.REPRE_GOOD = #{repreGood}
        </if>
        <if test="@MybatisUtils@isNotEmpty(repreGood) and repreGood eq 'A'.toString()">
        				AND A.ADD_GOOD = 'Y'
        </if>
						AND		A.REPRE_GOOD != 'P'
		<if test="@MybatisUtils@isEmpty(productDetailSearch)">
			<include refid="isGoodDisplaySql" />
		</if>
				) Z
<!--         <if test="@MybatisUtils@isEmpty(productDetailSearch)"> -->
<!-- 				WHERE	Z.DISPLAY_YN = 'Y' -->
<!-- 		</if> -->
				GROUP BY Z.GOOD_IDEN_NUMB
		) BB
			ON	AA.CATE_ID = BB.CATE_ID
		WHERE	1 = 1
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
		AND 	FULL_CATE_ID LIKE '%'+#{srcCateId}+'%'
        </if>
	</sql>
    <select id="getProductResultListCnt" resultType="int">
		/* product.getProductResultListCnt */
		<include refid="getProductResultListSql" />
        SELECT 	COUNT(1)
        <include refid="getProductResultListSql2" />
    </select>
    <select id="getProductResultList" resultType="java.util.HashMap">
        /* product.getProductResultList */
        <include refid="getProductResultListSql" />
        SELECT 	*
        <include refid="getProductResultListSql2" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
<!--         <if test="orderString != null and orderString != ''"> -->
        ORDER BY ${orderString} 
        </if>
    </select>

	<select id="getProductResultGridList" resultType="java.util.HashMap">
		/* product.getProductResultGridList*/
		<include refid="getProductResultListSql" />
		
		SELECT *
		FROM 	TMP_TABLE AA
		,(
				SELECT	ZZ.*
				FROM	
				(
		<![CDATA[
						SELECT  A.GOOD_IDEN_NUMB
						,		(A.GOOD_NAME 
									+ (CASE WHEN (A.GOOD_SPEC IS not NULL OR A.good_spec != '' ) 
											THEN '<BR/>'+A.GOOD_SPEC ELSE '' 
										END) 
									+ '<BR/>' 
									+ (CASE WHEN (A.VENDOR_EXPOSE = 'N')
											THEN 'SKTS' ELSE C.VENDORNM 
										END)
								) AS GOOD_INFO
						,		A.GOOD_TYPE  		
						,		STUFF( CASE WHEN A.GOOD_TYPE = '20'  THEN '/지정' WHEN A.GOOD_TYPE = '10' THEN '/일반'  ELSE '' END
										+ CASE WHEN A.ADD_GOOD = 'Y'  THEN '/추가' ELSE '' END
										+ CASE WHEN A.REPRE_GOOD = 'Y'  THEN '/옵션' ELSE '' END
										,1,1 ,'')AS PDT_STATE
						,		(ISNULL(REPLACE( CONVERT(VARCHAR(30), CAST( ROUND(B.SELL_PRICE,0) AS money),1),'.00',''),0) + '원<BR/>' + ISNULL(CONVERT(VARCHAR, B.DELI_MINI_DAY)+'일','') )AS SELL_PRICE
		]]>
						,		B.VENDORID AS VENDORID
						,		ISNULL(A.add_good, 'N') AS ADD_GOOD
						,		ISNULL(A.repre_good,'N') AS REPRE_GOOD
						,		A.CATE_ID
						
<!-- 						,		DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN -->
						
						,		CASE WHEN (A.VENDOR_EXPOSE = 'N')
											THEN CONVERT(VARCHAR(10),ROW_NUMBER() OVER(PARTITION BY B.GOOD_IDEN_NUMB, A.VENDOR_EXPOSE ORDER BY B.GOOD_IDEN_NUMB ))
											ELSE '1' 
								END AS GROUP_NUM
						,		B.DELI_MINI_QUAN 
						,		B.DELI_MINI_QUAN AS QUAN 
						FROM 	MCGOOD A WITH(NOLOCK) 
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
							ON 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
							AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK) 
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK) 
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						${addSql}
					<if test="@MybatisUtils@isNotEmpty(srcGoodName)">
						AND    	A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodSpec)">
						AND		A.GOOD_SPEC LIKE '%'+#{srcGoodSpec}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
						AND    	A.GOOD_IDEN_NUMB LIKE '%'+#{srcGoodIdenNumb}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodClasCode)">
						AND		A.GOOD_TYPE = #{srcGoodClasCode}						
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcVendorNm)">
						AND		C.VENDORNM LIKE '%'+#{srcVendorNm}+'%'					
					</if>							
						AND 	A.REPRE_GOOD != 'P'
						AND		B.SELL_PRICE > 0
						<include refid="isGoodDisplaySql" />
				) ZZ
<!-- 				WHERE	ZZ.DISPLAY_YN = 'Y' -->
				WHERE	ZZ.GROUP_NUM = 1
				
		)BB
		WHERE	AA.CATE_ID = BB.CATE_ID
		<if test="@MybatisUtils@isNotEmpty(srcCateId)">
		AND		FULL_CATE_ID LIKE '%'+#{srcCateId}+'%'
		</if>
		<if test="@MybatisUtils@isNotEmpty(orderString)">
        ORDER BY ${orderString} 
        </if>
	</select>
	<select id="getProductResultGridListCnt" resultType="int">
		/* product.getProductResultGridListCnt */
		<include refid="getProductResultListSql" />
		SELECT	COUNT(1)
		FROM	TMP_TABLE AAA
		INNER JOIN (
				SELECT	AA.CATE_ID
				,		AA.GROUP_NUM
				FROM	(
<!-- 						SELECT	DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN -->
						SELECT	A.CATE_ID
						,		(CASE 	WHEN A.VENDOR_EXPOSE = 'N' THEN B.GOOD_IDEN_NUMB
										ELSE CONVERT(VARCHAR(10),ROW_NUMBER() OVER(ORDER BY B.GOOD_IDEN_NUMB, B.VENDORID ))
								END) AS GROUP_NUM
						FROM 	MCGOOD A WITH(NOLOCK) 
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
							ON 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
							AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK) 
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK) 
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						${addSql}
					<if test="@MybatisUtils@isNotEmpty(srcGoodName)">
						AND    	A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodSpec)">
						AND		A.GOOD_SPEC LIKE '%'+#{srcGoodSpec}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
						AND    	A.GOOD_IDEN_NUMB LIKE '%'+#{srcGoodIdenNumb}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodClasCode)">
						AND		A.GOOD_TYPE = #{srcGoodClasCode}						
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcVendorNm)">
						AND		C.VENDORNM LIKE '%'+#{srcVendorNm}+'%'					
					</if>						
						AND 	A.REPRE_GOOD != 'P'
						AND		B.SELL_PRICE > 0
						<include refid="isGoodDisplaySql" />
				) AA
<!-- 				WHERE	AA.DISPLAY_YN = 'Y' -->
				
				GROUP BY AA.CATE_ID, AA.GROUP_NUM
		) BBB
			ON	AAA.CATE_ID = BBB.CATE_ID
		WHERE	1 = 1
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
		AND 	FULL_CATE_ID LIKE '%'+#{srcCateId}+'%'
        </if>
    </select>
    
	<select id="selectProductResultListExcel" resultType="java.util.HashMap">
		/* product.selectProductResultListExcel */
		<include refid="getProductResultListSql" />
		SELECT	AAA.*
		FROM	(
				SELECT	AA.*
				FROM	(
						SELECT	A.CATE_ID
						,		A.GOOD_NAME
						,		A.GOOD_SPEC
						,		A.GOOD_IDEN_NUMB
						,		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
				        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
				        , 		ISNULL(A.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
				        ,		(CASE WHEN A.GOOD_TYPE='20' THEN '지정' ELSE '일반' END) AS GOOD_TYPE
						,		ISNULL(B.ORDER_CNT,0) AS ORDER_CNT
						,		A.INSERT_DATE
						,		CONVERT(VARCHAR(10),A.INSERT_DATE,120) AS INSERT_DATE_STRING
                        , 		CASE WHEN ISNULL(A.STOCK_MNGT,'N') = 'Y' AND B.GOOD_INVENTORY_CNT>0 THEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT, 0))) 
                                	ELSE '-'
                                END AS GOOD_INVENTORY_CNT
						,		ROW_NUMBER() OVER(PARTITION BY B.GOOD_IDEN_NUMB ORDER BY B.VENDOR_PRIORITY, B.REGIST_DATE, B.VENDORID DESC) AS RANK
						,		COUNT(1) OVER(PARTITION BY B.GOOD_IDEN_NUMB) AS VENDORCNT
						
						,		(CASE WHEN A.SKTS_IMG = 'Y' THEN A.SKTS_SMALL_IMG_PATH ELSE B.SMALL_IMG_PATH END) AS IMG_PATH
						,		B.DELI_MINI_DAY
						,		ISNULL(B.MAKE_COMP_NAME,'') AS MAKE_COMP_NAME
						,		B.SELL_PRICE
						,		B.VENDORID
						,		ISNULL(B.DELI_MINI_QUAN,1) AS DELI_MINI_QUAN
						,		(CASE WHEN A.VENDOR_EXPOSE = 'N' THEN 'SKTS' ELSE C.VENDORNM END) AS VENDORNM
		
						FROM	MCGOOD A WITH(NOLOCK)
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
							ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
				        	AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK)
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK)
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						${addSql}
						AND		A.REPRE_GOOD != 'P'
						AND		B.SELL_PRICE > 0
						<include refid="isGoodDisplaySql" />
				) AA
		) AAA
		INNER JOIN TMP_TABLE BBB
			ON	AAA.CATE_ID = BBB.CATE_ID
		<if test="@MybatisUtils@isNotEmpty(srcCateId)">
			AND BBB.FULL_CATE_ID LIKE '%'+#{srcCateId}+'%'
		</if>
		ORDER BY AAA.GOOD_IDEN_NUMB DESC, AAA.RANK ASC
<!-- 		<if test="@MybatisUtils@isNotEmpty(orderString)"> -->
<!-- 		ORDER BY ${orderString}  -->
<!-- 		</if> -->
	</select>

	<select id="selectProductSearchResultList" resultType="java.util.HashMap">
		/* product.selectProductSearchResultList */
		<include refid="getProductResultListSql" />
		SELECT	AAA.*
		<![CDATA[
		,		CASE	WHEN (ASCII(SUBSTRING(AAA.GOOD_NAME, 1,1)) < 128) 
							THEN 2
						ELSE 1
				END ASCII_ORDER
		]]>
		FROM	(
				SELECT	AA.*
				FROM	(
						SELECT	A.CATE_ID
						,		A.GOOD_NAME
						,		A.GOOD_SPEC
						,		A.GOOD_IDEN_NUMB
						,		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
						, 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
						, 		ISNULL(A.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
						,		A.GOOD_TYPE
						,		ISNULL(B.ORDER_CNT,0) AS ORDER_CNT
						,		A.INSERT_DATE
						,		CASE WHEN ISNULL(A.STOCK_MNGT,'N')='Y' AND B.GOOD_INVENTORY_CNT>0 THEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT, 0))) 
									ELSE '-'
								END AS GOOD_INVENTORY_CNT
						,		ROW_NUMBER() OVER(PARTITION BY B.GOOD_IDEN_NUMB ORDER BY B.VENDOR_PRIORITY, newid(), B.REGIST_DATE, B.VENDORID DESC) AS RANK
						,		COUNT(1) OVER(PARTITION BY B.GOOD_IDEN_NUMB) AS VENDORCNT
						,		(CASE WHEN A.SKTS_IMG = 'Y' THEN A.SKTS_SMALL_IMG_PATH ELSE B.SMALL_IMG_PATH END) AS IMG_PATH
						,		B.DELI_MINI_DAY
						,		ISNULL(B.MAKE_COMP_NAME,'') AS MAKE_COMP_NAME
						,		B.SELL_PRICE
						,		B.VENDORID
						,		ISNULL(B.DELI_MINI_QUAN,1) AS DELI_MINI_QUAN
						,		(CASE WHEN A.VENDOR_EXPOSE = 'N' THEN 'SKTS' ELSE C.VENDORNM END) AS VENDORNM
						,		(CASE WHEN A.SKTS_IMG = 'Y' THEN A.SKTS_LARGE_IMG_PATH ELSE B.LARGE_IMG_PATH END) AS LARGE_IMG_PATH
						FROM	MCGOOD A WITH(NOLOCK)
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
							ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
				        	AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK)
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK)
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						${addSql}
						AND		A.REPRE_GOOD != 'P'
						AND		B.SELL_PRICE > 0
					<if test="@MybatisUtils@isNotEmpty(srcGoodName)">
						AND    	A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodSpec)">
						AND		A.GOOD_SPEC LIKE '%'+#{srcGoodSpec}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
						AND    	A.GOOD_IDEN_NUMB LIKE '%'+#{srcGoodIdenNumb}+'%'
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcGoodClasCode)">
						AND		A.GOOD_TYPE = #{srcGoodClasCode}						
					</if>
					<if test="@MybatisUtils@isNotEmpty(srcVendorNm)">
						AND		C.VENDORNM LIKE '%'+#{srcVendorNm}+'%'					
					</if>
						<include refid="isGoodDisplaySql" />
				) AA
				WHERE	AA.RANK = 1
		) AAA
		INNER JOIN TMP_TABLE BBB
			ON	AAA.CATE_ID = BBB.CATE_ID
		<if test="@MybatisUtils@isNotEmpty(srcCateId)">
			AND BBB.FULL_CATE_ID LIKE '%'+#{srcCateId}+'%'
		</if>
		<if test="@MybatisUtils@isNotEmpty(orderString)">
		ORDER BY ${orderString} 
		</if>
	</select>
	<select id="selectProductSearchResultVendorList" resultType="java.util.HashMap">
		/* product.selectProductSearchResultVendorList */
		SELECT	AA.*
		FROM	(
				SELECT	ROW_NUMBER() OVER(PARTITION BY B.GOOD_IDEN_NUMB ORDER BY B.VENDOR_PRIORITY, newid(), B.REGIST_DATE, B.VENDORID DESC) AS RANK
				,		(CASE WHEN A.SKTS_IMG = 'Y' THEN A.SKTS_SMALL_IMG_PATH ELSE B.SMALL_IMG_PATH END) AS IMG_PATH
				,		B.DELI_MINI_DAY
				,		ISNULL(B.MAKE_COMP_NAME,'') AS MAKE_COMP_NAME
				,		B.SELL_PRICE
				,		B.VENDORID
				,		ISNULL(B.DELI_MINI_QUAN,1) AS DELI_MINI_QUAN
				,		(CASE WHEN A.VENDOR_EXPOSE = 'N' THEN 'SKTS' ELSE C.VENDORNM END) AS VENDORNM
				FROM	MCGOOD A WITH(NOLOCK)
				INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
					ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		        	AND	B.ISUSE = '1'
				INNER JOIN SMPVENDORS C WITH(NOLOCK)
					ON 	B.VENDORID = C.VENDORID
				INNER JOIN SMPBORGS D WITH(NOLOCK)
					ON	C.VENDORID = D.BORGID
					AND	D.ISUSE = '1'
				WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
				AND		B.VENDORID != #{vendorid}
				AND		A.REPRE_GOOD != 'P'
				AND		B.SELL_PRICE > 0
				<include refid="isGoodDisplaySql" />
		) AA
		--WHERE	AA.RANK > 1
		ORDER BY RANK
	</select>
	

    <select id="getProductResultInfo" resultType="java.util.HashMap">
        /* product.getProductResultInfo */
        SELECT	Z.*
        FROM	(
		        SELECT	ISNULL(A.GOOD_NAME , '') AS GOOD_NAME
		        , 		ISNULL(A.GOOD_SPEC , '') AS GOOD_SPEC
		        , 		ISNULL(A.GOOD_IDEN_NUMB, '') AS GOOD_IDEN_NUMB
		        , 		ISNULL(B.MAKE_COMP_NAME, '') AS MAKE_COMP_NAME
		        , 		ISNULL(B.DELI_MINI_DAY , 0 ) AS DELI_MINI_DAY
		        ,		CASE 
		        		WHEN A.REPRE_GOOD = 'Y' 
		        		THEN (
							SELECT 	MIN(X.SELL_PRICE)
							FROM 	MCGOOD Z WITH(NOLOCK) 
							INNER JOIN MCGOODVENDOR X WITH(NOLOCK) 
							    ON 	Z.GOOD_IDEN_NUMB = X.GOOD_IDEN_NUMB
							WHERE 	Z.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
							AND 	X.VENDORID = B.VENDORID
							AND		X.SELL_PRICE > 0 
						)
						ELSE ISNULL(B.SELL_PRICE, 0)
						END  AS SELL_PRICE
		        , 		B.VENDOR_PRIORITY
		<if test="@MybatisUtils@isEmpty(vendorId)">
		        , 		C.VENDORNM
		</if>
		<if test="@MybatisUtils@isNotEmpty(vendorId)">
		        , 		'SKTS' AS VENDORNM
		</if>
		        , 		C.VENDORID
		        , 		CASE 	WHEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT, 0))) = '0' THEN '-'
				        		ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), B.GOOD_INVENTORY_CNT))
				        END AS GOOD_INVENTORY_CNT
		        , 		A.GOOD_TYPE AS GOOD_CLAS_CODE
		        
		        , 		B.SMALL_IMG_PATH
		        , 		ISNULL(B.GOOD_DESC, '') AS GOOD_DESC
		        , 		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
		        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
		        ,		CASE WHEN ISNULL(E.REPRE_GOOD,'N') = 'Y' 
        				THEN 
                            CASE WHEN E.SKTS_IMG = 'Y' THEN ISNULL(E.SKTS_LARGE_IMG_PATH, '') ELSE ISNULL(F.LARGE_IMG_PATH, '') END 
        				ELSE 
                            CASE WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_LARGE_IMG_PATH, '') ELSE ISNULL(B.LARGE_IMG_PATH, '') END 
        				END  AS IMG_PATH
<!-- 		        , 		CASE 	WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_LARGE_IMG_PATH, '') -->
<!-- 			        			ELSE ISNULL(B.LARGE_IMG_PATH, '') -->
<!-- 			        	END AS IMG_PATH -->
		        , 		CASE 	WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_ORIGNAL_IMG_PATH, '')
			        			ELSE ISNULL(B.ORIGINAL_IMG_PATH, '')
			        	END AS ORIGINAL_IMG_PATH
		        , 		ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA  WITH(NOLOCK) WHERE A.PRODUCT_MANAGER = AA.USERID),'') AS PRODUCT_MANAGER
		<if test="@MybatisUtils@isNotEmpty(productDetailSearch)">
		        ,		DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN
		</if>
		        ,		ISNULL(B.DELI_MINI_QUAN,0) AS DELI_MINI_QUAN
		        ,		C.PHONENUM
				, 		(CASE WHEN (SELECT COUNT(1) FROM MCADDGOOD ZZ WITH(NOLOCK) WHERE ZZ.ADD_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB AND ZZ.VENDORID=B.VENDORID)>0 THEN 'Y'
        					ELSE 'N'
        				END) AS SUB_YN		        
		        FROM 	MCGOOD A WITH(NOLOCK) 
		        INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
		        	ON 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		        	AND	B.ISUSE = '1'
		        	AND	B.SELL_PRICE > 0
		        INNER JOIN SMPVENDORS C WITH(NOLOCK) 
		        	ON 	B.VENDORID = C.VENDORID
		        INNER JOIN SMPBORGS D WITH(NOLOCK) 
		        	ON	C.VENDORID = D.BORGID
		        	AND	D.ISUSE = '1'
		        LEFT OUTER JOIN MCGOOD E  WITH(NOLOCK)
		        	ON	A.REPRE_GOOD_IDEN_NUMB = E.GOOD_IDEN_NUMB
		        LEFT OUTER JOIN MCGOODVENDOR F WITH(NOLOCK)
		        	ON	E.GOOD_IDEN_NUMB = F.GOOD_IDEN_NUMB
		        	AND	B.VENDORID = F.VENDORID
		        	AND F.ISUSE ='1'
		        	AND	F.SELL_PRICE > 0
		        WHERE 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
		<if test="@MybatisUtils@isEmpty(productDetailSearch)">
			<include refid="isGoodDisplaySql" />
		</if>
		<if test="@MybatisUtils@isNotEmpty(vendorId)">
				AND 	B.VENDORID = #{vendorId}
		</if>
		) Z
		<if test="@MybatisUtils@isNotEmpty(productDetailSearch)">
		WHERE	Z.DISPLAY_YN = 'Y'
		</if>
		ORDER BY Z.VENDOR_PRIORITY
	</select>

    <select id="getProductResultOne" resultType="java.util.HashMap">
        /* product.getProductResultOne */
        SELECT 	*
        FROM
        (
        		SELECT 	(CASE	WHEN Z.SUM_RATE=0 OR Z.ORDE_REQU_QUAN=0 THEN 0
        						ELSE (Z.DISTRI_RATE/Z.SUM_RATE) * (Z.SUM_QUAN/Z.ORDE_REQU_QUAN)
        				END) AS SUM_VAL
        		, 		Z.VENDOR_PRIORITY
        		, 		Z.GOOD_IDEN_NUMB
        		, 		Z.VENDORID
        		FROM	(
        				SELECT 	A.GOOD_IDEN_NUMB
        				, 		B.VENDORID
        				, 		(SELECT SUM(DISTRI_RATE) FROM MCGOODVENDOR AA  WITH(NOLOCK) WHERE AA.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS SUM_RATE
        				, 		B.DISTRI_RATE
        				, 		ISNULL(C.ORDE_REQU_QUAN, 1) AS ORDE_REQU_QUAN
        				, 		(SELECT ISNULL(SUM(AA.ORDE_REQU_QUAN),1) FROM MRORDT AA  WITH(NOLOCK) WHERE AA.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB AND AA.VENDORID = B.VENDORID) AS SUM_QUAN
        				, 		B.VENDOR_PRIORITY
<!--         				,		DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN -->
        				FROM 	MCGOOD A WITH(NOLOCK) 
        				, 		MCGOODVENDOR B WITH(NOLOCK) 
        				INNER JOIN SMPBORGS B1 WITH(NOLOCK) 
        					ON	B.VENDORID = B1.BORGID
        					AND	B1.ISUSE = '1'
        				LEFT OUTER JOIN MRORDT C WITH(NOLOCK) 
        					ON 	B.GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
        					AND B.VENDORID = C.VENDORID
        				WHERE	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        				AND 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        				AND		B.ISUSE = '1'
        				<include refid="isGoodDisplaySql" />
        		) Z
<!--         		WHERE	Z.DISPLAY_YN = 'Y' -->
        )AA
        ORDER BY SUM_VAL DESC, VENDOR_PRIORITY
    </select>

    <select id="selectChoiceVendorInfo" resultType="java.util.HashMap">
        /* product.selectChoiceVendorInfo */
        SELECT	ISNULL(A.MAKE_COMP_NAME,' ') AS MAKE_COMP_NAME
		, 		ISNULL(A.DELI_MINI_DAY, 0) AS DELI_MINI_DAY
		, 		CASE WHEN B.REPRE_GOOD = 'Y' 
						THEN	(SELECT MIN(X.SELL_PRICE)
								FROM 	MCGOOD Z WITH(NOLOCK) 
								INNER JOIN MCGOODVENDOR X WITH(NOLOCK) 
									ON 	Z.GOOD_IDEN_NUMB = X.GOOD_IDEN_NUMB
								WHERE 	Z.REPRE_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
								AND 	X.VENDORID = A.VENDORID 
								AND		X.SELL_PRICE > 0)
					ELSE ISNULL(A.SELL_PRICE, 0)
				END  AS SELL_PRICE
		, 		ISNULL(A.VENDOR_PRIORITY, 0) AS VENDOR_PRIORITY
		, 		CASE WHEN ISNULL(B.STOCK_MNGT,'N') = 'Y' AND A.GOOD_INVENTORY_CNT>0 THEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(A.GOOD_INVENTORY_CNT, 0))) 
            		ELSE '-'
            	END AS GOOD_INVENTORY_CNT
		, 		ISNULL(B.GOOD_TYPE, ' ') AS GOOD_CLAS_CODE
		, 		ISNULL(A.GOOD_DESC, ' ') AS GOOD_DESC
		, 		CASE WHEN B.SKTS_IMG = 'Y' THEN ISNULL(B.SKTS_ORIGNAL_IMG_PATH, '')
                	ELSE ISNULL(A.ORIGINAL_IMG_PATH, '')
                END AS IMG_PATH
		, 		CASE WHEN B.SKTS_IMG = 'Y' THEN ISNULL(B.SKTS_SMALL_IMG_PATH, '')
                	ELSE ISNULL(A.SMALL_IMG_PATH, '')
                END AS SM_IMG_PATH
		, 		B.REPRE_GOOD
		, 		ISNULL(A.DELI_MINI_QUAN,0) AS DELI_MINI_QUAN
        FROM 	MCGOODVENDOR A WITH(NOLOCK) 
        , 		MCGOOD B WITH(NOLOCK) 
        WHERE 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND		A.SELL_PRICE > 0
        AND 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND 	A.VENDORID = #{vendorId}
    </select>

    <sql id="selectProductResultList">
        FROM MCGOOD A WITH(NOLOCK) 
        INNER JOIN TMP_TABLE C
        	ON A.cate_id = C.CATE_ID AND C.LEV = '3'
        LEFT OUTER JOIN MCGOODVENDOR B WITH(NOLOCK) 
        	ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        LEFT OUTER JOIN SMPBORGS VENDOR WITH(NOLOCK) 
        	ON B.VENDORID = VENDOR.BORGID
        LEFT OUTER JOIN MCCATEGORYMASTER MCM WITH(NOLOCK) 
        	ON A.CATE_ID = MCM.CATE_ID
        LEFT OUTER JOIN SMPVENDORS SV WITH(NOLOCK) 
        	ON B.VENDORID = SV.VENDORID
        ${addSql}
    </sql>

    <sql id="selectProductListSql">
        FROM MCGOOD A WITH(NOLOCK)
        <if test="@MybatisUtils@isEmpty(srcGoodSameWord) and @MybatisUtils@isEmpty(srcIsUse) and @MybatisUtils@isEmpty(srcVendorId)">
            LEFT JOIN MCGOODVENDOR B WITH(NOLOCK)
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSameWord) or @MybatisUtils@isNotEmpty(srcIsUse) or @MybatisUtils@isNotEmpty(srcVendorId)">
            INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
        </if>
        ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        <if test="@MybatisUtils@isNotEmpty(srcGoodSameWord)">
            AND B.GOOD_SAME_WORD LIKE '%${srcGoodSameWord}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcIsUse)">
            AND B.ISUSE = #{srcIsUse}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcVendorId) and  srcVendorId neq '0'.toString() ">
            AND B.VENDORID = #{srcVendorId}
        </if>
         INNER  JOIN  SMPBORGS B1 WITH(NOLOCK)
			ON B.vendorid = B1.BORGID
			AND B1.ISUSE = '1'
        LEFT OUTER JOIN TMP_TABLE C
        	ON	A.CATE_ID = C.CATE_ID
        LEFT OUTER JOIN
        (
        	SELECT GOOD_IDEN_NUMB, VENDORID, 'Y' AS DIS_YN FROM MCGOODDISPLAY GROUP BY good_iden_numb, vendorid
        ) D
        	ON 	B.GOOD_IDEN_NUMB = D.GOOD_IDEN_NUMB
        	AND B.VENDORID = D.VENDORID	
        <if test="srcType eq '1'.toString()">
		LEFT OUTER JOIN mcaddgood X WITH(NOLOCK)
			ON 	X.add_good_iden_numb=B.good_iden_numb
			AND X.vendorid = B.VENDORID
		</if>
        WHERE isnull(repre_good,'N') IN ('Y','N')
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
            AND A.CATE_ID IN (SELECT CATE_ID FROM FNS_CATEGORYIDS_BY_PARENTCATEID(#{srcCateId})) 
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcInsertStartDate) and @MybatisUtils@isNotEmpty(srcInsertEndDate)">
            AND INSERT_DATE BETWEEN CONVERT(DATETIME, #{srcInsertStartDate}) AND
            DATEADD(D,1,CONVERT(DATETIME, #{srcInsertEndDate}))
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
            AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
            AND A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        
        <if test="@MybatisUtils@isNotEmpty(addSql)">
        	${addSql}
        </if>
        
        <if test="@MybatisUtils@isNotEmpty(srcGoodClasCode)">
            AND A.GOOD_TYPE = #{srcGoodClasCode}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
            AND A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcProductManager)">
            AND A.PRODUCT_MANAGER = #{srcProductManager}
        </if>
        <if test="srcType eq '1'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	ISNULL(A.ADD_GOOD,'N') = 'N'
            AND X.add_good_iden_numb IS NULL
        </if>
        <if test="srcType eq '0'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	A.ADD_GOOD = 'Y'
        </if>
        <if test="srcType eq '2'.toString()">
            AND A.REPRE_GOOD = 'Y'
        </if>
        <if test="srcType eq '3'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	ISNULL(A.ADD_GOOD,'N') = 'N'
            AND EXISTS (select TOP 1 1 from mcaddgood X WITH(NOLOCK) WHERE A.good_iden_numb = X.add_good_iden_numb AND X.vendorid = B.VENDORID)
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcWorkId)">
            AND EXISTS (
            	SELECT TOP 1 1 
            	FROM MCGOODDISPLAY X WITH(NOLOCK) 
            	WHERE A.GOOD_IDEN_NUMB = X.GOOD_IDEN_NUMB 
            	AND X.VENDORID = B.VENDORID
            	AND X.DISPLAY_TYPE = '20'
            	AND X.DISPLAY_TYPE_CD = #{srcWorkId}
            )
        </if>
        <if test="srcDisYn eq 'Y'.toString()">
        	AND D.DIS_YN = 'Y'
        </if>
        <if test="srcDisYn eq 'N'.toString()">
        	AND D.DIS_YN IS NULL
        </if>
    </sql>
    
    <select id="selectProductList_count" resultType="int">
        /* product.selectProductList_count */
        <include refid="selectProductCategorySql" />
        SELECT COUNT(1)
        <include refid="selectProductListSql" />
    </select>

	<sql id="selectProductCategorySql">
		WITH TMP_TABLE ( 
				cate_id
		,		CATE_CD
		,		majo_code_name
		,		ref_cate_seq
		,		cate_level
		,		LEV
		,		FULL_CATE_NAME
		,		CATE_NAME_1ST
		,		CATE_NAME_2ST
		,		CATE_NAME_3ST
		) AS ( 
				SELECT	cate_id
				,		CATE_CD
				,		majo_code_name
				,		CONVERT (VARCHAR , '-1')
				,		cate_level
				,		0 AS LEV
				,		CONVERT (VARCHAR(200) , '' )
				,		CONVERT (VARCHAR , '' )
				,		CONVERT (VARCHAR , '' )
				,		CONVERT (VARCHAR , '' )
				FROM mccategorymaster A WITH(NOLOCK) 
				WHERE CATE_ID = '0'
				UNION ALL
				SELECT	OL.cate_id
				,		OL.CATE_CD
				,		OL.majo_code_name
				,		CONVERT (VARCHAR ,OL.ref_cate_seq )
				,		OL.cate_level
				,		CTE.LEV+1
				,		CONVERT (VARCHAR(200) , CASE WHEN CTE.LEV+1 = 1 THEN OL.majo_code_name ELSE CTE.FULL_CATE_NAME + ' > ' + OL.majo_code_name END )
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 1 THEN OL.majo_code_name ELSE CTE.CATE_NAME_1ST END))
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 2 THEN OL.majo_code_name ELSE CTE.CATE_NAME_2ST END))
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 3 THEN OL.majo_code_name ELSE CTE.CATE_NAME_3ST END))
				FROM	mccategorymaster OL WITH(NOLOCK) 
				,		TMP_TABLE CTE
				WHERE	OL.REF_CATE_SEQ = CTE.CATE_ID
		)
	</sql>

<!--물량배분 수정., 		(SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.ISDISTRIBUTE = X.CODEVAL1 AND X.CODETYPECD = 'ISDISTRIBUTE') AS ISDISTRIBUTENM -->
    <select id="selectProductList" resultType="hashmap">
        /* product.selectProductList */
        <include refid="selectProductCategorySql" />
        SELECT 	A.GOOD_IDEN_NUMB
        , 		(SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.GOOD_TYPE = X.CODEVAL1 AND X.CODETYPECD = 'ORDERGOODSTYPE') AS GOOD_TYPE_NM
        , 		A.REPRE_GOOD
        , 		(CASE WHEN ISNULL(A.REPRE_GOOD,'N')='Y' THEN '옵션' WHEN ISNULL(A.REPRE_GOOD,'N')='N' AND ISNULL(A.ADD_GOOD,'N')='Y' THEN '추가' 
        			WHEN (SELECT COUNT(1) FROM MCADDGOOD ZZ WITH(NOLOCK) WHERE ZZ.ADD_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB AND ZZ.VENDORID=B.VENDORID)>0 THEN '추가SUB'
        			ELSE '단품'
        		END) AS REPRE_GOOD_NM
        , 		A.GOOD_NAME
        , 		A.GOOD_SPEC
        , 		A.ORDER_UNIT
        , 		(SELECT VENDORNM FROM SMPVENDORS X WITH(NOLOCK) WHERE B.VENDORID = X.VENDORID) AS VENDORNM
        , 		ISNULL ( SELL_PRICE , 0 ) AS SELL_PRICE
        , 		ISNULL ( SALE_UNIT_PRIC , 0 ) AS SALE_UNIT_PRIC
        , 		ISNULL(CASE	REPRE_GOOD WHEN 'Y' THEN (SELECT SUM(Y.GOOD_INVENTORY_CNT) FROM MCGOOD X, MCGOODVENDOR Y WITH(NOLOCK) WHERE X.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB AND X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB AND Y.VENDORID = B.VENDORID) ELSE GOOD_INVENTORY_CNT END ,0) AS GOOD_INVENTORY_CNT
        ,		CASE A.ISDISTRIBUTE WHEN '0' THEN 'N' ELSE 'Y' END AS ISDISTRIBUTENM
        , 		ISNULL( DELI_MINI_DAY , 0 ) as DELI_MINI_DAY 
        , 		CONVERT(VARCHAR(10), INSERT_DATE, 120) AS INSERT_DATE
        , 		ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA WITH(NOLOCK) WHERE A.PRODUCT_MANAGER = AA.USERID),'') AS PRODUCT_MANAGER
        , 		B.VENDORID
		,		C.CATE_NAME_1ST
		,		C.CATE_NAME_2ST
		,		C.CATE_NAME_3ST
		,		(SELECT	STUFF((
								SELECT ', ' + AA.VALUE
								FROM	(
										SELECT	VALUE 
										FROM	FNS_SPLIT_SPECUSE(B.GOOD_SAME_WORD,'‡') 
										WHERE	VALUE != ''
								) AA
								FOR XML PATH('')
						),1,2,'')) AS GOOD_SAME_WORD
		,		(CASE WHEN LEN(B.SMALL_IMG_PATH)>10 THEN 'Y' ELSE '' END) AS IMG_YN
		,		(CASE WHEN LEN(B.SMALL_IMG_PATH)>10 THEN B.SMALL_IMG_PATH ELSE '' END) AS SMALL_IMG_PATH
		,		(CASE WHEN LEN(B.ORIGINAL_IMG_PATH)>10 THEN B.ORIGINAL_IMG_PATH ELSE '' END) AS ORIGINAL_IMG_PATH
		,		(CASE WHEN LEN(B.GOOD_DESC)>30 THEN 'Y' ELSE '' END) AS DESC_YN
		,		ISNULL (B.DELI_MINI_QUAN, 0) AS DELI_MINI_QUAN
        , 		CASE
        			WHEN
        				ISNULL( B.SELL_PRICE , 0 ) = 0
        			THEN
        				0 
        			ELSE
        				CONVERT(
        					DECIMAL(15, 1),
        					ROUND(
        						(
        							ISNULL( B.SELL_PRICE , 0 ) - B.SALE_UNIT_PRIC
        						) / ISNULL ( B.SELL_PRICE , 1 ) * 100,
        						1
        					)
        				)
        		END AS VENDOR_SELL_RATE
        ,		B.ISUSE
        ,		ISNULL(D.DIS_YN, 'N') AS DIS_YN
        <if test="@MybatisUtils@isNotEmpty(isExcel)">
        , 		STUFF((
        			SELECT 	',' + Y.CODENM1
        			FROM 	MCGOODDISPLAY X WITH(NOLOCK)
        			, 		SMPCODES Y WITH(NOLOCK)
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			AND 	X.DISPLAY_TYPE = '10'
        			AND 	Y.CODETYPECD = 'DELI_AREA_CODE'
        			AND 	DISPLAY_TYPE_CD = Y.CODEVAL1
        			ORDER BY DISORDER
        			FOR XML PATH('')
        		), 1, 1, '') AS DELI
        , 		STUFF((
        			SELECT 	',' + Y.WORKNM
        			FROM 	MCGOODDISPLAY X WITH(NOLOCK)
        			, 		(SELECT '0' AS WORKID, '전체' AS WORKNM UNION ALL SELECT WORKID, WORKNM FROM SMPWORKINFO WITH(NOLOCK)) Y
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			AND 	X.DISPLAY_TYPE = '20'
        			AND 	DISPLAY_TYPE_CD = Y.WORKID
        			ORDER BY GOOD_DISPLAY_ID
        			FOR XML PATH('')
        		), 1, 1, '') AS WORK
        , 		REPLACE(STUFF((
        			SELECT 	',' + dbo.FNS_BORG_STRING(X.BRANCHID)
        			FROM 	MCGOODDISPLAYBRANCH X WITH(NOLOCK)
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			ORDER BY GOOD_DISPLAY_BRANCH_ID
        			FOR XML PATH('')
        		), 1, 1, ''), '&amp;amp;gt;', '&gt;') AS BRANCH
        , 		ISNULL(B.MAKE_COMP_NAME, '') AS MAKE_COMP_NAME
        </if>
        
        <include refid="selectProductListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>
    
    <select id="selectProductModifyExcelList" resultType="hashmap">
    	/* product.selectProductModifyExcelList */
    	<include refid="selectProductCategorySql" />
		SELECT	A.GOOD_IDEN_NUMB
		,		A.GOOD_NAME
		,		A.GOOD_SPEC
		,		C.CATE_CD
		,		(SELECT	STUFF((
								SELECT ',' + AA.VALUE
								FROM	(
										SELECT	VALUE 
										FROM	FNS_SPLIT_SPECUSE(MAX(B.GOOD_SAME_WORD),'‡') 
										WHERE	VALUE != ''
								) AA
								FOR XML PATH('')
						),1,1,'')) AS GOOD_SAME_WORD
        <include refid="selectProductListSql" />
        GROUP BY A.GOOD_IDEN_NUMB,A.GOOD_NAME,A.GOOD_SPEC,C.CATE_CD
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>
    <select id="selectProductCategoryExcelList" resultType="hashmap">
    	/* product.selectProductCategoryExcelList */
    	<include refid="selectProductCategorySql" />
		SELECT	A.CATE_CD
		,		A.MAJO_CODE_NAME
		FROM	TMP_TABLE A
		WHERE	CATE_LEVEL=3
		ORDER BY A.CATE_CD
    </select>

    <sql id="selectPopProductListSql">
        FROM 	MCGOOD A WITH(NOLOCK)
        , 		MCGOODVENDOR B WITH(NOLOCK)
        INNER JOIN SMPBORGS C WITH(NOLOCK)
        	ON	B.VENDORID = C.BORGID
        	AND	C.ISUSE = '1'
        WHERE 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND 	ISNULL(A.REPRE_GOOD,'N') = 'N'
        AND		ISNULL(A.ADD_GOOD,'N') = 'N'
        AND 	A.ISDISTRIBUTE = '0'
        AND 	A.REPRE_GOOD_IDEN_NUMB IS NULL
        <if test="@MybatisUtils@isNotEmpty(good_iden_numb)">
        AND 	A.good_iden_numb = ${good_iden_numb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
        AND 	A.CATE_ID = #{srcCateId}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
        AND 	A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
        AND 	A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(nosearch_good_iden_numb)">
        AND		A.GOOD_IDEN_NUMB != #{nosearch_good_iden_numb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodVendorNm)">
        AND		C.BORGNM LIKE '%${srcGoodVendorNm}%'
        </if>
        <!-- 추가상품 구성상품은 전기/통신>통신소자, 전기/통신>통신함/기구물 카테고리에 한함 -->
        AND		EXISTS(	SELECT	1 
						FROM	MCCATEGORYMASTER X WITH(NOLOCK)
						INNER JOIN MCCATEGORYMASTER Y WITH(NOLOCK)
							ON	X.REF_CATE_SEQ = Y.CATE_ID
						WHERE	Y.CATE_CD IN ('B09','B11')
						AND		X.CATE_ID = A.CATE_ID
				)
    </sql>

    <select id="selectPopProductList_count" resultType="int">
        /* product.selectPopProductList_count */
        SELECT COUNT(1)
        <include refid="selectPopProductListSql" />
    </select>

    <select id="selectPopProductList" resultType="hashmap">
        /* product.selectPopProductList */
        SELECT A.GOOD_IDEN_NUMB
        , B.VENDORID
        , A.GOOD_NAME
        , A.GOOD_SPEC
        , (SELECT VENDORNM FROM SMPVENDORS X WITH(NOLOCK) WHERE B.VENDORID =
        X.VENDORID) AS VENDORNM
        , SELL_PRICE
        , SALE_UNIT_PRIC
        <include refid="selectPopProductListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectPopProductList2_count" resultType="int">
        /* product.selectProductList2_count */
        SELECT COUNT(1)
        FROM ( 
            SELECT A.GOOD_NAME
            <include refid="selectPopProductList2Sql" />
        )A
    </select>

    <select id="selectPopProductList2" resultType="hashmap">
        /* product.selectProductList2 */
        SELECT A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        , A.GOOD_SPEC
        , MAX(SELL_PRICE) AS SELL_PRICE1
        , MIN(SELL_PRICE) AS SELL_PRICE2
        , MAX(SALE_UNIT_PRIC) AS SALE_UNIT_PRIC1
        , MIN(SALE_UNIT_PRIC) AS SALE_UNIT_PRIC2
        <include refid="selectPopProductList2Sql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>
    <sql id="selectPopProductList2Sql">
        FROM MCGOOD A WITH(NOLOCK)
        , MCGOODVENDOR B WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND A.REPRE_GOOD = 'N'
        AND NOT EXISTS (SELECT 1
        FROM MCMAINDISPGOOD D WITH(NOLOCK)
        WHERE D.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
        AND D.WORKID = ${workid})
        <if test="@MybatisUtils@isNotEmpty(good_iden_numb)">
            AND A.good_iden_numb = ${good_iden_numb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
            AND A.CATE_ID = #{srcCateId}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
            AND A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
            AND A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
        GROUP BY A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        , A.GOOD_SPEC
    </sql>
    
    

    <insert id="insertGood">
        /* product.insertGood */
        INSERT INTO MCGOOD (
        GOOD_IDEN_NUMB
        , CATE_ID
        , REPRE_GOOD
        , GOOD_NAME
        , GOOD_REG_YEAR
        , NEW_BUSI
        , GOOD_SPEC
        , VTAX_CLAS_CODE
        , PRODUCT_MANAGER
        , ORDER_UNIT
        , GOOD_TYPE
        , VENDOR_EXPOSE
        , ISDISTRIBUTE
        , STOCK_MNGT
        , SKTS_IMG
        , SKTS_ORIGNAL_IMG_PATH
        , SKTS_LARGE_IMG_PATH
        , SKTS_MIDDLE_IMG_PATH
        , SKTS_SMALL_IMG_PATH
        , SKTS_GOOD_DESC
        , ADD_GOOD
        , ADD_GOOD_DESC
        , INSERT_DATE
        , INSERT_USER_ID
        ) VALUES (
        #{good_iden_numb}
        , #{cate_id}
        , #{repre_good}
        , #{good_name}
        , #{good_reg_year}
        , #{new_busi}
        , #{good_spec}
        , #{vtax_clas_code}
        , #{product_manager}
        , #{order_unit}
        , #{good_type}
        , #{vendor_expose}
        , #{isdistribute}
        , #{stock_mngt}
        , #{skts_img}
        , #{SKTS_ORIGNAL_IMG_PATH}
        , #{SKTS_LARGE_IMG_PATH}
        , #{SKTS_MIDDLE_IMG_PATH}
        , #{SKTS_SMALL_IMG_PATH}
        , #{skts_good_desc}
        , #{add_good}
        , #{add_good_desc}
        , GETDATE()
        , #{userInfoDto.userId}
        )
    </insert>

    <insert id="insertGoodHist">
        /* product.insertGoodHist */
        INSERT INTO MCGOOD_HIST (
        GOOD_HIST_ID
        , GOOD_IDEN_NUMB
        , CATE_ID
        , REPRE_GOOD
        , GOOD_NAME
        , GOOD_REG_YEAR
        , NEW_BUSI
        , GOOD_SPEC
        , VTAX_CLAS_CODE
        , PRODUCT_MANAGER
        , ORDER_UNIT
        , GOOD_TYPE
        , VENDOR_EXPOSE
        , ISDISTRIBUTE
        , STOCK_MNGT
        , SKTS_IMG
        , SKTS_ORIGNAL_IMG_PATH
        , SKTS_LARGE_IMG_PATH
        , SKTS_MIDDLE_IMG_PATH
        , SKTS_SMALL_IMG_PATH
        , SKTS_GOOD_DESC
        , ADD_GOOD
        , ADD_GOOD_DESC
        , INSERT_DATE
        , INSERT_USER_ID
        ) VALUES (
        #{good_hist_id}
        , #{good_iden_numb}
        , #{cate_id}
        , #{repre_good}
        , #{good_name}
        , #{good_reg_year}
        , #{new_busi}
        , #{good_spec}
        , #{vtax_clas_code}
        , #{product_manager}
        , #{order_unit}
        , #{good_type}
        , #{vendor_expose}
        , #{isdistribute}
        , #{stock_mngt}
        , #{skts_img}
        , #{SKTS_ORIGNAL_IMG_PATH}
        , #{SKTS_LARGE_IMG_PATH}
        , #{SKTS_MIDDLE_IMG_PATH}
        , #{SKTS_SMALL_IMG_PATH}
        , #{skts_good_desc}
        , #{add_good}
        , #{add_good_desc}
        , GETDATE()
        , #{userInfoDto.userId}
        )
    </insert>

    <update id="updateGood">
        /* product.updateGood */
        UPDATE MCGOOD
        SET CATE_ID = #{cate_id}
        , GOOD_NAME = #{good_name}
        , GOOD_REG_YEAR = #{good_reg_year}
        , NEW_BUSI = #{new_busi}
        , GOOD_SPEC = #{good_spec}
        , VTAX_CLAS_CODE = #{vtax_clas_code}
        , PRODUCT_MANAGER = #{product_manager}
        , ORDER_UNIT = #{order_unit}
        , GOOD_TYPE = #{good_type}
        , VENDOR_EXPOSE = #{vendor_expose}
        , ISDISTRIBUTE = #{isdistribute}
        , STOCK_MNGT = #{stock_mngt}
        , SKTS_IMG = #{skts_img}
        , SKTS_ORIGNAL_IMG_PATH = #{SKTS_ORIGNAL_IMG_PATH}
        , SKTS_LARGE_IMG_PATH = #{SKTS_LARGE_IMG_PATH}
        , SKTS_MIDDLE_IMG_PATH = #{SKTS_MIDDLE_IMG_PATH}
        , SKTS_SMALL_IMG_PATH = #{SKTS_SMALL_IMG_PATH}
        , SKTS_GOOD_DESC = #{skts_good_desc}
        , ADD_GOOD = #{add_good}
        , ADD_GOOD_DESC = #{add_good_desc}
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>

    <delete id="deleteAddGood">
        /* product.deleteAddGood */
        DELETE
        FROM MCADDGOOD
        WHERE good_iden_numb = ${good_iden_numb}
    </delete>

    <insert id="insertAddGood">
        /* product.insertAddGood */
        INSERT INTO MCADDGOOD (
        ADD_GOOD_ID
        , GOOD_IDEN_NUMB
        , ADD_GOOD_IDEN_NUMB
        , VENDORID
        ) VALUES (
        #{add_good_id}
        , #{good_iden_numb}
        , #{add_good_iden_numb}
        , #{vendorid}
        )
    </insert>

    <select id="selectProduct" resultType="hashmap">
        /* product.selectProduct */
        SELECT 	A.CATE_ID
        , 		dbo.FNS_CATE_STRING(A.CATE_ID) AS CATE_NM
        , 		A.GOOD_IDEN_NUMB
        , 		A.REPRE_GOOD
        , 		A.GOOD_NAME
        , 		A.GOOD_REG_YEAR
        , 		A.NEW_BUSI
        , 		A.GOOD_SPEC
        , 		A.VTAX_CLAS_CODE
        , 		A.PRODUCT_MANAGER
        , 		A.ORDER_UNIT
        , 		A.GOOD_TYPE
        , 		A.VENDOR_EXPOSE
        , 		A.ISDISTRIBUTE
        , 		A.STOCK_MNGT
        , 		A.SKTS_IMG
        , 		A.SKTS_ORIGNAL_IMG_PATH
        , 		A.SKTS_LARGE_IMG_PATH
        , 		A.SKTS_MIDDLE_IMG_PATH
        , 		A.SKTS_SMALL_IMG_PATH
        , 		A.SKTS_GOOD_DESC
        , 		A.ADD_GOOD
        , 		A.ADD_GOOD_DESC
        
		,		B.SPEC_SPEC
		,		B.SPEC_PI
		,		B.SPEC_WIDTH
		,		B.SPEC_DEEP
		,		B.SPEC_HEIGHT
		,		B.SPEC_LITER
		,		B.SPEC_TON
		,		B.SPEC_METER
		,		B.SPEC_MATERIAL
		,		B.SPEC_SIZE
		,		B.SPEC_WEIGHT_SUM
		,		B.SPEC_COLOR
		,		B.SPEC_TYPE
		,		B.SPEC_WEIGHT_REAL
        FROM 	MCGOOD A WITH(NOLOCK)
        LEFT OUTER JOIN MCGOOD_SPEC B WITH(NOLOCK)
        	ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        WHERE 	A.GOOD_IDEN_NUMB = ${good_iden_numb}
    </select>

    <select id="selectProductForReq" resultType="hashmap">
        /* product.selectProductForReq */
        SELECT 	A.REQ_GOOD_ID
        , 		A.GOOD_IDEN_NUMB
        , 		'N' AS REPRE_GOOD
        , 		A.GOOD_NAME
        , 		A.GOOD_SPEC_DESC AS GOOD_SPEC
        , 		A.GOOD_CLAS_CODE AS GOOD_TYPE
        , 		'Y' AS VENDOR_EXPOSE
        , 		'0' AS ISDISTRIBUTE
        , 		'N' AS STOCK_MNGT
        , 		'N' AS SKTS_IMG
        , 		'N' AS ADD_GOOD
        , 		A.MAKE_COMP_NAME
        , 		A.SALE_UNIT_PRIC
        , 		A.GOOD_INVENTORY_CNT
        , 		A.ORDE_CLAS_CODE
        , 		A.DELI_MINI_QUAN
        , 		A.DELI_MINI_DAY
        , 		A.ORIGINAL_IMG_PATH
        , 		A.SMALL_IMG_PATH
        , 		A.MIDDLE_IMG_PATH
        , 		A.LARGE_IMG_PATH
        , 		A.VENDORID
        , 		A.GOOD_DESC
        , 		A.GOOD_SAME_WORD
        , 		A.APP_STS
        , 		CONVERT(VARCHAR(16), A.INSERT_DATE, 120) AS INSERT_DATE
        , 		CONVERT(VARCHAR(16), A.CREATE_GOOD_DATE, 120) AS CREATE_GOOD_DATE
        , 		(SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.ADMIN_USER_ID) AS ADMIN_USER
        
		,		B.SPEC_SPEC
		,		B.SPEC_PI
		,		B.SPEC_WIDTH
		,		B.SPEC_DEEP
		,		B.SPEC_HEIGHT
		,		B.SPEC_LITER
		,		B.SPEC_TON
		,		B.SPEC_METER
		,		B.SPEC_MATERIAL
		,		B.SPEC_SIZE
		,		B.SPEC_WEIGHT_SUM
		,		B.SPEC_COLOR
		,		B.SPEC_TYPE
		,		B.SPEC_WEIGHT_REAL
        FROM MCGOODREQUEST A WITH(NOLOCK)
        LEFT OUTER JOIN MCGOODREQUEST_SPEC B WITH(NOLOCK)
        	ON	A.REQ_GOOD_ID = B.REQ_GOOD_ID
        WHERE A.REQ_GOOD_ID = ${req_good_id}
    </select>
    
    <select id="selectMcGoodRequestSpec" resultType="hashmap">
    	/* product.selectMcGoodRequestSpec */
    	SELECT	A.REQ_GOOD_ID
    	,		A.SPEC_SPEC
		,		A.SPEC_PI
		,		A.SPEC_WIDTH
		,		A.SPEC_DEEP
		,		A.SPEC_HEIGHT
		,		A.SPEC_LITER
		,		A.SPEC_TON
		,		A.SPEC_METER
		,		A.SPEC_MATERIAL
		,		A.SPEC_SIZE
		,		A.SPEC_WEIGHT_SUM
		,		A.SPEC_COLOR
		,		A.SPEC_TYPE
		,		A.SPEC_WEIGHT_REAL
    	FROM 	MCGOODREQUEST_SPEC A WITH(NOLOCK)
    	WHERE	A.REQ_GOOD_ID = ${req_good_id}
    </select>

    <select id="selectVendor" resultType="hashmap">
        /* product.selectVendor */
        SELECT PRESSENTNM
             , PHONENUM
          FROM SMPVENDORS A WITH(NOLOCK)
        WHERE A.VENDORID = #{vendorid}
    </select>

    <select id="selectProductForBid" resultType="hashmap">
        /* product.selectProductForBid */
        SELECT A.BIDID
        , A.VENDORID
        , 'N' AS REPRE_GOOD
        , A.GOOD_NAME
        , A.GOOD_SPEC_DESC AS GOOD_SPEC
        , '10' AS GOOD_TYPE
        , 'Y' AS VENDOR_EXPOSE
        , '0' AS ISDISTRIBUTE
        , 'N' AS STOCK_MNGT
        , 'N' AS SKTS_IMG
        , 'N' AS ADD_GOOD
        , GOOD_DESC
        , VENDORID
        , ORDE_CLAS_CODE AS ORDER_UNIT
        , SALE_UNIT_PRICE AS SALE_UNIT_PRIC
        FROM MCBIDAUCTION A WITH(NOLOCK)
        WHERE A.BIDID = ${bidid}
        AND A.VENDORID = #{vendorid}
    </select>

    <select id="selectProductForVen" resultType="hashmap">
        /* product.selectProductForVen */
        SELECT 
        	dbo.FNS_CATE_STRING(CATE_ID) AS CATE_NM
            , A.GOOD_IDEN_NUMB
            , A.REPRE_GOOD
            , A.GOOD_NAME
            , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.VTAX_CLAS_CODE = X.CODEVAL1 AND X.CODETYPECD = 'VTAXTYPECODE') AS VTAX_CLAS_CODE
            , A.GOOD_SPEC
            , DELI_MINI_QUAN
            , (SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.PRODUCT_MANAGER) AS PRODUCT_MANAGER
            , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.ORDER_UNIT = X.CODEVAL1 AND X.CODETYPECD = 'ORDERUNIT' AND X.ISUSE = '1') AS ORDER_UNIT
            , A.GOOD_TYPE
            , A.STOCK_MNGT
            , A.ADD_GOOD
            , DELI_MINI_DAY
            , ORIGINAL_IMG_PATH
            , MIDDLE_IMG_PATH
            , LARGE_IMG_PATH
            , MAKE_COMP_NAME
            , SALE_UNIT_PRIC
            , GOOD_INVENTORY_CNT
            , GOOD_DESC
            , GOOD_SAME_WORD
            , (SELECT TOP 1 APPLT_FIX_CODE FROM MCGOODFIX X WITH(NOLOCK) WHERE X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB AND X.VENDORID = B.VENDORID AND X.FIX_APP_STS = '0') AS APPLT_FIX_CODE
            , (CASE WHEN A.SKTS_IMG = 'Y' THEN A.SKTS_SMALL_IMG_PATH ELSE B.SMALL_IMG_PATH END) AS SMALL_IMG_PATH
        FROM MCGOOD A WITH(NOLOCK)
        , MCGOODVENDOR B WITH (NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND A.GOOD_IDEN_NUMB = ${good_iden_numb}
        AND B.VENDORID = #{vendorid}
    </select>
    
    <select id="selectProductSpec" resultType="hashmap">
    	/* product.selectProductSpec */
    	SELECT	A.GOOD_IDEN_NUMB
    	,		A.SPEC_SPEC
    	,		A.SPEC_PI
    	,		A.SPEC_WIDTH
		,		A.SPEC_DEEP
		,		A.SPEC_HEIGHT
		,		A.SPEC_LITER
		,		A.SPEC_TON
		,		A.SPEC_METER
		,		A.SPEC_MATERIAL
		,		A.SPEC_SIZE
		,		A.SPEC_WEIGHT_SUM
		,		A.SPEC_COLOR
		,		A.SPEC_TYPE
		,		A.SPEC_WEIGHT_REAL
    	FROM 	MCGOOD_SPEC A WITH(NOLOCK)
    	WHERE	A.GOOD_IDEN_NUMB = ${good_iden_numb}
    </select>

    <sql id="selectAddGoodListSql">
        FROM MCGOOD A WITH(NOLOCK)
        , MCADDGOOD B WITH(NOLOCK)
        , MCGOODVENDOR C WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = B.ADD_GOOD_IDEN_NUMB
        AND B.ADD_GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
        AND B.VENDORID = C.VENDORID
        AND B.GOOD_IDEN_NUMB = #{good_iden_numb}
    </sql>

    <select id="selectAddGoodList_count" resultType="int">
        /* product.selectAddGoodList_count */
        SELECT COUNT(1)
        <include refid="selectAddGoodListSql" />
    </select>

    <select id="selectAddGoodList" resultType="hashmap">
        /* product.selectAddGoodList */
        SELECT A.GOOD_IDEN_NUMB
        , B.VENDORID
        , A.GOOD_NAME
        , A.GOOD_SPEC
        , (SELECT VENDORNM FROM SMPVENDORS X WITH(NOLOCK) WHERE B.VENDORID =
        X.VENDORID) AS VENDORNM
        , SELL_PRICE
        , SALE_UNIT_PRIC
        <include refid="selectAddGoodListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <sql id="selectGoodVendorListForNewSql">
        FROM	MCGOOD A WITH(NOLOCK)
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
        	ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        INNER JOIN SMPVENDORS C WITH(NOLOCK)
        	ON	B.VENDORID = C.VENDORID
        INNER JOIN SMPBORGS D WITH(NOLOCK)
        	ON	C.VENDORID = D.BORGID
        	AND	D.ISUSE = '1'
        WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
    </sql>

    <sql id="selectGoodVendorListForDisSql">
        FROM	MCGOOD A WITH(NOLOCK)
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
        	ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		LEFT OUTER JOIN MCGOODFIX B1
			ON 	B.GOOD_IDEN_NUMB = B1.GOOD_IDEN_NUMB
			AND B.VENDORID = B1.VENDORID
			AND B1.FIX_APP_STS = '0'        	
        INNER JOIN SMPVENDORS C WITH(NOLOCK)
        	ON	B.VENDORID = C.VENDORID
        INNER JOIN SMPBORGS D WITH(NOLOCK)
        	ON	C.VENDORID = D.BORGID
        	AND	D.ISUSE = '1'
        WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
    </sql>

    <select id="selectGoodVendorListForNew_count" resultType="int">
        /* product.selectGoodVendorListForNew_count */
        SELECT COUNT(1)
        <include refid="selectGoodVendorListForNewSql" />
    </select>
   
    <select id="selectGoodVendorListForNew" resultType="hashmap">
        /* product.selectGoodVendorListForNew */
        SELECT VENDOR_PRIORITY
        , VENDORNM
        , SELL_PRICE
        , SALE_UNIT_PRIC
        , SELL_ADD
        , SALE_ADD
        , DISTRI_RATE
        , B.ISUSE
        , B.VENDORID
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE AREATYPE = X.CODEVAL1 AND X.CODETYPECD = 'DELI_AREA_CODE') AS AREATYPENM
        , PRESSENTNM
        , PHONENUM
        , DELI_MINI_QUAN
        , DELI_MINI_DAY
        , GOOD_INVENTORY_CNT
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , SMALL_IMG_PATH
        , MIDDLE_IMG_PATH
        , LARGE_IMG_PATH
        , GOOD_DESC
        , GOOD_SAME_WORD
        , 'U' AS ISNEW
        , (SELECT TOP 1 Z.GOOD_IDEN_NUMB FROM MCADDGOOD Z WITH(NOLOCK) WHERE Z.ADD_GOOD_IDEN_NUMB=B.GOOD_IDEN_NUMB AND Z.VENDORID=B.VENDORID) AS MASTER_GOOD_IDEN_NUMB
        , B.BUY_RATE
        <include refid="selectGoodVendorListForNewSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ISUSE DESC, ${orderString}
        </if>
    </select>
    
	<select id="selectGoodVendorListForDis_count" resultType="int">
        /* product.selectGoodVendorListForDis_count */
        SELECT COUNT(1)
        <include refid="selectGoodVendorListForDisSql" />
    </select>    

    <select id="selectGoodVendorListForDis" resultType="hashmap">
        /* product.selectGoodVendorListForDis */
        SELECT VENDOR_PRIORITY
        , VENDORNM
        , SELL_ADD
        , SALE_ADD
        , DISTRI_RATE
        , B.ISUSE
        , B.VENDORID
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE AREATYPE = X.CODEVAL1 AND X.CODETYPECD = 'DELI_AREA_CODE') AS AREATYPENM
        , PRESSENTNM
        , PHONENUM
        , DELI_MINI_QUAN
        , DELI_MINI_DAY
        , GOOD_INVENTORY_CNT
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , SMALL_IMG_PATH
        , MIDDLE_IMG_PATH
        , LARGE_IMG_PATH
        , GOOD_DESC
        , GOOD_SAME_WORD
        , 'U' AS ISNEW
        , (SELECT TOP 1 Z.GOOD_IDEN_NUMB FROM MCADDGOOD Z WITH(NOLOCK) WHERE Z.ADD_GOOD_IDEN_NUMB=B.GOOD_IDEN_NUMB AND Z.VENDORID=B.VENDORID) AS MASTER_GOOD_IDEN_NUMB
        , B.BUY_RATE
		, B1.PRICE AS SALE_UNIT_PRIC
		, (CASE WHEN (B1.APPLT_FIX_CODE='20' AND B1.FIX_APP_STS='0' AND ISNULL(B.BUY_RATE,0)>0) THEN CEILING(100*B1.PRICE/(100-B.BUY_RATE)) 
				WHEN (B1.APPLT_FIX_CODE='20' AND B1.FIX_APP_STS='0' AND ISNULL(B.BUY_RATE,0)=0) THEN B.SELL_PRICE
			END) AS SELL_PRICE        
        <include refid="selectGoodVendorListForDisSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ISUSE DESC, ${orderString}
        </if>
    </select>

    <select id="selectGoodVendorListForReq_count" resultType="int">
        /* product.selectGoodVendorListForReq_count */
        SELECT 1
    </select>

    <select id="selectGoodVendorListForReq" resultType="hashmap">
        /* product.selectGoodVendorListForReq */
        SELECT 0 AS VENDOR_PRIORITY
        , VENDORNM
        , 0 AS SELL_PRICE
        , SALE_UNIT_PRIC
        , 0 AS DISTRI_RATE
        , '1' AS ISUSE
        , C.VENDORID
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE AREATYPE =
        X.CODEVAL1 AND X.CODETYPECD = 'DELI_AREA_CODE') AS AREATYPENM
        , PRESSENTNM
        , PHONENUM
        , DELI_MINI_QUAN
        , DELI_MINI_DAY
        , GOOD_INVENTORY_CNT
        , MAKE_COMP_NAME
        , '0' AS ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , SMALL_IMG_PATH
        , MIDDLE_IMG_PATH
        , LARGE_IMG_PATH
        , GOOD_DESC
        , GOOD_SAME_WORD
        , 'A' AS ISNEW
        FROM MCGOODREQUEST A WITH(NOLOCK)
        , SMPVENDORS C WITH(NOLOCK)
        WHERE A.REQ_GOOD_ID = ${req_good_id}
        AND C.VENDORID = A.VENDORID
    </select>

    <select id="selectGoodVendorListForBid_count" resultType="int">
        /* product.selectGoodVendorListForBid_count */
        SELECT 1
    </select>

    <select id="selectGoodVendorListForBid" resultType="hashmap">
        /* product.selectGoodVendorListForBid */
        SELECT 	0 AS VENDOR_PRIORITY
        , 		VENDORNM
        , 		0 AS SELL_PRICE
        , 		A.SALE_UNIT_PRICE AS SALE_UNIT_PRIC
        , 		0 AS DISTRI_RATE
        , 		'1' AS ISUSE
        , 		C.VENDORID
        , 		(SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE AREATYPE = X.CODEVAL1 AND X.CODETYPECD = 'DELI_AREA_CODE') AS AREATYPENM
        , 		PRESSENTNM
        , 		PHONENUM
        , 		DELI_MINI_QUAN
        , 		DELI_MINI_DAY
        , 		0 AS GOOD_INVENTORY_CNT
        , 		MAKE_COMP_NAME
        , 		'0' AS ISSUB_ONTRACT
        , 		ORIGINAL_IMG_PATH
        , 		SMALL_IMG_PATH
        , 		MIDDLE_IMG_PATH
        , 		LARGE_IMG_PATH
        , 		GOOD_DESC
        , 		GOOD_SAME_WORD
        , 		'A' AS ISNEW
        FROM 	MCBIDAUCTION A WITH(NOLOCK)
        , 		SMPVENDORS C WITH(NOLOCK)
        WHERE 	A.BIDID = ${bidid}
        AND 	A.VENDORID = #{bid_vendorid}
        AND 	C.VENDORID = A.VENDORID
    </select>

    <select id="selectGoodVendorListForMngt_count" resultType="int">
        /* product.selectGoodVendorListForMngt_count */
        SELECT COUNT(1)
        <include refid="selectGoodVendorListForNewSql" />
    </select>

    <select id="selectGoodVendorListForMngt" resultType="hashmap">
        /* product.selectGoodVendorListForMngt */
        SELECT 	VENDORNM
        , 		B.VENDORID
        , 		STUFF((
        			SELECT 	',' + Y.CODENM1
        			FROM 	MCGOODDISPLAY X WITH(NOLOCK)
        			, 		SMPCODES Y WITH(NOLOCK)
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			AND 	X.DISPLAY_TYPE = '10'
        			AND 	Y.CODETYPECD = 'DELI_AREA_CODE'
        			AND 	DISPLAY_TYPE_CD = Y.CODEVAL1
        			ORDER BY DISORDER
        			FOR XML PATH('')
        		), 1, 1, '') AS DELI
        , 		STUFF((
        			SELECT 	',' + Y.WORKNM
        			FROM 	MCGOODDISPLAY X WITH(NOLOCK)
        			, 		(SELECT '0' AS WORKID, '전체' AS WORKNM UNION ALL SELECT WORKID, WORKNM FROM SMPWORKINFO WITH(NOLOCK)) Y
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			AND 	X.DISPLAY_TYPE = '20'
        			AND 	DISPLAY_TYPE_CD = Y.WORKID
        			ORDER BY GOOD_DISPLAY_ID
        			FOR XML PATH('')
        		), 1, 1, '') AS WORK
        , 		REPLACE(STUFF((
        			SELECT 	',' + dbo.FNS_BORG_STRING(X.BRANCHID)
        			FROM 	MCGOODDISPLAYBRANCH X WITH(NOLOCK)
        			WHERE 	X.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        			AND 	X.VENDORID = B.VENDORID
        			ORDER BY GOOD_DISPLAY_BRANCH_ID
        			FOR XML PATH('')
        		), 1, 1, ''), '&amp;amp;gt;', '&gt;') AS BRANCH
        <include refid="selectGoodVendorListForNewSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <insert id="insertGoodVendor">
        /* product.insertGoodVendor */
        INSERT INTO MCGOODVENDOR (
        GOOD_IDEN_NUMB
        , VENDORID
        , SELL_PRICE
        , SALE_UNIT_PRIC
        , SELL_ADD
        , SALE_ADD
        , VENDOR_PRIORITY
        , DELI_MINI_QUAN
        , GOOD_INVENTORY_CNT
        , DELI_MINI_DAY
        , DISTRI_RATE
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , LARGE_IMG_PATH
        , MIDDLE_IMG_PATH
        , SMALL_IMG_PATH
        , GOOD_SAME_WORD
        , GOOD_DESC
        , REGIST_DATE
        , REQ_GOOD_ID
        , BUY_RATE
        ) VALUES (
        #{good_iden_numb}
        , #{VENDORID}
        , #{SELL_PRICE}
        , #{SALE_UNIT_PRIC}
        , #{SELL_ADD}
        , #{SALE_ADD}
        , #{VENDOR_PRIORITY}
        , #{DELI_MINI_QUAN}
        , #{GOOD_INVENTORY_CNT}
        , #{DELI_MINI_DAY}
        , #{DISTRI_RATE}
        , #{MAKE_COMP_NAME}
        , #{ISSUB_ONTRACT}
        , #{ORIGINAL_IMG_PATH}
        , #{LARGE_IMG_PATH}
        , #{MIDDLE_IMG_PATH}
        , #{SMALL_IMG_PATH}
        , #{GOOD_SAME_WORD}
        , #{GOOD_DESC}
        , GETDATE()
        , #{req_good_id}
    	<if test="@MybatisUtils@isNotEmpty(BUY_RATE)">
    	, #{BUY_RATE}
    	</if>
    	<if test="@MybatisUtils@isEmpty(BUY_RATE)">
    	, null
    	</if>
        )
    </insert>

    <insert id="insertGoodVendorHist">
        /* product.insertGoodVendorHist */
        INSERT INTO MCGOODVENDOR_HIST (
        GOOD_HIST_ID
        , GOOD_IDEN_NUMB
        , VENDORID
        , SELL_PRICE
        , SALE_UNIT_PRIC
        , VENDOR_PRIORITY
        , DELI_MINI_QUAN
        , GOOD_INVENTORY_CNT
        , DELI_MINI_DAY
        , DISTRI_RATE
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , LARGE_IMG_PATH
        , MIDDLE_IMG_PATH
        , SMALL_IMG_PATH
        , GOOD_SAME_WORD
        , GOOD_DESC
        , REGIST_DATE
        , BUY_RATE
        , INSERT_USER_ID
        ) VALUES (
        #{good_hist_id}
        , #{good_iden_numb}
        , #{VENDORID}
        , #{SELL_PRICE}
        , #{SALE_UNIT_PRIC}
        , #{VENDOR_PRIORITY}
        , #{DELI_MINI_QUAN}
        , #{GOOD_INVENTORY_CNT}
        , #{DELI_MINI_DAY}
        , #{DISTRI_RATE}
        , #{MAKE_COMP_NAME}
        , #{ISSUB_ONTRACT}
        , #{ORIGINAL_IMG_PATH}
        , #{LARGE_IMG_PATH}
        , #{MIDDLE_IMG_PATH}
        , #{SMALL_IMG_PATH}
        , #{GOOD_SAME_WORD}
        , #{GOOD_DESC}
        , GETDATE()
    	<if test="@MybatisUtils@isNotEmpty(BUY_RATE)">
    	, #{BUY_RATE}
    	</if>
    	<if test="@MybatisUtils@isEmpty(BUY_RATE)">
    	, null
    	</if>
    	, #{userInfoDto.userId}
        )
    </insert>

    <update id="updateGoodVendor">
        /* product.updateGoodVendor */
        UPDATE MCGOODVENDOR
        SET VENDOR_PRIORITY = #{VENDOR_PRIORITY}
        , DELI_MINI_QUAN = #{DELI_MINI_QUAN}
        , DELI_MINI_DAY = #{DELI_MINI_DAY}
        , DISTRI_RATE = #{DISTRI_RATE}
        , MAKE_COMP_NAME = #{MAKE_COMP_NAME}
        , ISSUB_ONTRACT = #{ISSUB_ONTRACT}
        , ORIGINAL_IMG_PATH = #{ORIGINAL_IMG_PATH}
        , LARGE_IMG_PATH = #{LARGE_IMG_PATH}
        , MIDDLE_IMG_PATH = #{MIDDLE_IMG_PATH}
        , SMALL_IMG_PATH = #{SMALL_IMG_PATH}
        <if test="repre_good eq 'Y'.toString()">
        , SELL_PRICE = #{SELL_PRICE}
        , SALE_UNIT_PRIC = #{SALE_UNIT_PRIC}
        , SELL_ADD = #{SELL_ADD}
        , SALE_ADD = #{SALE_ADD}
        </if>
        , GOOD_SAME_WORD = #{GOOD_SAME_WORD}
        , GOOD_DESC = #{GOOD_DESC}
        ,		UPDATE_DATE = GETDATE()
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
        AND VENDORID = #{VENDORID}
    </update>

	<update id="updateGoodVendorForOptionByGoodVendorChg">
		/* product.updateGoodVendorForOptionByGoodVendorChg */
		UPDATE	D
		SET		SELL_PRICE = CASE WHEN C.PIMS IS NOT NULL THEN A.SELL_PRICE+(C.PIMS-1)*A.SELL_ADD ELSE D.SELL_PRICE END
		,		SALE_UNIT_PRIC = CASE WHEN C.PIMS IS NOT NULL THEN A.SALE_UNIT_PRIC+(C.PIMS-1)*A.SALE_ADD ELSE D.SALE_UNIT_PRIC END
		FROM	MCGOODVENDOR A WITH(NOLOCK) 
		INNER JOIN MCGOOD B WITH(NOLOCK) 
			ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		INNER JOIN MCGOOD C WITH(NOLOCK) 
			ON	B.GOOD_IDEN_NUMB = C.REPRE_GOOD_IDEN_NUMB
		INNER JOIN MCGOODVENDOR D WITH(NOLOCK) 
			ON	C.GOOD_IDEN_NUMB = D.GOOD_IDEN_NUMB
			AND	A.VENDORID = D.VENDORID
		WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
		AND		A.VENDORID = #{VENDORID}
	</update>
    
	<select id="selectGoodVendorPriceChangeFlag" resultType="hashmap">
		/* product.selectGoodVendorPriceChangeFlag */
		SELECT	(CASE WHEN A.SELL_PRICE=CONVERT(DECIMAL,#{SELL_PRICE}) THEN 0 ELSE 1 END) AS IS_SELL_PRICE_CHG
		,			(CASE WHEN A.SALE_UNIT_PRIC=CONVERT(DECIMAL,#{SALE_UNIT_PRIC}) THEN 0 ELSE 1 END) AS IS_SALE_UNIT_PRIC_CHG
		,			(CASE WHEN A.SELL_ADD=CONVERT(DECIMAL,#{SELL_ADD}) THEN 0 ELSE 1 END) AS IS_SELL_ADD_CHG
		,			(CASE WHEN A.SALE_ADD=CONVERT(DECIMAL,#{SALE_ADD}) THEN 0 ELSE 1 END) AS IS_SALE_ADD_CHG
		FROM 	MCGOODVENDOR A WITH(NOLOCK)
		WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
		AND		A.VENDORID = #{VENDORID}
	</select>
	<select id="selectGoodVendorOptList" resultType="hashmap">
		/* product.selectGoodVendorOptList */
		SELECT	B.GOOD_IDEN_NUMB
		,			B.VENDORID
		<choose>
			<when test="sell_sale_type eq 'SALE'">
		,			(CASE WHEN A.PIMS IS NOT NULL THEN #{SELL_PRICE}+(A.PIMS-1)*#{SELL_ADD} ELSE B.SELL_PRICE END) AS SELL_PRICE
			</when>
			<otherwise>
		,			B.SELL_PRICE
			</otherwise>
		</choose>
		<choose>
			<when test="sell_sale_type eq 'BUY'">
		,			(CASE WHEN A.PIMS IS NOT NULL THEN #{SALE_UNIT_PRIC}+(A.PIMS-1)*#{SALE_ADD} ELSE B.SALE_UNIT_PRIC END) AS SALE_UNIT_PRIC
			</when>
			<otherwise>
		,			B.SALE_UNIT_PRIC
			</otherwise>
		</choose>
		FROM	MCGOOD A WITH(NOLOCK)
		INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
			ON	A.good_iden_numb = B.good_iden_numb
		WHERE	1 = 1
		AND		A.repre_good_iden_numb = #{good_iden_numb}
		AND		B.vendorid = #{VENDORID}
	</select>
	<insert id="insertPriceChgHistByMasterChg">
		/* product.insertPriceChgHistByMasterChg */
		INSERT INTO MCPRICECHGHIST (
				PRICE_CHG_HIST_ID
		, 		GOOD_IDEN_NUMB
		, 		VENDORID
		, 		SELL_SALE_TYPE
		, 		SELL_PRICE
		, 		SALE_UNIT_PRIC
		, 		CHG_REASON
		, 		INSERT_DATE
		, 		INSERT_USER_ID
		) VALUES (
				#{price_chg_hist_id}
		,		#{GOOD_IDEN_NUMB}
		,		#{VENDORID}
		,		#{sell_sale_type}
		,		#{SELL_PRICE}
		,		#{SALE_UNIT_PRIC}
		,		#{chg_reason}
		,		GETDATE()
		,		#{userInfoDto.userId}
		)
	</insert>

    <sql id="selectPriceHistListSql">
        FROM MCPRICECHGHIST A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = ${good_iden_numb}
        AND A.VENDORID = #{vendorid}
        AND A.SELL_SALE_TYPE = #{sell_sale_type}
    </sql>

    <select id="selectPriceHistList_count" resultType="int">
        /* product.selectPriceHistList_count */
        SELECT COUNT(1)
        <include refid="selectPriceHistListSql" />
    </select>

    <select id="selectPriceHistList" resultType="hashmap">
        /* product.selectPriceHistList */
        SELECT SELL_PRICE
        , SALE_UNIT_PRIC
        , CHG_REASON
        , CONVERT(VARCHAR(16), INSERT_DATE, 120) AS INSERT_DATE
        , (SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.INSERT_USER_ID)
        AS USER_NM
        <include refid="selectPriceHistListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <sql id="selectStockHistListSql">
        FROM MCSTOCKCHGHIST A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = ${good_iden_numb}
        AND A.VENDORID = #{vendorid}
    </sql>

    <select id="selectStockHistList_count" resultType="int">
        /* product.selectStockHistList_count */
        SELECT COUNT(1)
        <include refid="selectStockHistListSql" />
    </select>

    <select id="selectStockHistList" resultType="hashmap">
        /* product.selectStockHistList */
        SELECT STOCK_VARIATION
        , STOCK
        , CHG_REASON
        , ORDER_IDEN_NUMB
        , CONVERT(VARCHAR(16), INSERT_DATE, 120) AS INSERT_DATE
        , (SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.INSERT_USER_ID)
        AS USER_NM
        <include refid="selectStockHistListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <insert id="insertPriceChgHist">
        /* product.insertPriceChgHist */
        INSERT INTO MCPRICECHGHIST (
        		PRICE_CHG_HIST_ID
        , 		GOOD_IDEN_NUMB
        , 		VENDORID
        , 		SELL_SALE_TYPE
        
        , 		SELL_PRICE
        , 		SALE_UNIT_PRIC
        
        , 		CHG_REASON
        , 		INSERT_DATE
        , 		INSERT_USER_ID
        )
        SELECT 	#{price_chg_hist_id}
        , 		good_iden_numb
        , 		vendorid
        , 		#{sell_sale_type}
        
        <if test="sell_sale_type eq 'SALE'">
		, 		#{chgprice}
		, 		sale_unit_pric
        </if>
        <if test="sell_sale_type eq 'BUY'">
        	<if test="@MybatisUtils@isNotEmpty(sellPrice)">
        ,		#{sellPrice}
        	</if>
        	<if test="@MybatisUtils@isEmpty(sellPrice)">
		, 		sell_price
			</if>
		, 		#{chgprice}
        </if>
        
        , 		#{chg_reason}
        , 		GETDATE()
        , 		#{userInfoDto.userId}
        FROM 	MCGOODVENDOR A WITH(NOLOCK)
        WHERE 	A.GOOD_IDEN_NUMB = ${good_iden_numb}
        AND 	A.VENDORID = #{vendorid}
    </insert>

    <update id="updateGoodVendorForPrice">
        /* product.updateGoodVendorForPrice */
        UPDATE 	MCGOODVENDOR
        <if test="sell_sale_type eq 'SALE'">
		SET 	SELL_PRICE = #{chgprice}
        </if>
        <if test="sell_sale_type eq 'BUY'">
		SET 	SALE_UNIT_PRIC = #{chgprice}
			<if test="@MybatisUtils@isNotEmpty(sellPrice)">
		,		SELL_PRICE = #{sellPrice}
			</if>
        </if>
        ,		UPDATE_DATE = GETDATE()
        WHERE GOOD_IDEN_NUMB = ${good_iden_numb}
        AND VENDORID = #{vendorid}
    </update>

    <insert id="insertStockChgHist">
        /* product.insertStockChgHist */
        INSERT INTO MCSTOCKCHGHIST (
        STOCK_CHG_HIST_ID
        , GOOD_IDEN_NUMB
        , VENDORID
        , CHG_REASON
        , STOCK_VARIATION
        , STOCK
        , INSERT_DATE
        , INSERT_USER_ID
        )
        SELECT #{stock_chg_hist_id}
        , good_iden_numb
        , vendorid
        , #{chg_reason}
        , #{chgStock}
        , ISNULL(GOOD_INVENTORY_CNT,0) + #{chgStock}
        , GETDATE()
        , #{userInfoDto.userId}
        FROM MCGOODVENDOR A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = ${good_iden_numb}
        AND A.VENDORID = #{vendorid}
    </insert>

    <update id="updateGoodVendorForStock">
        /* product.updateGoodVendorForStock */
        UPDATE MCGOODVENDOR
        SET GOOD_INVENTORY_CNT = ISNULL(GOOD_INVENTORY_CNT,0) + #{chgStock}
        ,		UPDATE_DATE = GETDATE()
        WHERE GOOD_IDEN_NUMB = ${good_iden_numb}
        AND VENDORID = #{vendorid}
    </update>

    <select id="selectDeliAreaList" resultType="hashmap">
        /* product.selectDeliAreaList */
        SELECT A.CODEVAL1
        , A.CODENM1
        , B.GOOD_DISPLAY_ID
        FROM SMPCODES A WITH(NOLOCK)
        LEFT JOIN MCGOODDISPLAY B WITH(NOLOCK)
        	ON GOOD_IDEN_NUMB = ${good_iden_numb}
	        AND VENDORID = #{vendorid}
	        AND DISPLAY_TYPE = '10'
	        AND A.CODEVAL1 = DISPLAY_TYPE_CD
        WHERE A.CODETYPECD = 'DELI_AREA_CODE'
        	AND A.ISUSE = 1
        ORDER BY DISORDER
    </select>

    <select id="selectWorkInfoList1" resultType="hashmap">
        /* product.selectWorkInfoList1 */
        SELECT A.WORKID
        , A.WORKNM
        FROM SMPWORKINFO A WITH(NOLOCK)
        WHERE A.IS_SKTS_MANAGE = 1
    </select>

    <select id="selectWorkInfoList2" resultType="hashmap">
        /* product.selectWorkInfoList2 */
        SELECT B.GOOD_DISPLAY_ID
        , A.WORKID
        , A.WORKNM
        FROM (SELECT '0' AS WORKID, '전체' AS WORKNM UNION ALL SELECT WORKID, WORKNM FROM SMPWORKINFO WITH(NOLOCK) WHERE IS_SKTS_MANAGE = 1) A
        , MCGOODDISPLAY B WITH(NOLOCK)
        WHERE DISPLAY_TYPE = '20' 
        AND GOOD_IDEN_NUMB = ${good_iden_numb}
        AND VENDORID = #{vendorid}
        AND A.WORKID = DISPLAY_TYPE_CD
    </select>

    <select id="selectWorkInfoList3_count" resultType="int">
        /* product.selectWorkInfoList3_count */
        SELECT COUNT(1)
        FROM SMPWORKINFO A WITH(NOLOCK)
        WHERE A.IS_SKTS_MANAGE = 1
    </select>

    <select id="selectWorkInfoList3" resultType="hashmap">
        /* product.selectWorkInfoList3 */
        SELECT A.WORKID
        , A.WORKNM
        , (SELECT X.USERNM FROM SMPUSERS X WITH(NOLOCK) WHERE X.USERID = A.USERID) AS USERNM
        , (SELECT COUNT(1) FROM MCMAINDISPGOOD X WITH(NOLOCK) WHERE X.WORKID = A.WORKID) AS PROD_CNT
        FROM SMPWORKINFO A WITH(NOLOCK)
        WHERE A.IS_SKTS_MANAGE = 1
    </select>

    <select id="selectBranchList" resultType="hashmap">
        /* product.selectBranchList */
        SELECT A.GOOD_DISPLAY_BRANCH_ID
        , A.BRANCHID
        , dbo.FNS_BORG_STRING(A.BRANCHID) AS BRANCHNM
        FROM MCGOODDISPLAYBRANCH A WITH(NOLOCK)
        WHERE GOOD_IDEN_NUMB = ${good_iden_numb}
        AND VENDORID = #{vendorid}
    </select>

    <insert id="insertGoodDisplay">
        /* product.insertGoodDisplay */
        INSERT INTO MCGOODDISPLAY (
        GOOD_DISPLAY_ID
        , GOOD_IDEN_NUMB
        , VENDORID
        , DISPLAY_TYPE
        , DISPLAY_TYPE_CD
        , INSERT_DATE
        , INSERT_USER_ID
        ) VALUES (
        #{good_display_id}
        , #{good_iden_numb}
        , #{vendorid}
        , #{display_type}
        , #{display_type_cd}
        , GETDATE()
        , #{userInfoDto.userId}
        )
    </insert>

    <delete id="deleteGoodDisplay">
        /* product.deleteGoodDisplay */
        DELETE FROM MCGOODDISPLAY
        WHERE GOOD_DISPLAY_ID = ${good_display_id}
    </delete>

    <insert id="insertGoodDisplayBranch">
        /* product.insertGoodDisplayBranch */
        INSERT INTO MCGOODDISPLAYBRANCH (
        GOOD_DISPLAY_BRANCH_ID
        , GOOD_IDEN_NUMB
        , VENDORID
        , BRANCHID
        , INSERT_DATE
        , INSERT_USER_ID
        ) VALUES (
        #{good_display_branch_id}
        , #{good_iden_numb}
        , #{vendorid}
        , #{branchid}
        , GETDATE()
        , #{userInfoDto.userId}
        )
    </insert>

    <delete id="deleteGoodDisplayBranch">
        /* product.deleteGoodDisplay */
        DELETE FROM MCGOODDISPLAYBRANCH
        WHERE GOOD_DISPLAY_BRANCH_ID = ${good_display_branch_id}
    </delete>

    <delete id="deleteGoodVendorForNew">
        /* product.deleteGoodVendorForNew */
        DELETE FROM MCGOODVENDOR
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
        AND VENDORID = #{vendorid}
    </delete>

    <delete id="deleteGoodVendorForOption2">
        /* product.deleteGoodVendorForOption */
        DELETE FROM MCGOODVENDOR
        WHERE GOOD_IDEN_NUMB IN (SELECT GOOD_IDEN_NUMB FROM MCGOOD WITH(NOLOCK)
        WHERE REPRE_GOOD_IDEN_NUMB = #{good_iden_numb})
        AND VENDORID = #{vendorid}
    </delete>

    <update id="updateGoodVendorForUse">
        /* product.updateGoodVendorForUse */
        UPDATE MCGOODVENDOR
        SET ISUSE = #{use}
        ,		UPDATE_DATE = GETDATE()
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
        AND VENDORID = #{vendorid}
    </update>

    <select id="selectCommonOptionList_count" resultType="int">
        SELECT 3
    </select>

    <select id="selectCommonOptionList" resultType="hashmap">
        /* product.selectCommonOption */
        SELECT TOP 3
        GOOD_COMMON_OPTION_ID
        , ROW_NUMBER() OVER(ORDER BY B.GOOD_IDEN_NUMB DESC) AS OPTION_TYPE
        , OPTION_NAME
        , OPTION_VALUE
        FROM MCGOOD A WITH(NOLOCK)
        LEFT JOIN MCGOODCOMMONOPTION B WITH (NOLOCK)
        ON B.GOOD_IDEN_NUMB = #{good_iden_numb}
    </select>

    <select id="selectSpecOptionList_count" resultType="int">
        /* product.selectSpecOptionList_count */
        SELECT COUNT(1)
        FROM MCGOOD A WITH(NOLOCK)
        WHERE A.REPRE_GOOD_IDEN_NUMB = #{good_iden_numb}
    </select>

    <select id="selectSpecOptionList" resultType="hashmap">
        /* product.selectSpecOptionList */
        SELECT GOOD_IDEN_NUMB
        , GOOD_SPEC
        , PIMS
        FROM MCGOOD A WITH(NOLOCK)
        WHERE A.REPRE_GOOD_IDEN_NUMB = #{good_iden_numb}
        ORDER BY PIMS
    </select>

    <select id="selectSpecOptionVendorList_count" resultType="int">
        /* product.selectSpecOptionVendorList_count */
        SELECT COUNT(1)
        FROM MCGOOD A WITH(NOLOCK)
        , MCGOODVENDOR B WITH(NOLOCK)
        WHERE A.REPRE_GOOD_IDEN_NUMB = #{good_iden_numb}
        AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
    </select>

    <select id="selectSpecOptionVendorList" resultType="hashmap">
        /* product.selectSpecOptionVendorList */
        SELECT A.GOOD_IDEN_NUMB
        , B.VENDORID
        , A.GOOD_SPEC
        , (SELECT VENDORNM FROM SMPVENDORS X WITH(NOLOCK) WHERE B.VENDORID =
        X.VENDORID) AS VENDORNM
        , ISNULL(B.SELL_PRICE, 0) AS SELL_PRICE
        , ISNULL(B.SALE_UNIT_PRIC, 0) AS SALE_UNIT_PRIC
        , ISNULL(B.GOOD_INVENTORY_CNT, 0) AS GOOD_INVENTORY_CNT
        FROM MCGOOD A WITH(NOLOCK)
        , MCGOODVENDOR B WITH(NOLOCK)
        WHERE A.REPRE_GOOD_IDEN_NUMB = #{good_iden_numb}
        AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        <if test="@MybatisUtils@isNotEmpty(optVendor)">
            AND B.VENDORID = #{optVendor}
        </if>
        <if test="@MybatisUtils@isNotEmpty(vendorid)">
            AND B.VENDORID = #{vendorid}
        </if>
        <if test="@MybatisUtils@isNotEmpty(optOption)">
            AND A.GOOD_IDEN_NUMB = #{optOption}
        </if>
        ORDER BY A.PIMS, B.VENDORID
    </select>


    <insert id="insertGoodCommonOption">
        /* product.insertGoodCommonOption */
        INSERT INTO MCGOODCOMMONOPTION (
        GOOD_COMMON_OPTION_ID
        , GOOD_IDEN_NUMB
        , OPTION_TYPE
        , OPTION_NAME
        , OPTION_VALUE
        , INSERT_DATE
        , INSERT_USER_ID
        ) VALUES (
        #{GOOD_COMMON_OPTION_ID}
        , #{good_iden_numb}
        , #{OPTION_TYPE}
        , #{OPTION_NAME}
        , #{OPTION_VALUE}
        , GETDATE()
        , #{userInfoDto.userId}
        )
    </insert>

    <update id="updateGoodCommonOption">
        /* product.updateGoodCommonOption */
        UPDATE MCGOODCOMMONOPTION
        SET OPTION_NAME = #{OPTION_NAME}
        , OPTION_VALUE = #{OPTION_VALUE}
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
        AND GOOD_COMMON_OPTION_ID = #{GOOD_COMMON_OPTION_ID}
    </update>

    <sql id="selectPopOptionProductListSql">
        FROM 	MCGOOD A WITH(NOLOCK)
        WHERE 	ISNULL(A.REPRE_GOOD,'N') = 'N' <!-- 단품문 조회 -->
        AND		ISNULL(A.ADD_GOOD,'N') = 'N'
        AND		EXISTS(SELECT 1 FROM MCGOODVENDOR B WITH(NOLOCK) WHERE A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB AND B.ISUSE = '1')
        AND 	NOT EXISTS (SELECT 1 FROM mcaddgood B WITH(NOLOCK) WHERE A.good_iden_numb = B.good_iden_numb OR A.good_iden_numb = B.add_good_iden_numb)
        <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
        AND 	A.good_iden_numb = ${srcGoodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
        AND 	A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <!-- 추가상품 구성상품은 전기/통신>광점퍼코드, 전기/통신>케이블 카테고리에 한함 -->
        AND		EXISTS(	SELECT	1 
						FROM	MCCATEGORYMASTER X WITH(NOLOCK)
						INNER JOIN MCCATEGORYMASTER Y WITH(NOLOCK)
							ON	X.REF_CATE_SEQ = Y.CATE_ID
						WHERE	Y.CATE_CD IN ('B01','B02')
						AND		X.CATE_ID = A.CATE_ID
				)
    </sql>

    <select id="selectPopOptionProductList_count" resultType="int">
        /* product.selectPopOptionProductList_count */
        SELECT COUNT(1)
        <include refid="selectPopOptionProductListSql" />
    </select>

    <select id="selectPopOptionProductList" resultType="hashmap">
        /* product.selectPopOptionProductList */
        SELECT A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        , A.GOOD_SPEC
        <include refid="selectPopOptionProductListSql" />
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <update id="updateGoodForOption">
        /* product.updateGoodForOption */
        UPDATE 	A
        SET 	REPRE_GOOD = 'P'
        , 		PIMS = #{pims}
        , 		REPRE_GOOD_IDEN_NUMB = #{repre_good_iden_numb}
        , 		REPRE_DISPLAY_ORDER = #{pims}
        
        ,		GOOD_NAME = B.GOOD_NAME
        ,		GOOD_TYPE = B.GOOD_TYPE
        ,		VTAX_CLAS_CODE = B.VTAX_CLAS_CODE
        ,		ISDISTRIBUTE = B.ISDISTRIBUTE
        ,		PRODUCT_MANAGER = B.PRODUCT_MANAGER
        ,		GOOD_REG_YEAR = B.GOOD_REG_YEAR
        ,		ORDER_UNIT = B.ORDER_UNIT
        ,		VENDOR_EXPOSE = B.VENDOR_EXPOSE
        ,		STOCK_MNGT = B.STOCK_MNGT
        ,		NEW_BUSI = B.NEW_BUSI
        <if test="@MybatisUtils@isNotEmpty(good_spec)">
        , 		GOOD_SPEC = #{good_spec}
        </if>
        FROM	MCGOOD A WITH(NOLOCK) 
        INNER JOIN MCGOOD B WITH(NOLOCK) 
        	ON	A.REPRE_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        WHERE 	A.GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>
    
    <update id="updateGoodForOptionJoinRepreGood">
		/* product.updateGoodForOptionJoinRepreGood */
		UPDATE	MCGOOD
		SET		REPRE_GOOD_IDEN_NUMB = #{repre_good_iden_numb}
		WHERE	GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>

    <delete id="deleteGoodVendorForOption">
        /* product.deleteGoodVendorForOption */
        DELETE FROM MCGOODVENDOR
        WHERE GOOD_IDEN_NUMB = ${good_iden_numb}
    </delete>

	<select id="selectMcgoodRepreGoodIdenNumb" resultType="string">
		/* product.selectMcgoodRepreGoodIdenNumb */
		SELECT	A.REPRE_GOOD_IDEN_NUMB
		FROM 	MCGOOD A WITH(NOLOCK)
		WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
	</select>

    <insert id="insertGoodForOption">
        /* product.insertGoodForOption */
        INSERT INTO MCGOOD (
        GOOD_IDEN_NUMB
        , CATE_ID
        , REPRE_GOOD
        , GOOD_NAME
        , GOOD_REG_YEAR
        , NEW_BUSI
        , GOOD_SPEC
        , VTAX_CLAS_CODE
        , PRODUCT_MANAGER
        , ORDER_UNIT
        , GOOD_TYPE
        , VENDOR_EXPOSE
        , ISDISTRIBUTE
        , STOCK_MNGT
        , SKTS_IMG
        , SKTS_ORIGNAL_IMG_PATH
        , SKTS_LARGE_IMG_PATH
        , SKTS_MIDDLE_IMG_PATH
        , SKTS_SMALL_IMG_PATH
        , SKTS_GOOD_DESC
        , ADD_GOOD
        , ADD_GOOD_DESC
        , INSERT_DATE
        , INSERT_USER_ID
        , REPRE_GOOD_IDEN_NUMB
        , REPRE_DISPLAY_ORDER
        , PIMS
        )
        SELECT #{good_iden_numb}
        , CATE_ID
        , 'P'
        , GOOD_NAME
        , GOOD_REG_YEAR
        , NEW_BUSI
        , #{good_spec}
        , VTAX_CLAS_CODE
        , PRODUCT_MANAGER
        , ORDER_UNIT
        , GOOD_TYPE
        , VENDOR_EXPOSE
        , ISDISTRIBUTE
        , STOCK_MNGT
        , SKTS_IMG
        , SKTS_ORIGNAL_IMG_PATH
        , SKTS_LARGE_IMG_PATH
        , SKTS_MIDDLE_IMG_PATH
        , SKTS_SMALL_IMG_PATH
        , SKTS_GOOD_DESC
        , ADD_GOOD
        , ADD_GOOD_DESC
        , GETDATE()
        , #{userInfoDto.userId}
        , #{repre_good_iden_numb}
        , #{pims}
        , #{pims}
        FROM MCGOOD WITH(NOLOCK)
        WHERE good_iden_numb = #{repre_good_iden_numb}
    </insert>

    <insert id="insertGoodVendorForOption">
        /* product.insertGoodVendorForOption */
        INSERT INTO MCGOODVENDOR (
        GOOD_IDEN_NUMB
        , VENDORID
        , SELL_PRICE
        , SALE_UNIT_PRIC
        , VENDOR_PRIORITY
        , DELI_MINI_QUAN
        , GOOD_INVENTORY_CNT
        , DELI_MINI_DAY
        , DISTRI_RATE
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , LARGE_IMG_PATH
        , MIDDLE_IMG_PATH
        , SMALL_IMG_PATH
        , GOOD_SAME_WORD
        , GOOD_DESC
        , REGIST_DATE
        )
        SELECT #{good_iden_numb}
        , VENDORID
        , SELL_PRICE + (#{pims} - 1) * SELL_ADD
        , SALE_UNIT_PRIC + (#{pims} - 1) * SALE_ADD
        , VENDOR_PRIORITY
        , DELI_MINI_QUAN
        , GOOD_INVENTORY_CNT
        , DELI_MINI_DAY
        , DISTRI_RATE
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        , ORIGINAL_IMG_PATH
        , LARGE_IMG_PATH
        , MIDDLE_IMG_PATH
        , SMALL_IMG_PATH
        , GOOD_SAME_WORD
        , GOOD_DESC
        , GETDATE()
        FROM MCGOODVENDOR WITH(NOLOCK)
        WHERE good_iden_numb = #{repre_good_iden_numb}
    </insert>

    <insert id="insertGoodVendorForOption2">
        /* product.insertGoodVendorForOption2 */
        INSERT INTO MCGOODVENDOR (
        		GOOD_IDEN_NUMB
        , 		VENDORID
        , 		SELL_PRICE
        , 		SALE_UNIT_PRIC
        , 		VENDOR_PRIORITY
        , 		DELI_MINI_QUAN
        , 		GOOD_INVENTORY_CNT
        , 		DELI_MINI_DAY
        , 		DISTRI_RATE
        , 		MAKE_COMP_NAME
        , 		ISSUB_ONTRACT
        , 		ORIGINAL_IMG_PATH
        , 		LARGE_IMG_PATH
        , 		MIDDLE_IMG_PATH
        , 		SMALL_IMG_PATH
        , 		GOOD_SAME_WORD
        , 		GOOD_DESC
        , 		REGIST_DATE
        )
        SELECT 	A.GOOD_IDEN_NUMB
        , 		D.VENDORID
        , 		D.SELL_PRICE + (A.PIMS-1)*D.SELL_ADD
		,		D.SALE_UNIT_PRIC + (A.PIMS-1)*D.SALE_ADD
        , 		D.VENDOR_PRIORITY
        , 		D.DELI_MINI_QUAN
        , 		0
        , 		D.DELI_MINI_DAY
        , 		D.DISTRI_RATE
        , 		D.MAKE_COMP_NAME
        , 		D.ISSUB_ONTRACT
        , 		D.ORIGINAL_IMG_PATH
        , 		D.LARGE_IMG_PATH
        , 		D.MIDDLE_IMG_PATH
        , 		D.SMALL_IMG_PATH
        , 		D.GOOD_SAME_WORD
        , 		D.GOOD_DESC
        , 		GETDATE()
        FROM	MCGOOD A WITH(NOLOCK)
       	INNER JOIN MCGOODVENDOR D WITH(NOLOCK)
       		ON	A.REPRE_GOOD_IDEN_NUMB = D.GOOD_IDEN_NUMB
		WHERE	A.REPRE_GOOD_IDEN_NUMB = #{good_iden_numb}
		AND		D.VENDORID = #{VENDORID}
    </insert>

    <update id="deleteGoodForOption">
        /* product.deleteGoodForOption */
        UPDATE MCGOOD
        SET REPRE_GOOD = 'N'
        , REPRE_GOOD_IDEN_NUMB = null
        , REPRE_DISPLAY_ORDER = null
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>

    <select id="selectMcgoodHistList_count" resultType="int">
        /** product.selectMcgoodHistList_count **/
        SELECT COUNT(1)
        FROM MCGOOD_HIST WITH(NOLOCK)
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
        <if
            test="(productHistoryStartDate != null and  productHistoryStartDate != '') and  (productHistoryEndDate != null and  productHistoryEndDate != '')">
            AND INSERT_DATE BETWEEN CONVERT(DATETIME,#{productHistoryStartDate}) AND
            CONVERT(DATETIME,#{productHistoryEndDate}+' 23:59:59')
        </if>
    </select>

    <select id="selectMcgoodHistList" resultType="hashmap">
        /** product.selectMcgoodHistList **/
        SELECT CONVERT(VARCHAR(16), A.INSERT_DATE, 120) AS INSERT_DATE
        , dbo.FNS_CATE_STRING(CATE_ID) AS CATE_NM
        , A.REPRE_GOOD
        , A.GOOD_NAME
        , A.GOOD_REG_YEAR
        , A.NEW_BUSI
        , A.GOOD_SPEC
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.VTAX_CLAS_CODE
        = X.CODEVAL1 AND X.CODETYPECD = 'VTAXTYPECODE') AS VTAX_CLAS_CODE
        , (SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.PRODUCT_MANAGER)
        AS PRODUCT_MANAGER
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.ORDER_UNIT =
        X.CODEVAL1 AND X.CODETYPECD = 'ORDERUNIT') AS ORDER_UNIT
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.GOOD_TYPE =
        X.CODEVAL1 AND X.CODETYPECD = 'ORDERGOODSTYPE') AS GOOD_TYPE
        , A.VENDOR_EXPOSE
        , (SELECT X.CODENM1 FROM SMPCODES X WITH(NOLOCK) WHERE A.ISDISTRIBUTE =
        X.CODEVAL1 AND X.CODETYPECD = 'ISDISTRIBUTE') AS ISDISTRIBUTE
        , A.STOCK_MNGT
        , A.SKTS_IMG
        , A.ADD_GOOD
        , (SELECT X.USERNM FROM SMPUSERS X  WITH(NOLOCK) WHERE X.USERID = A.INSERT_USER_ID)
        AS INSERT_USER_NM
        FROM MCGOOD_HIST A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        <if
            test="(productHistoryStartDate != null and  productHistoryStartDate != '') and  (productHistoryEndDate != null and  productHistoryEndDate != '')">
            AND A.INSERT_DATE BETWEEN CONVERT(DATETIME,#{productHistoryStartDate})
            AND CONVERT(DATETIME,#{productHistoryEndDate}+' 23:59:59')
        </if>
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectMcgoodVendorHistList_count" resultType="int">
        /** product.selectMcgoodVendorHistList_count **/
        SELECT COUNT(1)
        FROM MCGOODVENDOR_HIST A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        <if
            test="(registStartDate != null and registStartDate != '') and (registEndDate != null and registEndDate != '')">
            AND A.REGIST_DATE BETWEEN CONVERT(DATETIME,#{registStartDate}) AND
            CONVERT(DATETIME,#{registEndDate}+' 23:59:59')
        </if>
    </select>

    <select id="selectMcgoodVendorHistList" resultType="hashmap">
        /** product.selectMcgoodVendorHistList **/
        SELECT CONVERT(VARCHAR(16), A.REGIST_DATE, 120) AS REGIST_DATE
        , VENDOR_PRIORITY
        , (SELECT VENDORNM FROM SMPVENDORS X WITH(NOLOCK) WHERE A.VENDORID =
        X.VENDORID) AS VENDORNM
        , SELL_PRICE
        , SALE_UNIT_PRIC
        , DISTRI_RATE
        , DELI_MINI_QUAN
        , DELI_MINI_DAY
        , GOOD_INVENTORY_CNT
        , MAKE_COMP_NAME
        , ISSUB_ONTRACT
        FROM MCGOODVENDOR_HIST A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        <if
            test="(registStartDate != null and registStartDate != '') and (registEndDate != null and registEndDate != '')">
            AND A.REGIST_DATE BETWEEN CONVERT(DATETIME,#{registStartDate}) AND
            CONVERT(DATETIME,#{registEndDate}+' 23:59:59')
        </if>
        <if test="orderString != null and orderString != ''">
            ORDER BY ${orderString}
        </if>
    </select>

    <select id="selectMainDispGoodList_count" resultType="int">
        /* product.selectMainDispGoodList_count */
        SELECT COUNT(1)
        FROM MCMAINDISPGOOD WITH(NOLOCK)
        <if test="@MybatisUtils@isNotEmpty(WORKID)">
            WHERE WORKID = ${WORKID}
        </if>
    </select>

    <select id="selectMainDispGoodList" resultType="hashmap">
        /* product.selectMainDispGoodList */
        SELECT A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        , A.GOOD_SPEC
        , MAX(SELL_PRICE) AS SELL_PRICE1
        , MIN(SELL_PRICE) AS SELL_PRICE2
        , MAX(SALE_UNIT_PRIC) AS SALE_UNIT_PRIC1
        , MIN(SALE_UNIT_PRIC) AS SALE_UNIT_PRIC2
        , BANNER_ID
        , dbo.FNS_ATTACH_FILE_NAME_PATH(BANNER_ID, 'NAME') AS BANNER_FILE
        , dbo.FNS_ATTACH_FILE_NAME_PATH(BANNER_ID, 'PATH') AS BANNER_PATH
        FROM MCMAINDISPGOOD B WITH(NOLOCK)
        , MCGOOD A WITH(NOLOCK)
        , MCGOODVENDOR C WITH(NOLOCK)
        <if test="@MybatisUtils@isNotEmpty(WORKID)">
            WHERE WORKID = ${WORKID}
        </if>
        AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND A.GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
        GROUP BY A.GOOD_IDEN_NUMB
        , A.GOOD_NAME
        , A.GOOD_SPEC
        , BANNER_ID
        , dbo.FNS_ATTACH_FILE_NAME_PATH(BANNER_ID, 'NAME')
        , dbo.FNS_ATTACH_FILE_NAME_PATH(BANNER_ID, 'PATH')
        <if test="@MybatisUtils@isNotEmpty(orderString)">
            ORDER BY ${orderString}
        </if>
    </select>

    <insert id="insertMainDispGood">
        /* product.insertMainDispGood */
        INSERT INTO MCMAINDISPGOOD (
        WORKID
        , GOOD_IDEN_NUMB
        , INSERT_USER_ID
        , INSERT_DATE
        )
        SELECT #{workid}
        , good_iden_numb
        , #{userInfoDto.userId}
        , GETDATE()
        FROM MCGOOD WITH(NOLOCK)
        WHERE GOOD_IDEN_NUMB IN (${good_iden_numb})
    </insert>
    
    <update id="updateMainDispGood">
        /* product.updateMainDispGood */
        UPDATE MCMAINDISPGOOD
           SET BANNER_ID      = #{banner_id}
         WHERE GOOD_IDEN_NUMB = ${good_iden_numb}
           AND WORKID         = #{workid}
    </update>

    <delete id="deleteMainDispGood">
        /* product.deleteMainDispGood */
        DELETE FROM MCMAINDISPGOOD
        WHERE GOOD_IDEN_NUMB IN (${good_iden_numb})
        AND WORKID = ${workid}
    </delete>

    <select id="selectSideCateList" resultType="hashmap">
        /*product.selectSideCateList*/
     	SELECT
			A.MAJO_CODE_NAME AS TOP_CATE_NAME,
			B.MAJO_CODE_NAME AS MID_CATE_NAME,
			C.MAJO_CODE_NAME AS DTL_CATE_NAME,
			A.CATE_CD        AS TOP_CATE_CD,
			A.CATE_ID        AS TOP_CATE_ID,
			B.CATE_CD        AS MID_CATE_CD,
			B.CATE_ID        AS MID_CATE_ID,
			C.CATE_CD        AS DTL_CATE_CD,
			C.CATE_ID        AS DTL_CATE_ID
		FROM
			MCCATEGORYMASTER A WITH(NOLOCK) 
		INNER JOIN MCCATEGORYMASTER B  WITH(NOLOCK) ON A.CATE_ID = B.REF_CATE_SEQ
		INNER JOIN MCCATEGORYMASTER C  WITH(NOLOCK) ON B.CATE_ID = C.REF_CATE_SEQ
		WHERE
			B.CATE_LEVEL = 2
		AND
			C.CATE_LEVEL = 3
		ORDER BY
			A.ORD_NUM, A.CATE_CD,
			B.ORD_NUM, B.CATE_CD,
			C.ORD_NUM, C.CATE_CD
    </select>

    <select id="getCommonOption" resultType="hashmap">
        /*product.getCommonOption*/
        SELECT 	GOOD_COMMON_OPTION_ID
        ,		GOOD_IDEN_NUMB
        , 		OPTION_TYPE
        , 		OPTION_NAME
        , 		OPTION_VALUE
        FROM	MCGOODCOMMONOPTION WITH(NOLOCK) 
        WHERE 	GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND		(OPTION_NAME IS NOT NULL AND OPTION_NAME != '')
        AND		(OPTION_VALUE IS NOT NULL AND OPTION_VALUE != '')
    </select>

    <select id="getAddOption" resultType="hashmap">
        /*product.getAddOption*/
        SELECT 	GOOD_COMMON_OPTION_ID
        , 		GOOD_IDEN_NUMB
        , 		OPTION_TYPE
        , 		OPTION_NAME
        , 		OPTION_VALUE
        FROM 	MCGOODCOMMONOPTION WITH(NOLOCK) 
        WHERE 	GOOD_IDEN_NUMB = #{goodIdenNumb}
    </select>

    <select id="getOptionPdtList_count" resultType="int">
        /* product.getOptionPdtList_count*/
        SELECT COUNT(1)
        FROM MCGOOD A WITH(NOLOCK) 
        , MCGOODVENDOR B WITH(NOLOCK) 
        WHERE A.REPRE_GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND B.ISUSE = '1'
        AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND B.VENDORID = #{vendorId}
        AND ISNULL(SELL_PRICE, 0) != 0
    </select>

	<select id="getOptionPdtList" resultType="hashmap">
		/* product.getOptionPdtList */
		SELECT	A.GOOD_IDEN_NUMB
		,		B.VENDORID
		,		A.GOOD_SPEC
		,		B.SELL_PRICE
		,		ISNULL(B.SALE_UNIT_PRIC,0) AS SALE_UNIT_PRIC
		,		ISNULL(B.GOOD_INVENTORY_CNT, 0) AS GOOD_INVENTORY_CNT
		FROM	MCGOOD A WITH(NOLOCK) 
		,		MCGOODVENDOR B WITH(NOLOCK) 
		WHERE	A.REPRE_GOOD_IDEN_NUMB = #{goodIdenNumb}
            AND B.ISUSE = '1'
			AND A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
			AND B.VENDORID = #{vendorId}
			AND ISNULL(SELL_PRICE, 0) != 0
		ORDER BY PIMS
	</select>

    <select id="getAddPdtList_count" resultType="int">
        /* product.getAddPdtList_count*/
        SELECT 	COUNT(1)
        FROM 	MCADDGOOD A WITH(NOLOCK) 
        , 		MCGOOD B WITH(NOLOCK) 
        , 		MCGOODVENDOR C WITH(NOLOCK) 
        WHERE 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND		A.ADD_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        AND 	A.ADD_GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
    </select>

    <select id="getAddPdtList" resultType="hashmap">
        /* product.getAddPdtList */
        SELECT 
            AA.GOOD_NAME
            ,AA.GOOD_SPEC
            ,AA.GOOD_IDEN_NUMB
            ,AA.DELI_MINI_DAY
            ,AA.SELL_PRICE
            ,AA.VENDORID
            ,AA.VENDORNM
            ,AA.ADD_GOOD_DESC
            ,AA.IMG_PATH
            ,AA.DISPLAY_YN
        FROM (
            SELECT	B.GOOD_NAME
            , 		B.GOOD_SPEC
            , 		B.GOOD_IDEN_NUMB
            , 		C.DELI_MINI_DAY
            , 		C.SELL_PRICE
            , 		C.VENDORID
            , 		D.VENDORNM
            , 		(SELECT Z.ADD_GOOD_DESC FROM MCGOOD Z  WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB) AS ADD_GOOD_DESC
            , 		CASE 	WHEN B.SKTS_IMG = 'Y' THEN ISNULL(B.SKTS_LARGE_IMG_PATH, '')
                            ELSE ISNULL(C.LARGE_IMG_PATH, '')
                    END AS IMG_PATH
            ,		DBO.FNS_ISDISPLAY_PRODUCT( B.GOOD_IDEN_NUMB , C.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN
            FROM 	MCADDGOOD A WITH(NOLOCK) 
            , 		MCGOOD B WITH(NOLOCK) 
            , 		MCGOODVENDOR C WITH(NOLOCK) 
            , 		SMPVENDORS D WITH(NOLOCK) 
            WHERE 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
            AND 	A.ADD_GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB 
            AND 	A.ADD_GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
            AND 	A.VENDORID = C.VENDORID
            AND 	C.VENDORID = D.VENDORID
            AND		C.ISUSE = '1'
            AND		C.SELL_PRICE > 0
        ) AA 
        WHERE AA.DISPLAY_YN = 'Y'
    </select>


    <select id="getProductVendorExpose" resultType="java.util.HashMap">
        /*
        product.getProductVendorExpose */
        SELECT MAX(A.GOOD_NAME) AS GOOD_NAME
        , MAX(A.GOOD_SPEC) AS GOOD_SPEC
        , A.GOOD_IDEN_NUMB
        ,
        MAX(ISNULL(A.ADD_GOOD,'N')) AS ADD_GOOD
        , MAX(ISNULL(A.REPRE_GOOD,'N'))
        AS REPRE_GOOD
        , MAX(ISNULL(A.VENDOR_EXPOSE,'Y')) AS VENDOR_EXPOSE
        FROM	MCGOOD A WITH(NOLOCK) 
        LEFT OUTER JOIN MCGOODVENDOR B WITH(NOLOCK) 
        	ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        INNER JOIN SMPVENDORS C WITH(NOLOCK) 
        	ON B.VENDORID = C.VENDORID
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND REPRE_GOOD != 'P'
        GROUP BY A.GOOD_IDEN_NUMB
    </select>

    <select id="getProductDetailInfoPop" resultType="hashmap">
        /* product.getProductDetailInfoPop */
        SELECT ISNULL(A.GOOD_NAME , '') AS
        GOOD_NAME
        , ISNULL(A.GOOD_SPEC , '') AS GOOD_SPEC
        , ISNULL(A.GOOD_IDEN_NUMB, '') AS GOOD_IDEN_NUMB
        ,
        ISNULL(B.MAKE_COMP_NAME, '') AS MAKE_COMP_NAME
        , ISNULL(B.DELI_MINI_DAY
        , 0 ) AS DELI_MINI_DAY
        , ISNULL(B.SELL_PRICE, 0) AS SELL_PRICE
        ,
        B.VENDOR_PRIORITY
        , C.VENDORNM
        , C.VENDORID
        , CASE
        WHEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT,
        0))) = '0' THEN '-'
        ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), B.GOOD_INVENTORY_CNT))
        END AS GOOD_INVENTORY_CNT
        , A.GOOD_TYPE AS GOOD_CLAS_CODE
        , B.SMALL_IMG_PATH
        , A.GOOD_TYPE AS GOOD_CLAS_CODE
        , ISNULL(B.GOOD_DESC, '') AS GOOD_DESC
        , ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
        , ISNULL(A.REPRE_GOOD,'N') AS
        REPRE_GOOD
        , CASE
        WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_LARGE_IMG_PATH, '')
        ELSE ISNULL(B.LARGE_IMG_PATH, '')
        END AS IMG_PATH
        , ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA  WITH(NOLOCK) WHERE A.PRODUCT_MANAGER = AA.USERID),'') AS PRODUCT_MANAGER
        FROM MCGOOD A  WITH(NOLOCK) 
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
        	ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        INNER JOIN	SMPVENDORS C WITH(NOLOCK) 
        	ON B.VENDORID = C.VENDORID
        WHERE A.GOOD_IDEN_NUMB = #{goodIdenNumb}
        ORDER BY B.VENDOR_PRIORITY
    </select>

    <select id="selectUserGoodCntByPk" resultType="int">
        /*product.selectUserGoodCntByPk */
        SELECT COUNT(1)
        FROM MRUSERGOOD WITH(NOLOCK) 
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
        AND BRANCHID = #{userInfoDto.borgId}
        AND USERID = #{userInfoDto.userId}
    </select>

    <insert id="insertUserGood">
        /* product.insertUserGood */
        INSERT INTO MRUSERGOOD(
        GOOD_IDEN_NUMB
        , BRANCHID
        , USERID
        , REGI_DATE_TIME
        )values(
        #{goodIdenNumb}
        , #{userInfoDto.borgId}
        , #{userInfoDto.userId}
        , GETDATE()
        )
    </insert>

    <delete id="deleteUserGood">
        /* product.deleteUserGood */
        DELETE FROM MRUSERGOOD
        WHERE BRANCHID =
        #{userInfoDto.borgId}
        AND USERID = #{userInfoDto.userId}
        AND GOOD_IDEN_NUMB
        <choose>
            <when test="goodIdenNumbs != null and goodIdenNumbs.size() != 0 ">
                <foreach collection="goodIdenNumbs" item="item" open="IN ("
                    separator="," close=")">
                    #{item}
                </foreach>
            </when>
            <otherwise>
                = ''
            </otherwise>
        </choose>
    </delete>

    <select id="selectUserGoodByUserInfo" resultType="java.util.HashMap">
		/*product.selectUserGoodByUserInfo */
		SELECT	MAX(AA.GOOD_NAME) AS GOOD_NAME
		,		MAX(AA.GOOD_SPEC) AS GOOD_SPEC
		,		AA.GOOD_IDEN_NUMB
		,		MAX(AA.ADD_GOOD) AS ADD_GOOD
		,		MAX(AA.REPRE_GOOD) AS REPRE_GOOD
		,		MAX(AA.VENDOR_EXPOSE) AS VENDOR_EXPOSE
		,		MAX(AA.GOOD_TYPE) AS GOOD_TYPE
		FROM	(
				SELECT	C.GOOD_NAME
				,		C.GOOD_SPEC
				,		C.GOOD_IDEN_NUMB
				,		ISNULL(C.GOOD_TYPE,'') AS GOOD_TYPE
				,		ISNULL(C.ADD_GOOD,'N') AS ADD_GOOD
				,		ISNULL(C.REPRE_GOOD,'N') AS REPRE_GOOD
				,		ISNULL(C.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
<!-- 				,		DBO.FNS_ISDISPLAY_PRODUCT(B.GOOD_IDEN_NUMB, B.VENDORID, #{userInfoDto.areaType}, #{userInfoDto.workId}, #{userInfoDto.borgId}) AS DISPLAY_YN -->
				FROM 	MRUSERGOOD A WITH(NOLOCK) 
				INNER JOIN MCGOOD C WITH(NOLOCK) 
					ON 	A.GOOD_IDEN_NUMB = C.GOOD_IDEN_NUMB
				LEFT OUTER JOIN MCGOODVENDOR B  WITH(NOLOCK) 
					ON 	C.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
					AND	B.ISUSE = '1'
				INNER JOIN SMPVENDORS D  WITH(NOLOCK) 
					ON 	B.VENDORID = D.VENDORID
				INNER JOIN SMPBORGS E WITH(NOLOCK) 
					ON	D.VENDORID = E.BORGID
					AND	E.ISUSE = '1'
				WHERE 	C.REPRE_GOOD != 'P'
				AND		B.SELL_PRICE > 0
				AND		A.BRANCHID = #{userInfoDto.borgId}
				AND 	A.USERID = #{userInfoDto.userId}
				<include refid="isGoodDisplaySql" />
		) AA
<!-- 		WHERE	AA.DISPLAY_YN = 'Y' -->
		GROUP BY AA.GOOD_IDEN_NUMB
    </select>

    <sql id="selectProductListForVenSql">
        FROM MCGOOD A WITH(NOLOCK)
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
	        ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
	        AND B.VENDORID = #{srcVendorId}
        WHERE repre_good IN ('Y','N')
        <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
            AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
            AND A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodType)">
            AND A.GOOD_TYPE = #{srcGoodType}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
            AND A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcProductManager)">
            AND A.PRODUCT_MANAGER = #{srcProductManager}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcRepreGood)">
            AND A.REPRE_GOOD = #{srcRepreGood}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcIsUse)">
            AND B.ISUSE = #{srcIsUse}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcStockMngt)">
            AND A.STOCK_MNGT = #{srcStockMngt}
        </if>
        
    </sql>

    <select id="selectProductListForVen_count" resultType="int">
        /* product.selectProductListForVen_count */
        SELECT
        	COUNT(1)
        <include refid="selectProductListForVenSql" />
    </select>

    <select id="selectProductListForVen" resultType="hashmap">
		/* product.selectProductListForVen */
		SELECT
			AA.GOOD_IDEN_NUMB,  AA.VENDORID,  AA.GOOD_TYPE_NM,   AA.REPRE_GOOD,         AA.REPRE_GOOD_NM,
			AA.GOOD_NAME,       AA.GOOD_SPEC, AA.SALE_UNIT_PRIC, AA.GOOD_INVENTORY_CNT, AA.DELI_MINI_DAY,
			AA.PRODUCT_MANAGER, AA.IMG_PATH,  LARGE_IMG_PATH,    AA.ORIGINAL_IMG_PATH,
			ISNULL(AA.MAKE_COMP_NAME, ' ') AS MAKE_COMP_NAME,
			ISNULL(AA.DELI_MINI_QUAN, 0)   AS DELI_MINI_QUAN,
			(ISNULL(AA.SALE_UNIT_PRIC, 0) * ISNULL(AA.GOOD_INVENTORY_CNT, 0)) AS STOCK_PRICE
		FROM
			(
				SELECT
					A.GOOD_IDEN_NUMB, B.VENDORID,    A.REPRE_GOOD,     A.GOOD_NAME,         A.GOOD_SPEC,
					SALE_UNIT_PRIC,   DELI_MINI_DAY, B.LARGE_IMG_PATH, B.ORIGINAL_IMG_PATH, B.MAKE_COMP_NAME,
					B.DELI_MINI_QUAN,
					(
						SELECT
							X.CODENM1
						FROM
							SMPCODES X WITH(NOLOCK)
						WHERE
							A.GOOD_TYPE  = X.CODEVAL1
						AND
							X.CODETYPECD = 'ORDERGOODSTYPE'
					) AS GOOD_TYPE_NM,
					(
						CASE
							A.REPRE_GOOD
							WHEN
								'Y'
							THEN
								'옵션'
							ELSE
								ISNULL(
									(
										SELECT
											TOP 1 '추가'
										FROM
											mcaddgood X WITH(NOLOCK)
										WHERE
											A.good_iden_numb = X.add_good_iden_numb
										AND
											X.vendorid = B.VENDORID
									),
									'단품'
								)
						END
					) AS REPRE_GOOD_NM,						
					(
						CASE
							REPRE_GOOD
						WHEN
							'Y' 
						THEN
							ISNULL(
								(
									SELECT
										SUM(Y.GOOD_INVENTORY_CNT)
									FROM
										MCGOOD       X WITH(NOLOCK),
										MCGOODVENDOR Y WITH(NOLOCK)
									WHERE
										X.REPRE_GOOD_IDEN_NUMB	= A.GOOD_IDEN_NUMB 
									AND
										X.GOOD_IDEN_NUMB		= Y.GOOD_IDEN_NUMB 
									AND
										Y.VENDORID				= B.VENDORID
								),
								0
							)
						ELSE
							GOOD_INVENTORY_CNT 
						END
					) AS GOOD_INVENTORY_CNT,
					ISNULL(
						(
							SELECT
								AA.USERNM+' ('+AA.TEL+')'
							FROM
								SMPUSERS AA WITH(NOLOCK)
							WHERE
								A.PRODUCT_MANAGER = AA.USERID
						),
						''
					) AS PRODUCT_MANAGER,
					(
						CASE
							WHEN
								A.SKTS_IMG = 'Y'
							THEN
								A.SKTS_SMALL_IMG_PATH
							ELSE
								B.SMALL_IMG_PATH
						END
					) AS IMG_PATH
					<![CDATA[
					,		CASE	WHEN (ASCII(SUBSTRING(A.GOOD_NAME, 1,1)) < 128) 
										THEN 2
									ELSE 1
							END ASCII_ORDER
					]]>
					,		B.ORDER_CNT
					,		A.INSERT_DATE
				<include refid="selectProductListForVenSql" />
		) AA
		<if test="@MybatisUtils@isNotEmpty(orderString)">
			ORDER BY ${orderString}
		</if>
    </select>
    
    <!-- 공급사 재고금액 조회 -->
    <select id="selectProductListForVenStockTotal" resultType="string">
    	/* product.selectProductListForVenStockTotal */
    	SELECT
    		SUM(A.GOOD_INVENTORY_CNT * A.SALE_UNIT_PRIC)
    	FROM
    		(
		    	SELECT
		    		CASE
		    			REPRE_GOOD WHEN 'Y' 
		        	THEN
		        		(
							SELECT
								SUM(Y.GOOD_INVENTORY_CNT) 
							FROM
								MCGOOD X WITH(NOLOCK) , 
								MCGOODVENDOR Y WITH(NOLOCK) 
							WHERE
								X.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB 
							AND
								X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB 
							AND
								Y.VENDORID = B.VENDORID
		                ) 
					ELSE
						GOOD_INVENTORY_CNT 
		            END AS GOOD_INVENTORY_CNT,
		            SALE_UNIT_PRIC
		    	<include refid="selectProductListForVenSql" />
    		) A
    </select>

    <update id="updateGoodVendorForVen">
        /* product.updateGoodVendorForVen */
        UPDATE	MCGOODVENDOR
        SET 	DELI_MINI_DAY = #{DELI_MINI_DAY}
        ,		DELI_MINI_QUAN = #{DELI_MINI_QUAN}
        , 		MAKE_COMP_NAME = #{MAKE_COMP_NAME}
        , 		ORIGINAL_IMG_PATH = #{ORIGINAL_IMG_PATH}
        , 		LARGE_IMG_PATH = #{LARGE_IMG_PATH}
        , 		MIDDLE_IMG_PATH = #{MIDDLE_IMG_PATH}
        , 		SMALL_IMG_PATH = #{SMALL_IMG_PATH}
        , 		GOOD_SAME_WORD = #{GOOD_SAME_WORD}
        , 		GOOD_DESC = #{GOOD_DESC}
        ,		UPDATE_DATE = GETDATE()
        WHERE 	GOOD_IDEN_NUMB = #{GOOD_IDEN_NUMB}
        AND 	VENDORID = #{VENDORID}
    </update>
    <insert id="insertGoodVendorForVenHistory">
    	/* product.insertGoodVendorForVenHistory */
    	INSERT INTO MCGOODVENDOR_HIST(
    			GOOD_HIST_ID
    	,		GOOD_IDEN_NUMB
    	,		VENDORID
    	,		DELI_MINI_DAY
    	,		MAKE_COMP_NAME
    	,		ORIGINAL_IMG_PATH
    	,		LARGE_IMG_PATH
    	,		MIDDLE_IMG_PATH
    	,		SMALL_IMG_PATH
    	,		GOOD_SAME_WORD
    	,		GOOD_DESC
    	,		REGIST_DATE
    	,		INSERT_USER_ID
    	) VALUES (
    			#{good_hist_id}
    	,		#{GOOD_IDEN_NUMB}
    	,		#{VENDORID}
    	,		#{DELI_MINI_DAY}
    	,		#{MAKE_COMP_NAME}
    	,		#{ORIGINAL_IMG_PATH}
    	,		#{LARGE_IMG_PATH}
    	,		#{MIDDLE_IMG_PATH}
    	,		#{SMALL_IMG_PATH}
    	,		#{GOOD_SAME_WORD}
    	,		#{GOOD_DESC}
    	,		GETDATE()
    	,		#{userInfoDto.userId}
    	)
    </insert>
    
    <update id="updateMcGoodForVen">
        /* product.updateMcGoodForVen */
        UPDATE	MCGOOD
        <if test="@MybatisUtils@isNotEmpty(GOOD_SPEC)">
        SET 	GOOD_SPEC = #{GOOD_SPEC}
        </if>
        <if test="@MybatisUtils@isNotEmpty(good_spec)">
        SET 	GOOD_SPEC = #{good_spec}
        </if>
        WHERE 	GOOD_IDEN_NUMB = #{GOOD_IDEN_NUMB}
    </update>
    <update id="mergeMcGoodSpec">
        /* product.mergeMcGoodSpec */
        MERGE	MCGOOD_SPEC AS A
        USING	(SELECT
		<if test="@MybatisUtils@isNotEmpty(GOOD_IDEN_NUMB)">
				#{GOOD_IDEN_NUMB} AS GOOD_IDEN_NUMB
        </if>
		<if test="@MybatisUtils@isNotEmpty(good_iden_numb)">
				#{good_iden_numb} AS GOOD_IDEN_NUMB
        </if>
				) AS B
        	ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        WHEN MATCHED THEN
        		UPDATE	SET
						SPEC_SPEC = #{spec_spec}
				,		SPEC_PI = #{spec_pi}
				,		SPEC_WIDTH = #{spec_width}
				,		SPEC_DEEP = #{spec_deep}
				,		SPEC_HEIGHT = #{spec_height}
				,		SPEC_LITER = #{spec_liter}
				,		SPEC_TON = #{spec_ton}
				,		SPEC_METER = #{spec_meter}
				,		SPEC_MATERIAL = #{spec_material}
				,		SPEC_SIZE = #{spec_size}
				,		SPEC_WEIGHT_SUM = #{spec_weight_sum}
				,		SPEC_COLOR = #{spec_color}
				,		SPEC_TYPE = #{spec_type}
				,		SPEC_WEIGHT_REAL = #{spec_weight_real}
		WHEN NOT MATCHED THEN
				INSERT (
					GOOD_IDEN_NUMB,
					SPEC_SPEC, SPEC_PI, SPEC_WIDTH, SPEC_DEEP, SPEC_HEIGHT,
					SPEC_LITER, SPEC_TON, SPEC_METER, SPEC_MATERIAL, SPEC_SIZE,
					SPEC_WEIGHT_SUM, SPEC_COLOR, SPEC_TYPE, SPEC_WEIGHT_REAL)
				VALUES (
		<if test="@MybatisUtils@isNotEmpty(GOOD_IDEN_NUMB)">
					#{GOOD_IDEN_NUMB},
		</if>
		<if test="@MybatisUtils@isNotEmpty(good_iden_numb)">
					#{good_iden_numb},
		</if>
					#{spec_spec}, #{spec_pi}, #{spec_width}, #{spec_deep}, #{spec_height},
					#{spec_liter}, #{spec_ton}, #{spec_meter}, #{spec_material}, #{spec_size},
					#{spec_weight_sum}, #{spec_color}, #{spec_type}, #{spec_weight_real}
				);
    </update>
    <insert id="insertMcGoodForVenHistory">
    	/* product.insertMcGoodForVenHistory */
    	INSERT INTO MCGOOD_HIST(
    			GOOD_HIST_ID
    	,		GOOD_IDEN_NUMB
    	,		GOOD_SPEC
    	,		INSERT_DATE
    	,		INSERT_USER_ID
    	) VALUES (
    			#{good_hist_id}
    	,		#{GOOD_IDEN_NUMB}
    	<if test="@MybatisUtils@isNotEmpty(GOOD_SPEC)">
    	,		#{GOOD_SPEC}
    	</if>
    	<if test="@MybatisUtils@isNotEmpty(good_spec)">
    	,		#{good_spec}
    	</if>
    	,		GETDATE()
    	,		#{userInfoDto.userId}
    	)
    </insert>
    
	
	<!-- /** 공급사 추가상품 상품 상세 정보 조회 */ -->
    <select id="selectVenProductDetailInfoPop" resultType="hashmap">
        /* product.selectVenProductDetailInfoPop */
        SELECT	ISNULL(A.GOOD_NAME , '') AS GOOD_NAME
        , 		ISNULL(A.GOOD_SPEC , '') AS GOOD_SPEC
        , 		ISNULL(A.GOOD_IDEN_NUMB, '') AS GOOD_IDEN_NUMB
        , 		ISNULL(B.MAKE_COMP_NAME, '') AS MAKE_COMP_NAME
        , 		ISNULL(B.DELI_MINI_DAY , 0 ) AS DELI_MINI_DAY
        , 		ISNULL(B.SELL_PRICE, 0) AS SELL_PRICE
        , 		B.VENDOR_PRIORITY
        , 		C.VENDORNM
        , 		C.VENDORID
        , 		CASE 	WHEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT, 0))) = '0' THEN '-'
                        ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), B.GOOD_INVENTORY_CNT))
                END AS GOOD_INVENTORY_CNT
        , 		A.GOOD_TYPE AS GOOD_CLAS_CODE
        , 		B.SMALL_IMG_PATH
        , 		ISNULL(B.GOOD_DESC, '') AS GOOD_DESC
        , 		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
        , 		CASE 	WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_LARGE_IMG_PATH, '')
                        ELSE ISNULL(B.LARGE_IMG_PATH, '')
                END AS IMG_PATH
        , 		ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA  WITH(NOLOCK) WHERE A.PRODUCT_MANAGER = AA.USERID),'') AS PRODUCT_MANAGER
        ,		ISNULL(B.DELI_MINI_QUAN,0) AS DELI_MINI_QUAN
        
        ,		A0.PURC_REQU_QUAN
        FROM 	
        (
			SELECT
                GOOD_IDEN_NUMB
            ,	VENDORID
            ,	PURC_REQU_QUAN
            FROM MRORDT WITH(NOLOCK) 
            WHERE ORDE_IDEN_NUMB = #{ordeIdenNumb}
            AND ORDE_SEQU_NUMB = #{ordeSequNumb}
        ) A0
        INNER JOIN MCGOOD A
            ON A0.GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
        INNER JOIN MCGOODVENDOR B
            ON 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
            AND A0.VENDORID = B.VENDORID
        INNER JOIN SMPVENDORS C
            ON 	B.VENDORID = C.VENDORID
    </select>
    
    
    <select id="selectProductAttribute" resultType="hashmap">
        /* product.selectProductAttribute */
        SELECT 
            CASE REPRE_GOOD 
            WHEN 'P' 
                THEN ISNULL(REPRE_GOOD_IDEN_NUMB,'')
            ELSE GOOD_IDEN_NUMB
            END AS GOOD_IDEN_NUMB
        FROM MCGOOD WITH(NOLOCK) 
        WHERE GOOD_IDEN_NUMB = #{goodIdenNumb}
    </select>
    
    
    
    
    
    <!--  공급사 역주문 상품 조회 시작 -->
    <select id="selectVenOrdReqSrcPdtListCnt" resultType="int">
		/* product.selectVenOrdReqSrcPdtListCnt */
		<include refid="selectVenOrdReqSrcPdtSql1" />
        SELECT 	COUNT(1)
        <include refid="selectVenOrdReqSrcPdtSql2" />
    </select>
	<sql id="selectVenOrdReqSrcPdtSql1">
        WITH TMP_TABLE (
				CATE_ID
        , 		MAJO_CODE_NAME
        , 		LEV
        , 		FULL_CATE_NAME
        , 		FULL_CATE_ID
        ) AS (
		   		SELECT	CATE_ID
		   		, 		MAJO_CODE_NAME
		   		, 		CONVERT (INT , CATE_LEVEL ) AS LEV
		   		, 		CONVERT (VARCHAR(255) , '' )
		   		, 		CONVERT (VARCHAR(255) , '' )
		   		FROM 	MCCATEGORYMASTER MASTERCATE WITH(NOLOCK) 
		   		WHERE 	CATE_ID = 0
		   		UNION ALL
		   		SELECT 	OL.CATE_ID
		   		, 		OL.MAJO_CODE_NAME
		   		, 		CTE.LEV+1
		   		, 		CONVERT (VARCHAR(255) , 
		   					CASE WHEN CTE.LEV+1 = 1 THEN OL.MAJO_CODE_NAME
		   						ELSE CTE.FULL_CATE_NAME + ' > ' + OL.MAJO_CODE_NAME
		   					END )
		   		, 		CONVERT (VARCHAR(255) , 
		   					CASE WHEN CTE.LEV+1 = 1 THEN CONVERT(VARCHAR, OL.CATE_ID )
		   						ELSE CTE.FULL_CATE_ID + ',' + CONVERT(VARCHAR, OL.CATE_ID )
		   					END )
		   		FROM 	MCCATEGORYMASTER OL WITH(NOLOCK)  
		   		,		TMP_TABLE CTE
		   		WHERE 	OL.REF_CATE_SEQ = CTE.CATE_ID
        )
	</sql>
	<sql id="selectVenOrdReqSrcPdtSql2">
		FROM	TMP_TABLE AA
		INNER JOIN (
				SELECT	MAX(Z.CATE_ID) AS CATE_ID
       			, 		MAX(Z.GOOD_NAME) AS GOOD_NAME
       			, 		MAX(Z.GOOD_SPEC) AS GOOD_SPEC
       			, 		Z.GOOD_IDEN_NUMB
       			, 		MAX(Z.ADD_GOOD) AS ADD_GOOD
       			, 		MAX(Z.REPRE_GOOD) AS REPRE_GOOD
       			, 		'Y' AS VENDOR_EXPOSE
       			, 		MAX(Z.GOOD_TYPE) AS GOOD_TYPE
       			, 		MAX(Z.DELI_DATE) AS DELI_DATE 
       			, 		MAX(Z.DELI_MINI_DAY) AS DELI_MINI_DAY
				FROM	(
						SELECT	A.CATE_ID
						,		A.GOOD_NAME
						,		A.GOOD_SPEC
						,		A.GOOD_IDEN_NUMB
						,		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
				        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
				        , 		ISNULL(A.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
				        ,		A.GOOD_TYPE
                        ,		DBO.FNS_DATE_CALC(CONVERT(VARCHAR(10),GETDATE(),121),B.DELI_MINI_DAY) AS DELI_DATE
                        ,		B.DELI_MINI_DAY
						FROM	MCGOOD A WITH(NOLOCK) 
						INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
							ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
				        	AND	B.ISUSE = '1'
						INNER JOIN SMPVENDORS C WITH(NOLOCK) 
							ON 	B.VENDORID = C.VENDORID
						INNER JOIN SMPBORGS D WITH(NOLOCK) 
							ON	C.VENDORID = D.BORGID
							AND	D.ISUSE = '1'
						WHERE 	1=1
						AND		B.SELL_PRICE > 0
        <if test="@MybatisUtils@isNotEmpty(srcOptPdt)">
                        AND A.GOOD_IDEN_NUMB
            <choose>
                <when test="goodIdenNumbers != null and goodIdenNumbers.size() != 0 ">
                    <foreach collection="goodNumbs" item="item" open="IN (" separator="," close=")">
                        #{item}
                    </foreach>
                </when>
            </choose>
						AND B.VENDORID = #{srcVendorId}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcVenOrdPdt)">
						AND ISNULL(A.ADD_GOOD,'N') = 'N'
						AND B.VENDORID = #{srcVendorId}
            <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
						AND A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%'
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
						AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodType)">
            			AND A.GOOD_TYPE = #{srcGoodType}
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodSpec)">
						AND A.GOOD_SPEC LIKE '%'+#{srcGoodSpec}+'%'
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcRepreGood)">
            			AND ISNULL(A.REPRE_GOOD,'N') = #{srcRepreGood}
            </if>
        </if>
        <if test="@MybatisUtils@isEmpty(srcOptPdt)">
						AND		A.REPRE_GOOD != 'P'
		</if>
		<if test="@MybatisUtils@isNotEmpty(srcBranchId)">
			<include refid="isGoodDisplayForVenSql" />
		</if>
		
				) Z
				GROUP BY Z.GOOD_IDEN_NUMB
		) BB
			ON	AA.CATE_ID = BB.CATE_ID
		WHERE	1 = 1
	</sql>
	
	
    <select id="selectVenOrdReqSrcPdtList" resultType="java.util.HashMap">
        /* product.selectVenOrdReqSrcPdtList */
		<include refid="selectVenOrdReqSrcPdtSql1" />
        SELECT 	*
        <include refid="selectVenOrdReqSrcPdtSql2" />
    </select>
    

    <select id="selectVenOrdReqSrcPdtInfo" resultType="java.util.HashMap">
        /* product.selectVenOrdReqSrcPdtInfo */
        SELECT	Z.*
        FROM	(
		        SELECT	ISNULL(A.GOOD_NAME , '') AS GOOD_NAME
		        , 		ISNULL(A.GOOD_SPEC , '') AS GOOD_SPEC
		        ,		CASE WHEN (A.REPRE_GOOD_IDEN_NUMB IS NOT NULL AND A.REPRE_GOOD_IDEN_NUMB!='')
						THEN (SELECT ' ('+Z.GOOD_SPEC+')' FROM MCGOOD Z WITH(NOLOCK) WHERE Z.GOOD_IDEN_NUMB = A.REPRE_GOOD_IDEN_NUMB)
						ELSE '' END AS OPT_GOOD_SPEC
		        ,		CASE WHEN (A.REPRE_GOOD_IDEN_NUMB IS NOT NULL AND A.REPRE_GOOD_IDEN_NUMB!='')
							THEN A.REPRE_GOOD_IDEN_NUMB		
							ELSE ''
							END AS REPRE_GOOD_IDEN_NUMB
		        , 		ISNULL(A.GOOD_IDEN_NUMB, '') AS GOOD_IDEN_NUMB
		        , 		ISNULL(B.MAKE_COMP_NAME, '') AS MAKE_COMP_NAME
		        , 		ISNULL(B.DELI_MINI_DAY , 0 ) AS DELI_MINI_DAY
		        ,		CASE 
		        		WHEN A.REPRE_GOOD = 'Y' 
		        		THEN (
                            SELECT MIN(X.SALE_UNIT_PRIC)
                            FROM MCGOOD Z WITH(NOLOCK) 
                            INNER JOIN MCGOODVENDOR X WITH(NOLOCK) 
                                ON Z.GOOD_IDEN_NUMB = X.GOOD_IDEN_NUMB
                            WHERE Z.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
                            AND X.VENDORID = B.VENDORID 
						)
						ELSE ISNULL(B.SALE_UNIT_PRIC, 0)
						END  AS SALE_UNIT_PRIC
				,		B.SELL_PRICE
		        , 		B.VENDOR_PRIORITY
		        , 		C.VENDORNM
		        , 		C.VENDORID
		        , 		CASE 	WHEN CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), ISNULL(B.GOOD_INVENTORY_CNT, 0))) = '0' THEN '-'
				        		ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(15,0), B.GOOD_INVENTORY_CNT))
				        END AS GOOD_INVENTORY_CNT
		        , 		A.GOOD_TYPE AS GOOD_CLAS_CODE
		        
		        , 		B.SMALL_IMG_PATH
		        , 		ISNULL(B.GOOD_DESC, '') AS GOOD_DESC
		        , 		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
		        , 		ISNULL(A.REPRE_GOOD,'N') AS REPRE_GOOD
		        , 		ISNULL((SELECT AA.USERNM+' ('+AA.TEL+')' FROM SMPUSERS AA  WITH(NOLOCK) WHERE A.PRODUCT_MANAGER = AA.USERID),'') AS PRODUCT_MANAGER
		        ,		ISNULL(B.DELI_MINI_QUAN,0) AS DELI_MINI_QUAN
                ,		CASE WHEN ISNULL(G.SKTS_IMG,'DIFF_IMG') = 'DIFF_IMG' 
                            THEN 
                                CASE WHEN A.SKTS_IMG = 'Y' THEN ISNULL(A.SKTS_LARGE_IMG_PATH, '') ELSE ISNULL(B.LARGE_IMG_PATH, '') END 
                            ELSE 
                                CASE WHEN G.SKTS_IMG = 'Y' THEN ISNULL(G.SKTS_LARGE_IMG_PATH, '') ELSE ISNULL(H.LARGE_IMG_PATH, '') END 
                            END  AS IMG_PATH            
		        FROM 	MCGOOD A WITH(NOLOCK) 
		        INNER JOIN MCGOODVENDOR B WITH(NOLOCK) 
		        	ON 	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
		        	AND	B.ISUSE = '1'
		        	AND	B.SELL_PRICE > 0
		        LEFT OUTER JOIN MCGOOD G WITH(NOLOCK) 
                    ON	A.REPRE_GOOD_IDEN_NUMB = G.GOOD_IDEN_NUMB
		        LEFT OUTER JOIN MCGOODVENDOR H WITH(NOLOCK) 
                    ON	A.REPRE_GOOD_IDEN_NUMB = H.GOOD_IDEN_NUMB
                    AND	B.VENDORID = H.VENDORID
                    AND	H.ISUSE = '1'
                    AND	H.SELL_PRICE > 0
		        INNER JOIN SMPVENDORS C WITH(NOLOCK) 
		        	ON 	B.VENDORID = C.VENDORID
		        INNER JOIN SMPBORGS D WITH(NOLOCK) 
		        	ON	C.VENDORID = D.BORGID
		        	AND	D.ISUSE = '1'
		        WHERE 	A.GOOD_IDEN_NUMB = #{goodIdenNumb}
		        
        <if test="@MybatisUtils@isNotEmpty(srcVenOrdPdt)">
						AND ISNULL(A.ADD_GOOD,'N') = 'N'
						AND B.VENDORID = #{srcVendorId}
            <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
						AND A.GOOD_NAME LIKE '%'+#{srcGoodName}+'%'
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
						AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodType)">
            			AND A.GOOD_TYPE = #{srcGoodType}
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcGoodSpec)">
						AND A.GOOD_SPEC LIKE '%'+#{srcGoodSpec}+'%'
            </if>
            <if test="@MybatisUtils@isNotEmpty(srcRepreGood)">
            			AND ISNULL(A.REPRE_GOOD,'N') = #{srcRepreGood}
            </if>
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcBranchId)">
			<include refid="isGoodDisplayForVenSql" />
		</if>
		        
        ) Z
        ORDER BY Z.VENDOR_PRIORITY
    </select>
    <!--  공급사 역주문 상품 조회 끝 -->
    
    <insert id="insertPriceChgHist2">
        /* product.insertPriceChgHist */
        INSERT INTO MCPRICECHGHIST (
              PRICE_CHG_HIST_ID
            , GOOD_IDEN_NUMB
            , VENDORID
            , SELL_SALE_TYPE
            , SELL_PRICE
            , SALE_UNIT_PRIC
            , CHG_REASON
            , INSERT_DATE
            , INSERT_USER_ID 
        ) 
       SELECT #{price_chg_hist_id}
            , good_iden_numb
            , vendorid
            , #{sell_sale_type}
            , REPLACE(#{sell_price},',','')
            , REPLACE(#{sale_unit_pric},',','')
            , #{chg_reason}
            , GETDATE()
            , #{userInfoDto.userId}
         FROM MCGOODVENDOR A WITH(NOLOCK)
        WHERE A.GOOD_IDEN_NUMB = ${good_iden_numb}
          AND A.VENDORID       = #{vendorid}
    </insert>
    
    <update id="updateGoodVendorForOption">
        /* product.updateGoodVendorForOption */
        UPDATE MCGOODVENDOR
           SET GOOD_INVENTORY_CNT = ISNULL(GOOD_INVENTORY_CNT,0) + #{chgStock}
          <if test="@MybatisUtils@isNotEmpty(sell_price)">
             , SALE_UNIT_PRIC     = #{sale_unit_pric}
             , SELL_PRICE         = #{sell_price}
          </if>
          ,		UPDATE_DATE = GETDATE()
         WHERE GOOD_IDEN_NUMB     = ${good_iden_numb}
           AND VENDORID           = #{vendorid}
    </update>
    
    
    <select id="selectMasterGoodIdenNumb" resultType="string">
    	/* product.selectMasterGoodIdenNumb */
    	SELECT	A.REPRE_GOOD_IDEN_NUMB
    	FROM 	MCGOOD A WITH(NOLOCK)
    	WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
    	AND		A.REPRE_GOOD = 'P'
    </select>
    
    
    <sql id="selectProductListForStockAdmSql">
        FROM MCGOOD A WITH(NOLOCK)
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
        	ON	A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        	AND	B.ISUSE = '1'
        WHERE isnull(repre_good,'N') IN ('Y','N')
        AND		A.STOCK_MNGT = 'Y'
        <if test="@MybatisUtils@isNotEmpty(srcVendorId) and  srcVendorId neq '0'.toString() ">
            AND B.VENDORID = #{srcVendorId}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
            AND A.CATE_ID = #{srcCateId}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
            AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
            AND (A.GOOD_NAME LIKE '%${srcGoodName}%' OR B.GOOD_SAME_WORD LIKE '%${srcGoodName}%' OR A.GOOD_SPEC LIKE '%${srcGoodName}%')
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
            AND A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
    </sql>

    <select id="selectProductListForStockAdmCnt" resultType="int">
        /* product.selectProductListForStockAdmCnt */
        SELECT COUNT(1)
        <include refid="selectProductListForStockAdmSql" />
    </select>

    <select id="selectProductListForStockAdmList" resultType="hashmap">
        /* product.selectProductListForStockAdmList */
        SELECT
        	AA.GOOD_IDEN_NUMB, AA.GOOD_TYPE_NM,  AA.REPRE_GOOD,  AA.REPRE_GOOD_NM,   AA.GOOD_NAME,
			AA.GOOD_SPEC,      AA.VENDORNM,      AA.SELL_PRICE,  AA.SALE_UNIT_PRIC,  AA.GOOD_INVENTORY_CNT,
			AA.ISDISTRIBUTENM, AA.DELI_MINI_DAY, AA.INSERT_DATE, AA.PRODUCT_MANAGER, AA.VENDORID,
			(
				AA.SALE_UNIT_PRIC * AA.GOOD_INVENTORY_CNT
			) AS STOCK_PRICE
        FROM
        	(
		        SELECT
					A.GOOD_IDEN_NUMB,
					(
						SELECT
							X.CODENM1
						FROM
							SMPCODES X WITH(NOLOCK)
						WHERE
							A.GOOD_TYPE = X.CODEVAL1
						AND
							X.CODETYPECD = 'ORDERGOODSTYPE'
					) AS GOOD_TYPE_NM,
					A.REPRE_GOOD,
					(
						CASE
							WHEN
								ISNULL(A.REPRE_GOOD,'N') = 'Y'
							THEN
								'옵션'
							WHEN
								ISNULL(A.REPRE_GOOD,'N')='N' AND ISNULL(A.ADD_GOOD,'N')='Y'
							THEN
								'추가'
							ELSE
								'단품'
						END
					) AS REPRE_GOOD_NM,
					A.GOOD_NAME,
					A.GOOD_SPEC,
					(
						SELECT
							VENDORNM
						FROM
							SMPVENDORS X WITH(NOLOCK)
						WHERE
							B.VENDORID = X.VENDORID
					) AS VENDORNM,
					ISNULL(SELL_PRICE, 0) AS SELL_PRICE,
					ISNULL(SALE_UNIT_PRIC, 0) AS SALE_UNIT_PRIC,
					ISNULL(
						CASE
							REPRE_GOOD
						WHEN
							'Y'
						THEN
							(
								SELECT
									SUM(Y.GOOD_INVENTORY_CNT)
								FROM
									MCGOOD       X WITH(NOLOCK),
									MCGOODVENDOR Y WITH(NOLOCK)
								WHERE
									X.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
								AND
									X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB
								AND
									Y.VENDORID = B.VENDORID
							)
						ELSE
							GOOD_INVENTORY_CNT
						END,
						0
					) AS GOOD_INVENTORY_CNT,
					(
						SELECT
							X.CODENM1
						FROM
							SMPCODES X WITH(NOLOCK)
						WHERE
							A.ISDISTRIBUTE = X.CODEVAL1
						AND
							X.CODETYPECD = 'ISDISTRIBUTE'
					) AS ISDISTRIBUTENM,
					ISNULL(DELI_MINI_DAY, 0) as DELI_MINI_DAY,
					CONVERT(VARCHAR(10), INSERT_DATE, 120) AS INSERT_DATE,
					ISNULL(
						(
							SELECT
								AA.USERNM+' ('+AA.TEL+')'
							FROM
								SMPUSERS AA WITH(NOLOCK)
							WHERE
								A.PRODUCT_MANAGER = AA.USERID
						),
						''
					) AS PRODUCT_MANAGER,
					B.VENDORID
		        <include refid="selectProductListForStockAdmSql" />		        
        	) AA
        	<if test="@MybatisUtils@isNotEmpty(orderString)">
				ORDER BY ${orderString}
			</if>
    </select>
    
    <select id="selectProductListForStockAdmTotal" resultType="string">
        /* product.selectProductListForStockAdmTotal */
        SELECT
			SUM(AA.SALE_UNIT_PRIC * AA.GOOD_INVENTORY_CNT)
        FROM
        	(
		        SELECT
					ISNULL(SALE_UNIT_PRIC, 0) AS SALE_UNIT_PRIC,
					ISNULL(
						CASE
							REPRE_GOOD
						WHEN
							'Y'
						THEN
							(
								SELECT
									SUM(Y.GOOD_INVENTORY_CNT)
								FROM
									MCGOOD       X WITH(NOLOCK),
									MCGOODVENDOR Y WITH(NOLOCK)
								WHERE
									X.REPRE_GOOD_IDEN_NUMB = A.GOOD_IDEN_NUMB
								AND
									X.GOOD_IDEN_NUMB = Y.GOOD_IDEN_NUMB
								AND
									Y.VENDORID = B.VENDORID
							)
						ELSE
							GOOD_INVENTORY_CNT
						END,
						0
					) AS GOOD_INVENTORY_CNT
		        <include refid="selectProductListForStockAdmSql" />		        
        	) AA
    </select>
    
    
    
    <delete id="deleteMcgooddispaly">
        /* product.deleteMcgooddispaly */
        DELETE FROM MCGOODDISPLAY WHERE GOOD_IDEN_NUMB = #{good_iden_numb} AND VENDORID = #{vendorid}
    </delete>
    <delete id="deleteMcgoodDisplayBranch">
        /* product.deleteMcgoodDisplayBranch */
        DELETE FROM MCGOODDISPLAYBRANCH WHERE GOOD_IDEN_NUMB = #{good_iden_numb} AND VENDORID = #{vendorid}
    </delete>
    <insert id="insertMcgooddispaly">
        /* product.insertMcgooddispaly */
        INSERT INTO MCGOODDISPLAY
               (
               GOOD_DISPLAY_ID
               ,GOOD_IDEN_NUMB
               ,VENDORID
               ,DISPLAY_TYPE
               ,DISPLAY_TYPE_CD
               ,INSERT_DATE
               ,INSERT_USER_ID
               )
         VALUES
               (
               #{good_display_id}
               ,#{good_iden_numb}
               ,#{vendorid}
               ,#{display_type}
               ,#{display_type_cd}
               ,GETDATE()
               ,#{insert_user_id}
               )
    </insert>
    <insert id="insertMcgoodDisplayBranch">
        /* product.insertMcgoodDisplayBranch */
        INSERT INTO MCGOODDISPLAYBRANCH
                   (
                       GOOD_DISPLAY_BRANCH_ID
                   ,GOOD_IDEN_NUMB
                   ,VENDORID
                   ,BRANCHID
                   ,INSERT_DATE
                   ,INSERT_USER_ID
                   )
             VALUES
                   (
                       #{good_display_branch_id}
                   ,#{good_iden_numb}
                   ,#{vendorid}
                   ,#{branchid}
                   ,GETDATE()
                   ,#{insert_user_id}
                   )
    </insert>
    
    <update id="updateProductModifyExcelUpload">
    	/* product.updateProductModifyExcelUpload */
    	UPDATE	MCGOOD
    	SET		CATE_ID = (SELECT TOP 1 Z.CATE_ID FROM MCCATEGORYMASTER Z WITH(NOLOCK) WHERE Z.CATE_CD =#{cate_cd})
    	WHERE	GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>
    <insert id="insertMcGoodHistNew">
        /** product.insertMcGoodHistNew **/
        INSERT INTO MCGOOD_HIST(
        		GOOD_HIST_ID
        , 		GOOD_IDEN_NUMB
        , 		GOOD_NAME
        , 		VTAX_CLAS_CODE
        , 		SALE_CRITERION_TYPE
        ,		STAN_BUYING_RATE
        , 		STAN_BUYING_MONEY
        , 		ISDISTRIBUTE
        , 		ISDISPPASTGOOD
        ,		INSERT_DATE
        , 		CATE_ID
        , 		INSERT_USER_ID
        ,		PRODUCT_MANAGER
        ,		REPRE_GOOD
        ,		GOOD_REG_YEAR
        ,		GOOD_SPEC
        ,		ORDER_UNIT
        ,		GOOD_TYPE
        ,		VENDOR_EXPOSE
        ,		STOCK_MNGT
        ,		ADD_GOOD
        ,		ADD_GOOD_DESC
        ,		SKTS_IMG
        ,		SKTS_ORIGNAL_IMG_PATH
        ,		SKTS_LARGE_IMG_PATH
        ,		SKTS_MIDDLE_IMG_PATH
        ,		SKTS_SMALL_IMG_PATH
        ,		SKTS_GOOD_DESC
        ,		NEW_BUSI
        ,		REPRE_GOOD_IDEN_NUMB
        ,		REPRE_DISPLAY_ORDER
        )		
        SELECT 	
        		#{good_hist_id}
        , 		GOOD_IDEN_NUMB
        , 		GOOD_NAME
        , 		VTAX_CLAS_CODE
        , 		SALE_CRITERION_TYPE
        ,		STAN_BUYING_RATE
        , 		STAN_BUYING_MONEY
        , 		ISDISTRIBUTE
        , 		ISDISPPASTGOOD
        ,		GETDATE()
        , 		(SELECT TOP 1 Z.CATE_ID FROM MCCATEGORYMASTER Z WITH(NOLOCK) WHERE Z.CATE_CD =#{cate_cd})
        , 		#{loginUserDto.userId}
        ,		PRODUCT_MANAGER
        ,		REPRE_GOOD
        ,		GOOD_REG_YEAR
        ,		GOOD_SPEC
        ,		ORDER_UNIT
        ,		GOOD_TYPE
        ,		VENDOR_EXPOSE
        ,		STOCK_MNGT
        ,		ADD_GOOD
        ,		ADD_GOOD_DESC
        ,		SKTS_IMG
        ,		SKTS_ORIGNAL_IMG_PATH
        ,		SKTS_LARGE_IMG_PATH
        ,		SKTS_MIDDLE_IMG_PATH
        ,		SKTS_SMALL_IMG_PATH
        ,		SKTS_GOOD_DESC
        ,		NEW_BUSI
        ,		REPRE_GOOD_IDEN_NUMB
        ,		REPRE_DISPLAY_ORDER
        FROM 	MCGOOD WITH(NOLOCK) 
        WHERE	GOOD_IDEN_NUMB = #{good_iden_numb}
    </insert>
    
    <update id="updateProductVendorModifyExcelUpload">
    	/* product.updateProductVendorModifyExcelUpload */
    	UPDATE	MCGOODVENDOR
    	SET		GOOD_SAME_WORD = #{good_same_word}
    	,		UPDATE_DATE = GETDATE()
    	WHERE	GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>
    <select id="selectProductVendorModifyExcelUpload" resultType="hashmap">
    	/* product.selectProductVendorModifyExcelUpload */
    	SELECT	A.GOOD_IDEN_NUMB
    	,		A.VENDORID
    	FROM 	MCGOODVENDOR A WITH(NOLOCK)
    	WHERE	A.GOOD_IDEN_NUMB = #{good_iden_numb}
    </select>
    <insert id="insertMcGoodVendorHistNew">
        /** product.insertMcGoodVendorHistNew **/
        INSERT INTO MCGOODVENDOR_HIST (
				good_hist_id
		,		good_iden_numb
		,		vendorid
		,		req_good_id
		,		sale_unit_pric
		,		good_st_spec_desc
		,		good_spec_desc
		,		orde_clas_code
		,		deli_mini_day
		,		deli_mini_quan
		,		make_comp_name
		,		original_img_path
		,		large_img_path
		,		middle_img_path
		,		small_img_path
		,		good_same_word
		,		good_desc
		,		issub_ontract
		,		good_clas_code
		,		good_inventory_cnt
		,		regist_date
		,		order_cnt
		,		isUse
		,		distri_rate
		,		insert_user_id
		,		sell_price
		,		VENDOR_PRIORITY
        )
        SELECT	
        		#{good_hist_id}
		,		good_iden_numb
		,		vendorid
		,		req_good_id
		,		sale_unit_pric
		,		good_st_spec_desc
		,		good_spec_desc
		,		orde_clas_code
		,		deli_mini_day
		,		deli_mini_quan
		,		make_comp_name
		,		original_img_path
		,		large_img_path
		,		middle_img_path
		,		small_img_path
		,		#{good_same_word}
		,		good_desc
		,		issub_ontract
		,		good_clas_code
		,		good_inventory_cnt
		,		GETDATE()
		,		order_cnt
		,		isUse
		,		distri_rate
		,		#{loginUserDto.userId}
		,		sell_price
		,		VENDOR_PRIORITY
        FROM 	MCGOODVENDOR WITH(NOLOCK)
        WHERE	GOOD_IDEN_NUMB = #{GOOD_IDEN_NUMB}
        AND		VENDORID = #{VENDORID}
	</insert>
	
	<select id="selectProductDescByGoodIdenNumb" resultType="hashmap">
		/** product.selectProductDescByGoodIdenNumb **/
		SELECT	A.GOOD_DESC AS productDesc
		FROM 	MCGOODVENDOR A WITH(NOLOCK)
		WHERE	A.GOOD_IDEN_NUMB = #{GOOD_IDEN_NUMB}
		AND		A.VENDORID = #{VENDORID}
	</select>
	
	<!-- 공급사 상품 등록 요청 상품 상세 정보 조회 -->
	<select id="selectReqProductDescByGoodIdenNumb" resultType="hashmap">
		/* product.selectReqProductDescByGoodIdenNumb */
		SELECT
			A.GOOD_DESC AS productDesc
		FROM
			MCGOODREQUEST A WITH(NOLOCK)
		WHERE
			A.REQ_GOOD_ID = #{reqGoodId}
	</select>
	
    <update id="updateVendorBuyRate">
    	/* product.updateVendorBuyRate */
    	UPDATE	MCGOODVENDOR
    	SET		UPDATE_DATE = GETDATE()
    	<if test="@MybatisUtils@isNotEmpty(BUY_RATE)">
    	,		BUY_RATE = #{BUY_RATE}
    	</if>
    	<if test="@MybatisUtils@isEmpty(BUY_RATE)">
    	,		BUY_RATE = null
    	</if>
    	WHERE	GOOD_IDEN_NUMB = #{good_iden_numb}
    	AND		VENDORID = #{VENDORID}
    </update>
    
	<select id="selectExportExcelProductInfo" resultType="hashmap">
		/* product.selectExportExcelProductInfo */
        WITH TMP_TABLE ( 
				CATE_ID
		,		CATE_CD
		,		MAJO_CODE_NAME
		,		REF_CATE_SEQ
		,		CATE_LEVEL
		,		LEV
		,		FULL_CATE_NAME
		,		CATE_NAME_1ST
		,		CATE_NAME_2ST
		,		CATE_NAME_3ST
		) AS ( 
				SELECT	CATE_ID
				,		CATE_CD
				,		MAJO_CODE_NAME
				,		CONVERT (VARCHAR , '-1')
				,		CATE_LEVEL
				,		0 AS LEV
				,		CONVERT (VARCHAR(200) , '' )
				,		CONVERT (VARCHAR , '' )
				,		CONVERT (VARCHAR , '' )
				,		CONVERT (VARCHAR , '' )
				FROM MCCATEGORYMASTER A WITH(NOLOCK) 
				WHERE CATE_ID = '0'
				UNION ALL
				SELECT	OL.CATE_ID
				,		OL.CATE_CD
				,		OL.MAJO_CODE_NAME
				,		CONVERT (VARCHAR ,OL.REF_CATE_SEQ )
				,		OL.CATE_LEVEL
				,		CTE.LEV+1
				,		CONVERT (VARCHAR(200) , CASE WHEN CTE.LEV+1 = 1 THEN OL.MAJO_CODE_NAME ELSE CTE.FULL_CATE_NAME + ' > ' + OL.MAJO_CODE_NAME END )
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 1 THEN OL.MAJO_CODE_NAME ELSE CTE.CATE_NAME_1ST END))
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 2 THEN OL.MAJO_CODE_NAME ELSE CTE.CATE_NAME_2ST END))
				,		CONVERT (VARCHAR , (CASE WHEN CTE.LEV+1 = 3 THEN OL.MAJO_CODE_NAME ELSE CTE.CATE_NAME_3ST END))
				FROM	MCCATEGORYMASTER OL WITH(NOLOCK) 
				,		TMP_TABLE CTE
				WHERE	OL.REF_CATE_SEQ = CTE.CATE_ID
		)
		SELECT 	A.GOOD_IDEN_NUMB
		,		C.CATE_CD
		,		A.GOOD_NAME
		,		A.GOOD_REG_YEAR
		,		ISNULL(A.NEW_BUSI,'N') AS NEW_BUSI
<!-- 		,		CASE WHEN D.SPEC_SPEC IS NULL OR LTRIM(RTRIM(D.SPEC_SPEC)) = '' THEN A.GOOD_SPEC ELSE D.SPEC_SPEC END AS SPEC_SPEC -->
<![CDATA[
		,		CASE WHEN
					D.SPEC_SPEC <> '' OR D.SPEC_PI <> '' OR D.SPEC_WIDTH <> '' OR D.SPEC_DEEP <> '' OR D.SPEC_HEIGHT <> '' OR D.SPEC_LITER <> '' OR D.SPEC_TON <> '' OR
					D.SPEC_METER <> '' OR D.SPEC_MATERIAL <> '' OR D.SPEC_SIZE <> '' OR D.SPEC_WEIGHT_SUM <> '' OR D.SPEC_COLOR <> '' OR D.SPEC_TYPE <> '' OR D.SPEC_WEIGHT_REAL <> ''
				THEN
					D.SPEC_SPEC
				ELSE
					A.GOOD_SPEC
				END
				AS SPEC_SPEC
]]>
		,		D.SPEC_PI
		,		D.SPEC_WIDTH
		,		D.SPEC_DEEP
		,		D.SPEC_HEIGHT
		,		D.SPEC_LITER
		,		D.SPEC_TON
		,		D.SPEC_METER
		,		D.SPEC_MATERIAL
		,		D.SPEC_SIZE
		,		D.SPEC_WEIGHT_SUM
		,		D.SPEC_COLOR
		,		D.SPEC_TYPE
		,		D.SPEC_WEIGHT_REAL
		,		A.VTAX_CLAS_CODE
		,		A.PRODUCT_MANAGER
        , 		A.ORDER_UNIT
		,		A.GOOD_TYPE
		,		ISNULL(A.VENDOR_EXPOSE,'Y') AS VENDOR_EXPOSE
		,		A.ISDISTRIBUTE
		,		ISNULL(A.STOCK_MNGT,'N') AS STOCK_MNGT
		,		ISNULL(A.ADD_GOOD,'N') AS ADD_GOOD
		,		ISNULL(A.SKTS_IMG,'N') AS SKTS_IMG
		,		(SELECT VENDORCD FROM SMPVENDORS WHERE VENDORID = B.VENDORID) AS VENDORCD
		,		B.ISUSE
		,		B.SELL_PRICE
		,		B.SALE_UNIT_PRIC
		,		ISNULL(B.DELI_MINI_QUAN, 1) AS DELI_MINI_QUAN
		,		B.DELI_MINI_DAY
		,		ISNULL(B.DISTRI_RATE,0) AS DISTRI_RATE
		,		ISNULL(B.MAKE_COMP_NAME,'') AS MAKE_COMP_NAME
		,		ISNULL(B.ISSUB_ONTRACT,0) AS ISSUB_ONTRACT
		,		ISNULL(B.GOOD_INVENTORY_CNT,0) AS GOOD_INVENTORY_CNT
		,		B.VENDOR_PRIORITY
        FROM MCGOOD A WITH(NOLOCK)
        INNER JOIN MCGOODVENDOR B WITH(NOLOCK)
			ON A.GOOD_IDEN_NUMB = B.GOOD_IDEN_NUMB
        <if test="@MybatisUtils@isNotEmpty(srcGoodSameWord)">
            AND B.GOOD_SAME_WORD LIKE '%${srcGoodSameWord}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcIsUse)">
            AND B.ISUSE = #{srcIsUse}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcVendorId) and  srcVendorId neq '0'.toString() ">
            AND B.VENDORID = #{srcVendorId}
        </if>
        LEFT OUTER JOIN TMP_TABLE C
        	ON	A.CATE_ID = C.CATE_ID
        LEFT OUTER JOIN MCGOOD_SPEC D
			ON A.GOOD_IDEN_NUMB = D.GOOD_IDEN_NUMB
        WHERE ISNULL(REPRE_GOOD,'N') = 'N'
        <if test="@MybatisUtils@isNotEmpty(srcCateId)">
            AND A.CATE_ID IN (SELECT CATE_ID FROM FNS_CATEGORYIDS_BY_PARENTCATEID(#{srcCateId})) 
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcInsertStartDate) and @MybatisUtils@isNotEmpty(srcInsertEndDate)">
            AND INSERT_DATE BETWEEN CONVERT(DATETIME, #{srcInsertStartDate}) AND
            DATEADD(D,1,CONVERT(DATETIME, #{srcInsertEndDate}))
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodIdenNumb)">
            AND A.GOOD_IDEN_NUMB = #{srcGoodIdenNumb}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodName)">
            AND A.GOOD_NAME LIKE '%${srcGoodName}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(addSql)">
        	${addSql}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodClasCode)">
            AND A.GOOD_TYPE = #{srcGoodClasCode}
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcGoodSpecDesc)">
            AND A.GOOD_SPEC LIKE '%${srcGoodSpecDesc}%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcProductManager)">
            AND A.PRODUCT_MANAGER = #{srcProductManager}
        </if>
        <if test="srcType eq '1'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	ISNULL(A.ADD_GOOD,'N') = 'N'
            AND NOT EXISTS (select TOP 1 1 from mcaddgood X WITH(NOLOCK) WHERE A.good_iden_numb = X.add_good_iden_numb AND X.vendorid = B.VENDORID)
        </if>
        <if test="srcType eq '0'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	A.ADD_GOOD = 'Y'
        </if>
        <if test="srcType eq '2'.toString()">
            AND A.REPRE_GOOD = 'Y'
        </if>
        <if test="srcType eq '3'.toString()">
            AND ISNULL(A.REPRE_GOOD,'N') = 'N'
            AND	ISNULL(A.ADD_GOOD,'N') = 'N'
            AND EXISTS (select TOP 1 1 from mcaddgood X WITH(NOLOCK) WHERE A.good_iden_numb = X.add_good_iden_numb AND X.vendorid = B.VENDORID)
        </if>
        <if test="@MybatisUtils@isNotEmpty(srcWorkId)">
            AND EXISTS (
            	SELECT TOP 1 1 
            	FROM MCGOODDISPLAY X WITH(NOLOCK) 
            	WHERE A.GOOD_IDEN_NUMB = X.GOOD_IDEN_NUMB 
            	AND X.VENDORID = B.VENDORID
            	AND X.DISPLAY_TYPE = '20'
            	AND X.DISPLAY_TYPE_CD = #{srcWorkId}
            )
        </if>
        ORDER BY  GOOD_IDEN_NUMB DESC
	</select>
	

    <update id="updateMultiGood">
        /* product.updateMultiGood */
        UPDATE MCGOOD
        SET GOOD_IDEN_NUMB = #{good_iden_numb}
        <if test="@MybatisUtils@isNotEmpty(cate_id)">
        ,	CATE_ID = #{cate_id}
        </if>
        <if test="@MybatisUtils@isNotEmpty(good_name)">
        , 	GOOD_NAME = #{good_name}
        </if>
        <if test="@MybatisUtils@isNotEmpty(good_spec)">
        , 	GOOD_SPEC = #{good_spec}
        </if>
        <if test="@MybatisUtils@isNotEmpty(product_manager)">
        , 	PRODUCT_MANAGER = #{product_manager}
        </if>
        <if test="@MybatisUtils@isNotEmpty(order_unit)">
        , 	ORDER_UNIT = #{order_unit}
        </if>
        <if test="@MybatisUtils@isNotEmpty(good_type)">
        , 	GOOD_TYPE = #{good_type}
        </if>
        <if test="@MybatisUtils@isNotEmpty(vendor_expose)">
        , 	VENDOR_EXPOSE = #{vendor_expose}
        </if>
        <if test="@MybatisUtils@isNotEmpty(isdistribute)">
        , 	ISDISTRIBUTE = #{isdistribute}
        </if>
        <if test="@MybatisUtils@isNotEmpty(stock_mngt)">
        , 	STOCK_MNGT = #{stock_mngt}
        </if>
        <if test="@MybatisUtils@isNotEmpty(good_reg_year)">
        , 	GOOD_REG_YEAR = #{good_reg_year}
        </if>
        WHERE GOOD_IDEN_NUMB = #{good_iden_numb}
    </update>	
</mapper>